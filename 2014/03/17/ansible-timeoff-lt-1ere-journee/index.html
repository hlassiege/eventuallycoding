<!DOCTYPE html>
<html >
<head><meta charset="utf-8">
<title>Ansible (timeoff LT 1ère journée) | EventuallyCoding</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://digianalytics.fr/js/script.js" data-host="https://digianalytics.fr" id="ZwSg9rf6GA" async="" defer="" type="text/javascript"></script>
<meta name="description" content="[![ansible](/images/5570d-ansible.png)](http://eventuallycoding.com/wp-content/uploads/2014/03/5570d-ansible.png)Nous y voici ! Le timeoff Lateral-Tho...">
<meta name="og:description" content="[![ansible](/images/5570d-ansible.png)](http://eventuallycoding.com/wp-content/uploads/2014/03/5570d-ansible.png)Nous y voici ! Le timeoff Lateral-Tho...">
<meta name="og:type" content="article">
<meta name="og:title" content="Ansible (timeoff LT 1ère journée)">
<meta name="og:url" content="https://eventuallycoding.com/2014/03/17/ansible-timeoff-lt-1ere-journee">
<meta name="og:image" content="https://eventuallycoding.com/images/covers/cover4.jpg">
<meta name="og:image:alt" content="Ansible (timeoff LT 1ère journée)">
<meta name="twitter:text:title" content="Ansible (timeoff LT 1ère journée)">
<meta name="twitter:image" content="https://eventuallycoding.com/images/covers/cover4.jpg">
<meta name="twitter:card" content="summary">
<meta name="article:published_time" content="2014-03-17T00:00:00.000Z">
<meta name="article:article:modified_time" content="2014-03-17T00:00:00.000Z">
<meta name="article:article:tag" content="ansible,devops,fabric,timeoff">
<link rel="canonical" href="https://eventuallycoding.com/2014/03/17/ansible-timeoff-lt-1ere-journee"><link rel="modulepreload" href="/2014/03/17/ansible-timeoff-lt-1ere-journee/_payload.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/entry.e7b0454d.js"><link rel="preload" as="style" href="/_nuxt/entry.4bebad5b.css"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/default.b93ff253.js"><link rel="preload" as="style" href="/_nuxt/TheHeader.9f2103a4.css"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/TheHeader.cc500634.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/TheFooter.1c4a0619.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/siteMetaData.bb10a390.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/github_new.c6ffbd0b.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/_id_.0d97d705.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/PageSidebar.9631623c.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/Dropdown.c153f2cd.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/_commonjsHelpers.fed2a411.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ContentRenderer.df92f22a.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ContentRendererMarkdown.5958bac8.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/BlogCard.vue.cdf9f909.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/asyncData.5779ab7d.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/composables.d85d353f.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/query.1c79d23b.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/utils.442c6a32.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/HeroSection.c616fa1b.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseP.1ed949d6.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseEm.62123932.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseA.fcebd916.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseStrong.5c1c96ee.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseUl.12544acc.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseLi.4b79e2fb.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseImg.6713cd03.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseH2.f05407d5.js"><link rel="prefetch" as="script" crossorigin href="/_nuxt/web-socket.cf4aa752.js"><link rel="prefetch" as="script" crossorigin href="/_nuxt/error-component.e6a629ae.js"><link rel="prefetch" as="image" type="image/svg+xml" href="/_nuxt/rss.9e0b880c.svg"><link rel="prefetch" as="image" type="image/svg+xml" href="/_nuxt/mastodon.f0ecdde8.svg"><link rel="prefetch" as="image" type="image/svg+xml" href="/_nuxt/linkeding.34c3bc6d.svg"><link rel="prefetch" as="image" type="image/svg+xml" href="/_nuxt/twitter.457cff27.svg"><link rel="prefetch" as="image" type="image/svg+xml" href="/_nuxt/github_new.4e3fe23c.svg"><link rel="stylesheet" href="/_nuxt/entry.4bebad5b.css"><link rel="stylesheet" href="/_nuxt/TheHeader.9f2103a4.css"><style>.nuxt-content h2{font-size:28px;font-weight:700}.nuxt-content h3{font-size:22px;font-weight:700}.nuxt-content p{margin-bottom:20px}</style><style>.nuxt-content h2{font-size:28px;font-weight:700}.nuxt-content h3{font-size:22px;font-weight:700}.nuxt-content p{margin-bottom:20px}.clip-ellipse{--tw-bg-opacity:1;background-color:rgb(255 255 255/var(--tw-bg-opacity));-webkit-clip-path:ellipse(60% 100% at 50% 0);clip-path:ellipse(60% 100% at 50% 0);height:100px;width:100%}</style></head>
<body ><div id="__nuxt"><!--[--><section class="w-full pb-12 antialiased"><div class="mx-auto max-w-8xl"><div data-v-b1496831><nav class="transition-colors fixed w-full z-10 top-0" id="header-menu" data-v-b1496831><div class="max-w-7xl mx-auto px-2 sm:px-6 lg:px-8" data-v-b1496831><div class="relative flex items-center justify-between h-16" data-v-b1496831><div class="absolute inset-y-0 left-0 flex items-center sm:hidden" data-v-b1496831><button type="button" class="inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-white hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-white" aria-controls="mobile-menu" aria-expanded="false" data-v-b1496831><span class="sr-only" data-v-b1496831>Open main menu</span><svg class="block h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" data-v-b1496831><path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" data-v-b1496831></path></svg><svg class="hidden h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" data-v-b1496831><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" data-v-b1496831></path></svg></button></div><div class="flex-1 flex items-center justify-center sm:items-stretch sm:justify-start" data-v-b1496831><div class="flex-shrink-0 flex items-center" data-v-b1496831><span class="text-white text-base font-medium font-bruno text-2xl font-to-invert-to-pink" data-v-b1496831> EventuallyCoding.com </span></div><div class="hidden sm:block sm:ml-6 absolute right-0 font-mark" data-v-b1496831><div class="flex space-x-4" data-v-b1496831><!--[--><a href="/" class="link text-white font-to-invert-to-black" data-v-b1496831>Home</a><a href="/blog" class="link text-white font-to-invert-to-black" data-v-b1496831>Blog</a><a href="/resources" class="link text-white font-to-invert-to-black" data-v-b1496831>Resources</a><!--]--></div></div></div></div></div><div class="hidden" data-v-b1496831><div class="px-2 pt-2 pb-3 space-y-1" data-v-b1496831><!--[--><a href="/" class="text-white hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium font-to-invert-to-black" data-v-b1496831>Home</a><a href="/blog" class="text-white hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium font-to-invert-to-black" data-v-b1496831>Blog</a><a href="/resources" class="text-white hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium font-to-invert-to-black" data-v-b1496831>Resources</a><!--]--></div></div></nav></div><!--[--><!--[--><div><section class="flex items-center justify-center h-128 bg-transparent"><canvas id="c" class="-z-10 absolute w-full h-128 block"></canvas><div class="clip-ellipse absolute top-124 rotate-180"></div><!--[--><div class="absolute top-96 w-96 -translate-y-20"><img src="/images/covers/cover4.jpg" alt="Ansible (timeoff LT 1ère journée)" class="object-cover"></div><!--]--></section><div class="px-4 mx-auto sm:px-6 xl:max-w-7xl xl:px-0 mt-10"><h1 class="text-4xl text-gray-700 font-extrabold mb-10 text-center">Ansible (timeoff LT 1ère journée)</h1><div class="grid grid-cols-3 text-center sm:w-full md:w-1/2 mx-auto"><div><p class="text-center font-bold my-5 text-slate-400 text-xs"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline-block" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg> March 17, 2014</p></div><div><p class="text-center font-bold my-5 text-slate-400 text-xs"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline-block" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> 8 min read</p></div><div class="flex items-center font-medium sm:mx-3 justify-center"><img src="/hugo-nb.jpg" loading="lazy" alt="" class="mr-3 w-10 h-10 rounded-full bg-slate-50 dark:bg-slate-800"><div><div class="font-bold text-slate-400 text-xs">Hugo Lassiège</div><a target="_blank" href="https://twitter.com/hugolassiege" class="font-bold text-sky-400 text-xs hover:text-sky-600"> @hugolassiege</a></div></div></div><div class="sm:w-full md:w-1/2 mx-auto"><p class="mt-2 text-xs my-3 flex flex-wrap -m-1 justify-center"><!--[--><a href="/blog?tag=ansible" class="m-1 leading-loose text-slate-400 border border-current lowercase px-2 rounded font-medium">#ansible</a><a href="/blog?tag=devops" class="m-1 leading-loose text-slate-400 border border-current lowercase px-2 rounded font-medium">#devops</a><a href="/blog?tag=fabric" class="m-1 leading-loose text-slate-400 border border-current lowercase px-2 rounded font-medium">#fabric</a><a href="/blog?tag=timeoff" class="m-1 leading-loose text-slate-400 border border-current lowercase px-2 rounded font-medium">#timeoff</a><!--]--></p></div><div class="text-left mx-auto"><div class="flex flex-wrap lg:flex-row-reverse py-12"><div class="w-full lg:w-1/4 px-5"><div class="lg:sticky top-0 pt-5 -mt-5"><div class="toc hidden lg:block"><h3 class="border-b-4 pb-3 mb-3 border-gray-200 text-xl">On this page</h3><ul class="pl-0"><!--[--><li class="py-1"><a class="hover:text-smalt-blue-700" href="#ansible-et-windows">Ansible et Windows</a></li><li class="py-1"><a class="hover:text-smalt-blue-700" href="#larborescence-dun-playbook">L’arborescence d’un playbook</a></li><li class="py-1"><a class="hover:text-smalt-blue-700" href="#au-sein-dun-rôle">Au sein d’un rôle</a></li><li class="py-1"><a class="hover:text-smalt-blue-700" href="#un-fichier-de-tâche">Un fichier de tâche</a></li><li class="py-1"><a class="hover:text-smalt-blue-700" href="#les-plâtres-essuyés">Les plâtres essuyés</a></li><li class="py-1"><a class="hover:text-smalt-blue-700" href="#avis-après-un-jour-et-demi-dutilisation">Avis après un jour et demi d’utilisation</a></li><!--]--></ul></div><div class="text-right mb-12"><div class="relative inline-block text-left ml-2 block lg:hidden"><div><span class="rounded-md shadow-sm"><button type="button" class="inline-flex justify-center w-full rounded-md border border-gray-300 px-4 py-2 bg-white text-sm leading-5 font-medium text-black hover:text-white hover:bg-smalt-blue-500 focus:outline-none transition ease-in-out duration-150" aria-haspopup="true" aria-expanded="true"><!--[-->On this page<!--]--><svg class="-mr-1 ml-2 h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></span></div><!----></div></div></div></div><div class="lg:w-3/4 w-full px-5 max-w-none centered-image"><div id="nuxtContent" class="prose font-proxima text-sm md:text-xl font-medium min-w-full md:p-10 mx-auto"><p><!--[--><a href="http://eventuallycoding.com/wp-content/uploads/2014/03/5570d-ansible.png" rel="nofollow"><!--[--><img src="/images/5570d-ansible.png" alt="ansible"><!--]--></a>Nous y voici ! Le timeoff Lateral-Thoughts a démarré dans une super propriété a <a href="https://www.airbnb.fr/rooms/911475?s=zcbV" rel="nofollow"><!--[-->Garrigues Sainte-Eulalie<!--]--></a>. Pour résumé, <a href="http://www.eventuallycoding.com/index.php/on-devrait-toujours-travailler-comme-ca-bis/" rel="nofollow"><!--[-->le timeoff<!--]--></a> c’est une semaine de code retreat avec l’ensemble de l’équipe dans un coin sympa pour veiller, coder, livrer des choses qui nous branchent.<!--]--></p><p><!--[-->Challenge, je vais tenter de faire un billet par jour sur la semaine si j’apprends quelque chose d’intéressant (c’est déjà mal barré, ce billet a trainé sur deux jours…).<!--]--></p><p><!--[-->Et aujourd’hui, on va parler d’Ansible, et pour la première fois sur ce blog, ce sera un billet écrit à quatre mains. Mon comparse pour ce billet sera <a href="https://github.com/spiroid" rel="nofollow"><!--[-->Jonathan Dray<!--]--></a> qui connaissait déjà un peu l&#39;outil.<!--]--></p><p><!--[--><em><!--[-->Petit défi, trouvez qui a écrit chaque paragraphe.<!--]--></em><!--]--></p><p><!--[-->Ansible, pour ceux qui ne connaissent pas, c’est un outil de provisionning de machine. Si on simplifie, cet outil permet de “scripter” le déploiement d’un ensemble de groupes de machine, chaque groupe devant contenir certains logiciels ou configurations.<!--]--></p><p><!--[-->Quand je parle de groupe de machines, c’est par exemple les serveurs de base de données et les serveurs applicatifs. Chaque groupe de machine attend des configurations différentes.<!--]--></p><p><!--[-->Resituons le problème que c’est censé résoudre.<!--]--></p><p><!--[-->Souvent lorsqu’une nouvelle machine arrive dans le parc, elle est configuré manuellement : installation du jdk, de python, d’une base de données etc… C’est évidemment source d’erreur et relativement long.<!--]--></p><p><!--[-->Parfois on utilise un master (un template) qui est une image type qui sera cloné sur une machine. Le souci principal concerne la maintenance de ces masters, et le nombre de masters nécessaires : poste de dev front, poste de dev back, poste de dev pour les deux, serveur de base de données etc…<!--]--></p><p><!--[-->Ensuite vient l’étape au dessus, les machines provisionnées de façon automatique.<!--]--></p><p><!--[-->Sur ce blog j’avais déjà parlé de <a href="http://www.eventuallycoding.com/index.php/fabric-moi-un-cluster/" rel="nofollow"><!--[-->Fabric<!--]--></a>, outil python pour scripter un déploiement.<!--]--></p><p><!--[-->Avant cela, on aurait pu évoquer le simple shell script. Fabric permet une abstraction au dessus, le contrôle d’erreur, l’exécution parallèle, les tâches qui s’exécutent en fonction du type de machine (serveur base de données, serveur applicatif etc…).<!--]--></p><p><!--[-->Ansible s’inscrit dans la famille des outils qui propose de décrire un état de la machine et qui va faire en sorte lors de l’exécution que la machine soit conforme à cet état si ce n’était pas encore le cas.<!--]--></p><h2 id="ansible-et-windows"><a href="#ansible-et-windows"><!--[-->Ansible et Windows<!--]--></a></h2><p><!--[-->Première mauvaise découverte, Ansible n’est pas vraiment fait pour tourner sous Windows. Il existe cependant <a href="https://servercheck.in/blog/running-ansible-within-windows" rel="nofollow"><!--[-->une possibilité décrite sur ce lien<!--]--></a>.<!--]--></p><p><!--[-->Je souhaitais utiliser Vagrant pour créer des VM sur mon poste et utiliser le <a href="http://docs.vagrantup.com/v2/provisioning/ansible.html" rel="nofollow"><!--[-->provisionner Ansible<!--]--></a>. Pour ceux qui ne connaissent pas Vagrant et des provisionneur, je vous invite à lire un ancien billet où j’avais utilisé <a href="http://www.eventuallycoding.com/index.php/fabric-vagrant/" rel="nofollow"><!--[-->Vagrant et Fabric<!--]--></a>.<!--]--></p><p><!--[-->Malheureusement le mix Ansible/Vagrant ne semble vraiment pas fait pour tourner ensemble sous Windows.<!--]--></p><p><!--[-->Solution de secours après une heure de combat inégal entre l’homme et la machine :<!--]--></p><ul><!--[--><li><!--[-->utiliser Vagrant pour créer une VM vierge<!--]--></li><li><!--[-->utiliser Ansible sur la VM pour piloter le provisionning de la machine elle-même (puis une machine distante)<!--]--></li><!--]--></ul><p><!--[-->J’ai eu cependant une seconde mauvaise surprise, je comptais utiliser un répertoire partagé entre ma VM et Windows (mécanisme de shared folder avec Vagrant). Or j’ai pu constater que tout fichier dans un shared folder est en permission 777. Or cela pose des soucis à Ansible… Du coup j’ai du laisser tomber l’utilisation de répertoire partagé.<!--]--></p><h2 id="larborescence-dun-playbook"><a href="#larborescence-dun-playbook"><!--[-->L’arborescence d’un playbook<!--]--></a></h2><p><!--[-->Un playbook (livre à jouer) contient la description de plusieurs composants (rôles) à installer, les configurations, les templates, les adresses de machine etc...<!--]--></p><p><!--[-->Voyons l’arborescence en détail :<!--]--></p><p><!--[-->vagrant@precise32:~/playbook$ tree
|-- ansible.cfg
|-- production
|-- roles
|   |-- common
|   |   |-- meta
|   |   `-- tasks
|   |       `-- main.yml
|   `-- jira
|       |-- handlers
|       |   `-- main.yml
|       |-- tasks
|       |   `-- main.yml
|       |-- templates
|       |   |-- jira-application.properties
|       |   |-- jira.init.d.j2
|       |   `-- response.varfile.j2
|       `-- vars
|           `-- main.yml
|-- site.yml
`-- stage<!--]--></p><ul><!--[--><li><!--[-->Le fichie ansible.cfg permet d’avoir une configuration globale à Ansible. Il a été utilisé ici pour référencer d’autres rôles que nous avons récupéré (mais non utilisé) à partir de Github :<!--]--></li><!--]--></ul><p><!--[-->[defaults]<!--]--></p><p><!--[-->roles_path=/home/vagrant/workspace/the-ansibles/roles<!--]--></p><ul><!--[--><li><!--[-->Les fichiers stage et production permettent de définir les machines utilisées dans chaque cas.<!--]--></li><li><!--[-->Les rôles contiennent les définitions de chaque composant à installer.<!--]--></li><li><!--[-->Le fichier site.yml décrit les rôles à lancer pour chaque type de machine. Par exemple ici, pour les machines de type adminservers (décrit dans les fichiers stage et production), les rôles à appliquer sont common et jira :<!--]--></li><!--]--></ul><p><!--[-->---<!--]--></p><ul><!--[--><li><!--[-->hosts: adminservers
 remote_user: root
 sudo: true
 roles:
   - common
   - jira<!--]--></li><!--]--></ul><h2 id="au-sein-dun-rôle"><a href="#au-sein-dun-rôle"><!--[-->Au sein d’un rôle<!--]--></a></h2><p><!--[-->Pour ma part, après une journée de lutte j’ai cependant réussi à créer deux “rôles” pour installer postgresql, un jdk7 et Jira sur une machine.<!--]--></p><p><!--[-->Dans un rôle, on peut trouver plusieurs répertoires :<!--]--></p><ul><!--[--><li><!--[-->meta : qui peut décrire les dépendances d’un rôle, par exemple le rôle jira peut avoir comme prérequis le rôle jira.<!--]--></li><li><!--[-->tasks : les tâches à effectuer pour installer un composant<!--]--></li><li><!--[-->handlers : les actions qui peuvent être lancés par des actions effectuées dans des tâches. J’ai peu creusé ce point donc je n’insisterais pas.<!--]--></li><li><!--[-->templates : les templates de configuration qui pourront être poussés sur le serveur par les tâches<!--]--></li><li><!--[-->vars : les variables de configuration qui pourront être utilisés dans les templates ou les tâches<!--]--></li><!--]--></ul><h2 id="un-fichier-de-tâche"><a href="#un-fichier-de-tâche"><!--[-->Un fichier de tâche<!--]--></a></h2><p><!--[-->Pour exécuter un rôle Ansible va lire le fichier main.yml présent dans le répertoire tasks. Voyons un fichier de ce type, ici un rôle pour installer postgresql :<!--]--></p><p><!--[-->- apt: pkg=libpq-dev<!--]--></p><ul><!--[--><li><!--[-->apt: pkg=python-dev<!--]--></li><li><!--[-->apt: pkg=python-pip<!--]--></li><li><!--[-->pip: name=psycopg2<!--]--></li><li><!--[-->name: install postgresql
 shell: LANG=en_US.UTF-8 LC_COLLATE=en_US.UTF-8 LC_CTYPE=en_US.UTF-8 LC_MESSAGES=en_US.UTF-8 LC_MONETARY=en_US.UTF-8 LC_NUMERIC=en_US.UTF-8 LC_TIME=en_US.UTF-8 LC_ALL=en_US.UTF-8  apt-get
install postgresql -y -q<!--]--></li><li><!--[-->name: install postgresql-client
 apt: pkg=postgresql-client state=installed<!--]--></li><li><!--[-->apt: pkg=openjdk-7-jre<!--]--></li><li><!--[-->postgresql_db: name=jira encoding=&#39;UTF-8&#39; lc_ctype=&#39;en_US.UTF-8&#39; lc_collate=&#39;en_US.UTF-8&#39; template=&#39;template0&#39;
 sudo_user: postgres<!--]--></li><li><!--[-->postgresql_user: db=jira password=jira name=jira priv=ALL state=present
 sudo_user: postgres<!--]--></li><!--]--></ul><p><!--[-->Chaque ligne commençant par un - correspond à l’appel d’un module. Dans ce fichier on utilise par exemple les modules suivants :<!--]--></p><ul><!--[--><li><!--[-->apt pour les installations de package<!--]--></li><li><!--[-->pip pour les installations de package python<!--]--></li><li><!--[-->shell pour lancer des commandes directement, l’install par apt de postgresql ayant quelque souci<!--]--></li><li><!--[-->postgresql_db et postgresql_user qui permettent de manipuler base et utilisateurs sur postgresql.<!--]--></li><!--]--></ul><p><!--[-->Sur la doc Ansible on retrouve une <a href="http://docs.ansible.com/list_of_all_modules.html" rel="nofollow"><!--[-->liste de module<!--]--></a> assez riche.<!--]--></p><h2 id="les-plâtres-essuyés"><a href="#les-plâtres-essuyés"><!--[-->Les plâtres essuyés<!--]--></a></h2><p><!--[-->Ansible est une solution assez jeune et on a rencontré quelques problèmes lors de nos expérimentations.<!--]--></p><p><!--[-->La première difficulté venait du fait que l’on partait d’un serveur minimaliste et qui n’avait aucune librairie pré-installée.<!--]--></p><p><!--[-->Pas même python-apt (ouh la on part de loin !) qui est un pré-requis à l’exécution de l’installation des paquets avec Ansible sur des machines de type Debian-like.<!--]--></p><p><!--[-->Dans ce cas précis, un mécanisme de fallback installe python-apt, … en temps normal …<!--]--></p><p><!--[-->Après quelques heures d’investigations avec Olivier, et quelques verres de plus, le bug est trouvé, corrigé, et une <a href="https://github.com/ansible/ansible/pull/6518" rel="nofollow"><!--[-->pull-request<!--]--></a> ouverte sur le repository github de Ansible.<!--]--></p><p><!--[-->Cerise sur le gâteau, le code a été validé et mergé dans la journée qui a suivi, preuve que la communauté est bien réactive :)<!--]--></p><p><!--[--> Deuxième blocage, un peu plus long à diagnostiquer et à contourner, la prise en compte de la langue et des locales.<!--]--></p><p><!--[-->Notre use case : installation et configuration d’une base de données Postgresql sous Debian 7 avec Ansible. Systématiquement, l’installation échoue et renvoie des warnings peu lisibles sur des dizaines de lignes.<!--]--></p><p><!--[-->Ce qui était d’autant plus frustrant car l’installation se passait sans accrocs s’il elle était lancée directement sur le serveur !<!--]--></p><p><!--[-->Plusieurs heures de debug en mode essai / erreur ainsi que de longs moments de recherche dans la documentation Ansible et dans les forums nous ont orienté sur les soucis de langue et de locale. Nos nerfs ont été mis à rude épreuve !<!--]--></p><p><!--[--><strong><!--[-->Explication<!--]--></strong>: l’installation de Postgresql a besoin d’une langue pour initialiser un cluster par défaut.<!--]--></p><p><!--[-->D’un autre coté, pour éviter un certain de nombre de souci avec les locales et l’encodage, Ansible positionne les variables d’environnements LANG et LC_* à la variable standard “C”.<!--]--></p><p><!--[--><strong><!--[-->Solution de contournement:<!--]--></strong><!--]--></p><p><!--[-->Pour le moment on a modifié la task Ansible pour renseigner la locale et installer le package postgresql avec une commande shell. Ce hack n&#39;est pas satisfaisant car on court circuite le module apt d’installation de paquet. Mais ça fonctionne...<!--]--></p><h2 id="avis-après-un-jour-et-demi-dutilisation"><a href="#avis-après-un-jour-et-demi-dutilisation"><!--[-->Avis après un jour et demi d’utilisation<!--]--></a></h2><p><!--[-->Ok, c’est un peu court pour se faire un avis. Heureusement nous avons été bien guidé par Olivier et Jonathan pour avancer.<!--]--></p><p><!--[-->Pour ma part j’ai beaucoup plus galéré qu’avec Fabric, surtout car j’ai du bosser entièrement sur la VM avec vim et me passer de Sublime Text. Ce ne sont pas les conditions optimales pour moi :)<!--]--></p><p><!--[-->Malgré tout, j’ai désormais un playbook fonctionnel me permettant d’installer postgresql, java et jira. Ce playbook a pu être testé sur une VM puis ensuite sur une machine OVH.<!--]--></p><p><!--[-->Il y a peu de prérequis sur la machine cible, une clé SSH à configurer et Python. Ca reste léger.<!--]--></p><p><!--[-->Dans l’ensemble je sens que j’ai encore pas mal de boulot pour faire un playbook dans les rêgles de l’art, utiliser les dépendances proprement, les templates etc.. Mais la doc semble assez complète et l’outil semble assez prometteur.<!--]--></p><p><!--[-->Je compte bien le réutiliser pour des besoins plus lourd assez prochainement.<!--]--></p></div></div></div></div><hr class="mb-12"><div><span> Partager sur : </span><div class="mt-4"><a href="https://facebook.com/sharer/sharer.php?u=https://eventuallycoding.com/2014/03/17/ansible-timeoff-lt-1ere-journee" target="_blank" rel="noopener" aria-label=""><button type="button" class="text-white bg-[#3b5998] hover:bg-[#3b5998]/90 focus:ring-4 focus:outline-none focus:ring-[#3b5998]/50 font-medium rounded-lg text-sm px-3 py-3 text-center inline-flex items-center dark:focus:ring-[#3b5998]/55 mr-2 mb-2"><svg class="w-6 h-6" aria-hidden="true" focusable="false" data-prefix="fab" data-icon="facebook-f" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M279.1 288l14.22-92.66h-88.91v-60.13c0-25.35 12.42-50.06 52.24-50.06h40.42V6.26S260.4 0 225.4 0c-73.22 0-121.1 44.38-121.1 124.7v70.62H22.89V288h81.39v224h100.2V288z"></path></svg></button></a><a href="https://twitter.com/share?url=https://eventuallycoding.com/2014/03/17/ansible-timeoff-lt-1ere-journee&amp;text=Ansible (timeoff LT 1ère journée)&amp;via=hugolassiege" target="_blank" title="Share on Twitter" rel="noopener noreferrer"><button type="button" class="text-white bg-[#1da1f2] hover:bg-[#1da1f2]/90 focus:ring-4 focus:outline-none focus:ring-[#1da1f2]/50 font-medium rounded-lg text-sm px-3 py-3 text-center inline-flex items-center dark:focus:ring-[#1da1f2]/55 mr-2 mb-2"><svg class="w-6 h-6" aria-hidden="true" focusable="false" data-prefix="fab" data-icon="twitter" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M459.4 151.7c.325 4.548 .325 9.097 .325 13.65 0 138.7-105.6 298.6-298.6 298.6-59.45 0-114.7-17.22-161.1-47.11 8.447 .974 16.57 1.299 25.34 1.299 49.06 0 94.21-16.57 130.3-44.83-46.13-.975-84.79-31.19-98.11-72.77 6.498 .974 12.99 1.624 19.82 1.624 9.421 0 18.84-1.3 27.61-3.573-48.08-9.747-84.14-51.98-84.14-102.1v-1.299c13.97 7.797 30.21 12.67 47.43 13.32-28.26-18.84-46.78-51.01-46.78-87.39 0-19.49 5.197-37.36 14.29-52.95 51.65 63.67 129.3 105.3 216.4 109.8-1.624-7.797-2.599-15.92-2.599-24.04 0-57.83 46.78-104.9 104.9-104.9 30.21 0 57.5 12.67 76.67 33.14 23.72-4.548 46.46-13.32 66.6-25.34-7.798 24.37-24.37 44.83-46.13 57.83 21.12-2.273 41.58-8.122 60.43-16.24-14.29 20.79-32.16 39.31-52.63 54.25z"></path></svg></button></a></div></div><!----><div id="hyvor-talk-view"></div></div></div><!--]--><!--]--><footer class="lg:mt-52 border-t border-t-2"><div class="flex flex-col items-center mt-16"><div class="flex mb-3 space-x-4"><a target="_self" href="/rss.xml" class="text-sm text-gray-500 transition hover:text-gray-600"><img class="transition-transform hover:scale-110 w-8 h-8" src="/_nuxt/rss.9e0b880c.svg"></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="me" href="https://piaille.fr/@hugolassiege"><span class="sr-only">Mastodon</span><img class="transition-transform hover:scale-110 w-8 h-8" src="/_nuxt/mastodon.f0ecdde8.svg"></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="nofollow noopener noreferrer" href="https://github.com/hlassiege"><span class="sr-only">github</span><img class="transition-transform hover:scale-110 w-8 h-8" src="/_nuxt/github_new.4e3fe23c.svg"></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://www.linkedin.com/in/hugolassiege/"><span class="sr-only">Linkedin</span><img class="transition-transform hover:scale-110 w-8 h-8" src="/_nuxt/linkeding.34c3bc6d.svg"></a><a target="_blank" rel="nofollow noopener noreferrer" href="https://twitter.com/hugolassiege" class="text-sm text-gray-500 transition hover:text-gray-600"><img class="transition-transform hover:scale-110 w-8 h-8" src="/_nuxt/twitter.457cff27.svg"></a></div><div class="flex mb-2 space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>Copyright © 2023</div><div>•</div> EventuallyCoding - A la fin de l&#39;envoi, je code !</div><div class="text-sm text-gray-500">Credits to www.freepik.com - <a href="https://www.freepik.com/vectors/citizen">Citizen vector created by freepik - </a><a href="https://www.freepik.com/vectors/css">Css vector created by vectorjuice</a></div></div></footer></div></section><!--]--></div><script type="module">import p from "/2014/03/17/ansible-timeoff-lt-1ere-journee/_payload.js";window.__NUXT__={...p,...((function(a,b){return {state:{},_errors:{},serverRendered:true,config:{public:{content:{locales:[],integrity:1674409782790,experimental:{stripQueryParameters:a,clientDB:a},api:{baseURL:"\u002Fapi\u002F_content"},navigation:{fields:[]},tags:{p:"prose-p",a:"prose-a",blockquote:"prose-blockquote","code-inline":"prose-code-inline",code:"prose-code",em:"prose-em",h1:"prose-h1",h2:"prose-h2",h3:"prose-h3",h4:"prose-h4",h5:"prose-h5",h6:"prose-h6",hr:"prose-hr",img:"prose-img",ul:"prose-ul",ol:"prose-ol",li:"prose-li",strong:"prose-strong",table:"prose-table",thead:"prose-thead",tbody:"prose-tbody",td:"prose-td",th:"prose-th",tr:"prose-tr"},highlight:a,wsUrl:b,documentDriven:a,anchorLinks:{depth:4,exclude:[1]}}},app:{baseURL:"\u002F",buildAssetsDir:"\u002F_nuxt\u002F",cdnURL:b}},prerenderedAt:1674409819275}}(false,"")))}</script><script type="module" src="/_nuxt/entry.e7b0454d.js" crossorigin></script><script type="module" src="/_nuxt/default.b93ff253.js" crossorigin></script><script type="module" src="/_nuxt/TheHeader.cc500634.js" crossorigin></script><script type="module" src="/_nuxt/_id_.0d97d705.js" crossorigin></script><script type="module" src="/_nuxt/TheFooter.1c4a0619.js" crossorigin></script><script type="module" src="/_nuxt/HeroSection.c616fa1b.js" crossorigin></script><script type="module" src="/_nuxt/PageSidebar.9631623c.js" crossorigin></script><script type="module" src="/_nuxt/Dropdown.c153f2cd.js" crossorigin></script><script type="module" src="/_nuxt/ContentRenderer.df92f22a.js" crossorigin></script><script type="module" src="/_nuxt/ContentRendererMarkdown.5958bac8.js" crossorigin></script><script type="module" src="/_nuxt/ProseP.1ed949d6.js" crossorigin></script><script type="module" src="/_nuxt/ProseEm.62123932.js" crossorigin></script><script type="module" src="/_nuxt/ProseA.fcebd916.js" crossorigin></script><script type="module" src="/_nuxt/ProseStrong.5c1c96ee.js" crossorigin></script><script type="module" src="/_nuxt/ProseUl.12544acc.js" crossorigin></script><script type="module" src="/_nuxt/ProseLi.4b79e2fb.js" crossorigin></script><script type="module" src="/_nuxt/ProseImg.6713cd03.js" crossorigin></script><script type="module" src="/_nuxt/ProseH2.f05407d5.js" crossorigin></script></body>
</html>
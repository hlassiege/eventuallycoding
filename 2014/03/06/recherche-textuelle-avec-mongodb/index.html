<!DOCTYPE html>
<html lang="fr">
<head><meta charset="utf-8">
<title>Recherche textuelle avec MongoDB | EventuallyCoding</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://digianalytics.fr/js/script.js" data-host="https://digianalytics.fr" id="ZwSg9rf6GA" async="" defer="" type="text/javascript"></script>
<meta name="description" content="[![mongo](/images/af912-mongo.jpg)](http://eventuallycoding.com/wp-content/uploads/2014/01/af912-mongo.jpg)Il y a maintenant 2 ans nous avions choisi ...">
<meta name="og:description" content="[![mongo](/images/af912-mongo.jpg)](http://eventuallycoding.com/wp-content/uploads/2014/01/af912-mongo.jpg)Il y a maintenant 2 ans nous avions choisi ...">
<meta name="og:type" content="article">
<meta name="og:title" content="Recherche textuelle avec MongoDB">
<meta name="og:url" content="https://eventuallycoding.com/2014/03/06/recherche-textuelle-avec-mongodb">
<meta name="og:image" content="https://eventuallycoding.com/images/covers/cover1.jpg">
<meta name="og:image:alt" content="Recherche textuelle avec MongoDB">
<meta name="twitter:text:title" content="Recherche textuelle avec MongoDB">
<meta name="twitter:image" content="https://eventuallycoding.com/images/covers/cover1.jpg">
<meta name="twitter:card" content="summary">
<meta name="article:published_time" content="2014-03-06T00:00:00.000Z">
<meta name="article:article:modified_time" content="2014-03-06T00:00:00.000Z">
<meta name="article:article:tag" content="mongodb">
<link rel="canonical" href="https://eventuallycoding.com/2014/03/06/recherche-textuelle-avec-mongodb">
<link rel="alternate" href="https://eventuallycoding.com/2014/03/06/recherche-textuelle-avec-mongodb" hreflang="fr"><link rel="modulepreload" href="/2014/03/06/recherche-textuelle-avec-mongodb/_payload.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/entry.7d332305.js"><link rel="preload" as="style" href="/_nuxt/entry.874fac0a.css"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/default.df2a0245.js"><link rel="preload" as="style" href="/_nuxt/TheHeader.e21518f4.css"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/nuxt-link.4ca7743c.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/siteMetaData.b74feb44.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/_id_.52b9300e.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/Dropdown.7603ce00.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/_commonjsHelpers.28e086c5.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ContentRenderer.1d8dc26d.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ContentRendererMarkdown.f17ceaa4.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/index.a6ef77ff.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/query.bd54ed15.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/index.61d74bb5.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/utils.cd29e8b1.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/composables.1b995239.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseP.76194ecd.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseA.d6665fdd.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseStrong.b1095715.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseUl.914a0c72.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseLi.e54c74a2.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseH2.264e0d6d.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseImg.4d9cd443.js"><link rel="prefetch" as="script" crossorigin href="/_nuxt/error-component.e0a58dac.js"><link rel="prefetch" as="image" type="image/svg+xml" href="/_nuxt/github_new.4e3fe23c.svg"><link rel="prefetch" as="image" type="image/svg+xml" href="/_nuxt/rss.9e0b880c.svg"><link rel="prefetch" as="image" type="image/svg+xml" href="/_nuxt/mastodon.f0ecdde8.svg"><link rel="prefetch" as="image" type="image/svg+xml" href="/_nuxt/linkeding.34c3bc6d.svg"><link rel="prefetch" as="image" type="image/svg+xml" href="/_nuxt/twitter.457cff27.svg"><link rel="stylesheet" href="/_nuxt/entry.874fac0a.css"><link rel="stylesheet" href="/_nuxt/TheHeader.e21518f4.css"><style>.inverted[data-v-a060ef80]{--tw-bg-opacity:1;background-color:rgb(248 250 252/var(--tw-bg-opacity))}.inverted .font-to-invert-to-pink[data-v-a060ef80]{color:rgb(236 72 153/var(--tw-text-opacity))}.inverted .font-to-invert-to-black[data-v-a060ef80],.inverted .font-to-invert-to-pink[data-v-a060ef80]{--tw-text-opacity:1;transition-duration:.15s;transition-property:all;transition-timing-function:cubic-bezier(.4,0,.2,1)}.inverted .font-to-invert-to-black[data-v-a060ef80]{color:rgb(51 65 85/var(--tw-text-opacity))}.inverted .font-to-invert-to-black[data-v-a060ef80]:hover{--tw-text-opacity:1;color:rgb(255 255 255/var(--tw-text-opacity))}.link[data-v-a060ef80]{display:block;font-size:1rem;font-weight:500;line-height:1.5rem;overflow:hidden;padding-left:.75rem;padding-right:.75rem;position:relative;text-decoration:none}.link.NuxtLink-exact-active[data-v-a060ef80]:after{bottom:-2px;height:100%;left:0;width:100%}.link[data-v-a060ef80]:after{background:rgba(236,64,122,.25);bottom:-6px;content:"";height:calc(100% - 8px);left:18px;position:absolute;transition:.35s cubic-bezier(.25,.1,0,2.05);width:calc(100% - 8px);z-index:-1}.link[data-v-a060ef80]:hover:after{bottom:-2px;height:100%;left:0;width:100%}</style><style>.nuxt-content h2{font-size:28px;font-weight:700}.nuxt-content h3{font-size:22px;font-weight:700}.nuxt-content p{margin-bottom:20px}</style></head>
<body ><div id="__nuxt"><!--[--><section class="w-full pb-12 antialiased"><div class="mx-auto max-w-8xl"><div data-v-a060ef80><nav id="header-menu" class="transition-colors fixed w-full z-10 top-0 inverted" data-v-a060ef80><div class="max-w-7xl mx-auto px-2 sm:px-6 lg:px-8" data-v-a060ef80><div class="relative flex items-center justify-between h-16" data-v-a060ef80><div class="absolute inset-y-0 left-0 flex items-center sm:hidden" data-v-a060ef80><button type="button" class="inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-white hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-white" aria-controls="mobile-menu" aria-expanded="false" data-v-a060ef80><span class="sr-only" data-v-a060ef80>Open main menu</span><svg class="block h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" data-v-a060ef80><path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" data-v-a060ef80></path></svg><svg class="hidden h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" data-v-a060ef80><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" data-v-a060ef80></path></svg></button></div><div class="flex-1 flex items-center justify-center sm:items-stretch sm:justify-start" data-v-a060ef80><div class="flex-shrink-0 flex items-center" data-v-a060ef80><span class="text-white text-base font-medium font-bruno text-2xl font-to-invert-to-pink" data-v-a060ef80><a href="/" class="" data-v-a060ef80>EventuallyCoding.com</a></span></div><div class="hidden sm:block sm:ml-6 absolute right-0 font-mark" data-v-a060ef80><div class="flex space-x-4" data-v-a060ef80><!--[--><a href="/speaking" class="link text-white font-to-invert-to-black" data-v-a060ef80>Speaking</a><a href="/blog" class="link text-white font-to-invert-to-black" data-v-a060ef80>Writing</a><a href="/resources" class="link text-white font-to-invert-to-black" data-v-a060ef80>Resources</a><a href="/about" class="link text-white font-to-invert-to-black" data-v-a060ef80>About</a><!--]--></div></div></div></div></div><div class="hidden" data-v-a060ef80><div class="px-2 pt-2 pb-3 space-y-1" data-v-a060ef80><!--[--><a href="/speaking" class="text-white hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium font-to-invert-to-black" data-v-a060ef80>Speaking</a><a href="/blog" class="text-white hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium font-to-invert-to-black" data-v-a060ef80>Writing</a><a href="/resources" class="text-white hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium font-to-invert-to-black" data-v-a060ef80>Resources</a><a href="/about" class="text-white hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium font-to-invert-to-black" data-v-a060ef80>About</a><!--]--></div></div></nav></div><!--[--><!--[--><div><div class="flex justify-center mt-24"><img src="/images/covers/cover1.jpg" alt="Recherche textuelle avec MongoDB" class="object-cover w-96"></div><div class="px-4 mx-auto sm:px-6 xl:max-w-7xl xl:px-0 mt-10"><div><h1 class="text-4xl text-gray-700 font-extrabold text-center mb-3">Recherche textuelle avec MongoDB</h1><p class="text-slate-400 text-center mb-1"><!----></p><div class="grid grid-cols-3 text-center sm:w-full md:w-1/2 mx-auto"><div><p class="text-center font-bold my-4 text-slate-400 text-xs"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline-block" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg> March 6, 2014</p></div><div><p class="text-center font-bold my-4 text-slate-400 text-xs"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline-block" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> 6 min read</p></div><div class="flex items-center font-medium sm:mx-3 justify-center"><img src="/hugo-nb.jpg" loading="lazy" alt="" class="mr-3 w-10 h-10 rounded-full bg-slate-50 dark:bg-slate-800"><div><div class="font-bold text-slate-400 text-xs">Hugo Lassiège</div><a target="_blank" href="https://twitter.com/hugolassiege" class="font-bold text-sky-400 text-xs hover:text-sky-600"> @hugolassiege</a></div></div></div></div><div class="text-left mx-auto"><div class="flex flex-wrap lg:flex-row-reverse py-12"><div class="w-full lg:w-1/4 px-5"><div class="lg:sticky top-0 pt-5 -mt-5 font-proxima"><div class="toc hidden lg:block"><p class="border-b-4 pb-3 mb-3 border-gray-200 text-xl"> On this page </p><ul class="pl-0"><!--[--><li class="py-1"><a class="hover:text-smalt-blue-700" href="#avant-la-24">Avant la 2.4</a></li><li class="py-1"><a class="hover:text-smalt-blue-700" href="#depuis-la-24">Depuis la 2.4</a></li><!--]--></ul></div><div class="text-right mb-12"><div class="relative inline-block text-left ml-2 block lg:hidden"><div><span class="rounded-md shadow-sm"><button type="button" class="inline-flex justify-center w-full rounded-md border border-gray-300 px-4 py-2 bg-white text-sm leading-5 font-medium text-black hover:text-white hover:bg-smalt-blue-500 focus:outline-none transition ease-in-out duration-150" aria-haspopup="true" aria-expanded="true"><!--[-->On this page<!--]--><svg class="-mr-1 ml-2 h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></span></div><!----></div></div></div></div><div class="lg:w-3/4 w-full px-5 max-w-none centered-image"><div id="nuxtContent" class="prose font-proxima text-sm md:text-xl font-medium min-w-full md:p-10 mx-auto"><p><!--[--><a href="http://eventuallycoding.com/wp-content/uploads/2014/01/af912-mongo.jpg" rel="nofollow"><!--[--><img src="/images/af912-mongo.jpg" alt="mongo"><!--]--></a>Il y a maintenant 2 ans nous avions choisi d&#39;utiliser MongoDB sur <a href="http://www.hopwork.com" rel="nofollow"><!--[-->HopWork<!--]--></a> à l&#39;issu <a href="http://www.eventuallycoding.com/index.php/nosql-4-bases-a-la-loupe-14/" rel="nofollow" title="Nosql, 4 bases à la loupe 1/4"><!--[-->d&#39;une petite série d&#39;expérimentation<!--]--></a>. Cette base m&#39;avait séduit pour ces puissantes fonctionnalités de requêtage et sa facilité de mise en oeuvre. Dans ce billet j&#39;aimerais revenir sur les fonctionnalités de recherche textuelles de MongoDB car, si elles sont puissantes, elles comportement aussi quelques pièges.<!--]--></p><p><!--[-->Voyons d&#39;abord notre jeu de données. Il s&#39;agit de document JSON. J&#39;ai pris l&#39;ensemble des membres de <a href="http://www.lateral-thoughts.com" rel="nofollow"><!--[-->www.lateral-thoughts.com<!--]--></a> comme profiles dans ma collection MongoDB :<!--]--></p><p><!--[-->db.profile.find()
{ &quot;_id&quot; : ObjectId(&quot;5315c3437fec2f001e01c882&quot;), &quot;firstName&quot; : &quot;Hugo&quot;, &quot;lastName&quot; : &quot;Lassiege&quot; }
{ &quot;_id&quot; : ObjectId(&quot;5315c3567fec2f001e01c883&quot;), &quot;firstName&quot; : &quot;Jean-Baptiste&quot;, &quot;lastName&quot; : &quot;Lemée&quot; }
{ &quot;_id&quot; : ObjectId(&quot;5315c3647fec2f001e01c884&quot;), &quot;firstName&quot; : &quot;Olivier&quot;, &quot;lastName&quot; : &quot;Girardot&quot; }
{ &quot;_id&quot; : ObjectId(&quot;5315c36e7fec2f001e01c885&quot;), &quot;firstName&quot; : &quot;Florent&quot;, &quot;lastName&quot; : &quot;Biville&quot; }
{ &quot;_id&quot; : ObjectId(&quot;5315c3777fec2f001e01c886&quot;), &quot;firstName&quot; : &quot;Nicolas&quot;, &quot;lastName&quot; : &quot;Rey&quot; }
{ &quot;_id&quot; : ObjectId(&quot;5315c37f7fec2f001e01c887&quot;), &quot;firstName&quot; : &quot;Vincent&quot;, &quot;lastName&quot; : &quot;Doba&quot; }
{ &quot;_id&quot; : ObjectId(&quot;5315c38a7fec2f001e01c888&quot;), &quot;firstName&quot; : &quot;Jonathan&quot;, &quot;lastName&quot; : &quot;Dray&quot; }
{ &quot;_id&quot; : ObjectId(&quot;5315c3937fec2f001e01c889&quot;), &quot;firstName&quot; : &quot;Stuart&quot;, &quot;lastName&quot; : &quot;Corring&quot; }<!--]--></p><p><!--[-->Faisons une première recherche simple pour trouver une personne par son nom de famille :<!--]--></p><p><!--[-->db.profile.find({lastName:&quot;Lassiege&quot;})
{ &quot;_id&quot; : ObjectId(&quot;5315c3437fec2f001e01c882&quot;), &quot;firstName&quot; : &quot;Hugo&quot;, &quot;lastName&quot; : &quot;Lassiege&quot; }<!--]--></p><p><!--[-->Fonctionnellement, cette recherche est équivalent à utiliser l&#39;opération $in :<!--]--></p><p><!--[-->db.profile.find({lastName : {$in:[&quot;Lassiege&quot;]}})
{ &quot;_id&quot; : ObjectId(&quot;5315c3437fec2f001e01c882&quot;), &quot;firstName&quot; : &quot;Hugo&quot;, &quot;lastName&quot; : &quot;Lassiege&quot; }<!--]--></p><p><!--[-->Jusqu&#39;ici tout va bien. Regardons cependant nos deux requêtes avec un explain plan :<!--]--></p><p><!--[-->db.profile.find({lastName:&quot;Lassiege&quot;}).explain()
{
&quot;cursor&quot; : &quot;BasicCursor&quot;,
&quot;isMultiKey&quot; : false,
&quot;n&quot; : 1,
&quot;nscannedObjects&quot; : 8,
&quot;nscanned&quot; : 8,
&quot;nscannedObjectsAllPlans&quot; : 8,
&quot;nscannedAllPlans&quot; : 8,
&quot;scanAndOrder&quot; : false,
&quot;indexOnly&quot; : false,
&quot;nYields&quot; : 0,
&quot;nChunkSkips&quot; : 0,
&quot;millis&quot; : 0,
&quot;indexBounds&quot; : {},
&quot;server&quot; : &quot;HUGO:27017&quot;
}<!--]--></p><p><!--[-->Cet explain plan nous indique que nous avons scanné nos 8 éléments pour trouver notre résultat. Pas très grave dans le cas présent, mais parcourir l&#39;ensemble des éléments d&#39;une collection sera rapidement problématique sur une plus grosse volumétrie.<!--]--></p><p><!--[-->Nous allons poser un index pour résoudre ce point et améliorer nos recherches.<!--]--></p><p><!--[-->db.profile.ensureIndex({lastName : 1})
db.profile.find({lastName : {$in:[&quot;Lassiege&quot;]}}).explain()
{
&quot;cursor&quot; : &quot;BtreeCursor lastName_1&quot;,
&quot;isMultiKey&quot; : false,
&quot;n&quot; : 1,
&quot;nscannedObjects&quot; : 1,
&quot;nscanned&quot; : 1,
&quot;nscannedObjectsAllPlans&quot; : 1,
&quot;nscannedAllPlans&quot; : 1,
&quot;scanAndOrder&quot; : false,
&quot;indexOnly&quot; : false,
&quot;nYields&quot; : 0,
&quot;nChunkSkips&quot; : 0,
&quot;millis&quot; : 0,
&quot;indexBounds&quot; : {
&quot;lastName&quot; : [
[
&quot;Lassiege&quot;,
&quot;Lassiege&quot;
]
]
},
&quot;server&quot; : &quot;HUGO:27017&quot;
}<!--]--></p><p><!--[-->C&#39;est déjà mieux. Nos deux requêtes passent désormais par cet index et effectuent une seule lecture par l&#39;index.<!--]--></p><p><!--[-->Jusqu&#39;ici tout va bien.<!--]--></p><p><!--[-->Mettons que désormais nous choisissions de chercher &quot;<strong><!--[-->l<!--]--></strong>assiege&quot; et non &quot;<strong><!--[-->L<!--]--></strong>assiege&quot;.<!--]--></p><p><!--[-->db.profile.find({lastName:&quot;lassiege&quot;})<!--]--></p><p><!--[-->Aucun résultat... C&#39;est le drame. Il s&#39;agit d&#39;une recherche &quot;exacte&quot;.<!--]--></p><p><!--[-->Pour le fun, on pourrait utiliser une première méthode avec l&#39;opérateur <a href="http://docs.mongodb.org/manual/reference/operator/query/where/" rel="nofollow"><!--[-->$where<!--]--></a> :<!--]--></p><p><!--[-->db.profile.find( { $where: &quot;this.lastName.toUpperCase() == &#39;lassiege&#39;.toUpperCase()&quot; } );
{ &quot;_id&quot; : ObjectId(&quot;5315c3437fec2f001e01c882&quot;), &quot;firstName&quot; : &quot;Hugo&quot;, &quot;lastName&quot; : &quot;Lassiege&quot; }<!--]--></p><p><!--[-->Cet opérateur permet d&#39;appliquer une fonction Javascript pour évaluer si un élément match ou non.<!--]--></p><p><!--[-->Pour être clair, si cet opérateur est peu utilisé, il y a une raison. Il ne profite pas de l&#39;index posé sur la collection. On va vite oublier... <strong><!--[-->Il n&#39;est pas recommandé d&#39;utiliser cette technique.<!--]--></strong><!--]--></p><p><!--[-->Le lecteur malin qui a suivi le dernier lien vers la doc disséminé dans ce texte aura remarqué la présence de l&#39;opérateur $regex que l&#39;on pourrait utiliser pour notre recherche :<!--]--></p><p><!--[-->db.profile.find({lastName : {$regex: /lassiege/i}})
{ &quot;_id&quot; : ObjectId(&quot;5315c3437fec2f001e01c882&quot;), &quot;firstName&quot; : &quot;Hugo&quot;, &quot;lastName&quot; : &quot;Lassiege&quot; }<!--]--></p><p><!--[-->La regexp /lassiege/i permet en effet d&#39;effectuer une recherche non sensible à la casse. Malheureusement, cette recherche ne profite pas non plus de notre index.<!--]--></p><p><!--[-->A noter d&#39;ailleurs que les seules recherches avec une regexp qui profiteront de l&#39;index sont les requêtes du type &quot;Commençant par&quot; (avec un ^) et non case insensitive.<!--]--></p><p><!--[-->Bon alors, on ne peut pas rechercher efficacement de façon insensible à la casse ?<!--]--></p><p><!--[-->En réalité il existe deux techniques utilisées avec MongoDB.<!--]--></p><h2 id="avant-la-24"><a href="#avant-la-24"><!--[-->Avant la 2.4<!--]--></a></h2><p><!--[-->Comme très souvent avec MongoDB, la réponse consiste à dupliquer l&#39;information. Ainsi, une possibilité sera de stocker dans notre objet &quot;profile&quot; un champ last<strong><!--[-->n<!--]--></strong>ame contenant le champ last<strong><!--[-->N<!--]--></strong>ame mais normalisé selon notre besoin de recherche.<!--]--></p><p><!--[-->{ &quot;_id&quot; : ObjectId(&quot;5315c3437fec2f001e01c882&quot;), &quot;firstName&quot; : &quot;Hugo&quot;, &quot;lastName&quot; : &quot;Lassiege&quot;, &quot;lastname&quot; : &quot;lassiege&quot; }<!--]--></p><p><!--[-->Ce champ pourra être utilisé lors d&#39;une recherche avec un paramètre dont vous aurez changé la casse également.<!--]--></p><p><!--[-->Soyons clair, certains vont considérer que c&#39;est &quot;étrange&quot; mais c&#39;est la manière traditionnelle de le faire. <strong><!--[-->Et c&#39;est toujours la technique à privilégier aujourd&#39;hui.<!--]--></strong><!--]--></p><h2 id="depuis-la-24"><a href="#depuis-la-24"><!--[-->Depuis la 2.4<!--]--></a></h2><p><!--[-->Nous allons tirer parti d&#39;une nouvelle fonctionnalité qui a été introduite en 2.4 : les index full text. Et nous verrons que ce n&#39;est pas la panacée.<!--]--></p><p><!--[-->Tout d&#39;abord, il s&#39;agit d&#39;une fonctionnalité en statut béta, non recommandé en production. Il faut l&#39;activer au démarrage pour pouvoir l&#39;utiliser :<!--]--></p><p><!--[-->mongod --setParameter textSearchEnabled=true<!--]--></p><p><!--[-->Nous pouvons désormais ajouter cet index full text :<!--]--></p><p><!--[-->db.profile.ensureIndex({lastName : &quot;text&quot;})<!--]--></p><p><!--[-->La recherche va devoir être faite via une <strong><!--[-->commande<!--]--></strong> et non via la méthode find habituelle.<!--]--></p><p><!--[-->db.profile.runCommand(&quot;text&quot;, {search:&quot;lassiege&quot;})
{
&quot;queryDebugString&quot; : &quot;lassieg||||||&quot;,
&quot;language&quot; : &quot;english&quot;,
&quot;results&quot; : [
{
&quot;score&quot; : 1,
&quot;obj&quot; : {
&quot;_id&quot; : ObjectId(&quot;5315c3437fec2f001e01c882&quot;),
&quot;firstName&quot; : &quot;Hugo&quot;,
&quot;lastName&quot; : &quot;Lassiege&quot;,
&quot;lastname&quot; : &quot;lassiege&quot;
}
}
],
&quot;stats&quot; : {
&quot;nscanned&quot; : 1,
&quot;nscannedObjects&quot; : 0,
&quot;n&quot; : 1,
&quot;nfound&quot; : 1,
&quot;timeMicros&quot; : 285
},
&quot;ok&quot; : 1
}<!--]--></p><p><!--[-->A noter que l&#39;on retrouve la possibilité de faire des filtres, des projections, une limitation du nombre de résultat mais pas de tri. Car le tri est donné par la pertinence du résultat renvoyé par la recherche full text.<!--]--></p><p><!--[-->C&#39;est un peu dommage car c&#39;est assez peu homogène avec le reste. On aurait préféré passer par un find :<!--]--></p><ul><!--[--><li><!--[-->avec éventuellement l&#39;utilisation d&#39;un <a href="http://docs.mongodb.org/manual/reference/operator/meta/hint/" rel="nofollow"><!--[-->Hint<!--]--></a> pour forcer le passage par l&#39;index full text. db.profile.find(...).hint({lastname: &quot;text&quot;})<!--]--></li><li><!--[-->ou mieux, avec un opérateur spécifique $text db.profile.find({lastName : {$text : &quot;lassiege&quot;}})<!--]--></li><!--]--></ul><p><!--[-->Et on aurait aimé contrôler le tri pour utiliser nos propres tris si besoin.<!--]--></p><p><!--[-->Pour conclure sur les index Full Text. Il faut bien se méfier sur leur utilisation :<!--]--></p><ul><!--[--><li><!--[-->Ils sont plus gourmands en espace disque (on stocke tous les tokens)<!--]--></li><li><!--[-->Ils sont plus coûteux à l&#39;écriture (puisque MongoDB passe du temps à analyser vos termes et que le coût de stockage est plus lourd)<!--]--></li><li><!--[-->On ne peut pas avoir plusieurs index Full Text sur une collection. A la place on peut avoir uniquement un index Full Text qui regroupe plusieurs champs (la différence est importante)<!--]--></li><!--]--></ul><p><!--[-->En fait, pour ce cas d&#39;usage, où il s&#39;agit de gérer une recherche non sensible à la casse sur des noms de familles, la première méthode est la méthode à privilégier. Mais cela vous a peut-être permis de découvrir cette fonctionnalité.<!--]--></p><p><!--[-->Voilà c&#39;est terminé. Vous venez de voir différents opérateurs pour vos recherches, les pièges relatifs à l&#39;utilisation de certain d&#39;entre eux, l&#39;indexation et l&#39;indexation full text.<!--]--></p><p><!--[-->Vous pouvez retourner à vos claviers.<!--]--></p></div></div></div></div><div class="mt-10 text-slate-600 font-extrabold text-sm font-medium min-w-full mx-auto mb-2"><a href="https://github.com/hlassiege/eventuallycoding/blob/master/content/articles/2014/03/06/recherche-textuelle-avec-mongodb.md" rel="noopener noreferrer" target="_blank">Edit on Github <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 inline-block text-slate-600 -mt-1" viewBox="0 0 512 512"><path d="M320 0c-17.7 0-32 14.3-32 32s14.3 32 32 32h82.7L201.4 265.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L448 109.3V192c0 17.7 14.3 32 32 32s32-14.3 32-32V32c0-17.7-14.3-32-32-32H320zM80 32C35.8 32 0 67.8 0 112V432c0 44.2 35.8 80 80 80H400c44.2 0 80-35.8 80-80V320c0-17.7-14.3-32-32-32s-32 14.3-32 32V432c0 8.8-7.2 16-16 16H80c-8.8 0-16-7.2-16-16V112c0-8.8 7.2-16 16-16H192c17.7 0 32-14.3 32-32s-14.3-32-32-32H80z"></path></svg></a></div><hr class="mb-8"><div><span class="font-proxima text-sm md:text-xl font-medium"> Did you like this blog post? </span><div class="mt-4 flex flex-row"><div><a href="https://facebook.com/sharer/sharer.php?u=https://eventuallycoding.com/2014/03/06/recherche-textuelle-avec-mongodb" target="_blank" rel="noopener" aria-label="Share on Facebook"><button aria-label="Share on Facebook" type="button" class="text-white bg-[#3b5998] hover:bg-[#3b5998]/90 focus:ring-4 focus:outline-none focus:ring-[#3b5998]/50 font-medium rounded-lg text-sm px-3 py-3 text-center inline-flex items-center dark:focus:ring-[#3b5998]/55 mr-2 mb-2"><svg class="w-6 h-6" aria-hidden="true" focusable="false" data-prefix="fab" data-icon="facebook-f" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M279.1 288l14.22-92.66h-88.91v-60.13c0-25.35 12.42-50.06 52.24-50.06h40.42V6.26S260.4 0 225.4 0c-73.22 0-121.1 44.38-121.1 124.7v70.62H22.89V288h81.39v224h100.2V288z"></path></svg></button></a></div><div><a href="https://twitter.com/share?url=https://eventuallycoding.com/2014/03/06/recherche-textuelle-avec-mongodb&amp;text=Recherche textuelle avec MongoDB&amp;via=hugolassiege" target="_blank" title="Share on Twitter" rel="noopener noreferrer" aria-label="Share on Twitter"><button aria-label="Share on Twitter" type="button" class="text-white bg-[#1da1f2] hover:bg-[#1da1f2]/90 focus:ring-4 focus:outline-none focus:ring-[#1da1f2]/50 font-medium rounded-lg text-sm px-3 py-3 text-center inline-flex items-center dark:focus:ring-[#1da1f2]/55 mr-2 mb-2"><svg class="w-6 h-6" aria-hidden="true" focusable="false" data-prefix="fab" data-icon="twitter" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M459.4 151.7c.325 4.548 .325 9.097 .325 13.65 0 138.7-105.6 298.6-298.6 298.6-59.45 0-114.7-17.22-161.1-47.11 8.447 .974 16.57 1.299 25.34 1.299 49.06 0 94.21-16.57 130.3-44.83-46.13-.975-84.79-31.19-98.11-72.77 6.498 .974 12.99 1.624 19.82 1.624 9.421 0 18.84-1.3 27.61-3.573-48.08-9.747-84.14-51.98-84.14-102.1v-1.299c13.97 7.797 30.21 12.67 47.43 13.32-28.26-18.84-46.78-51.01-46.78-87.39 0-19.49 5.197-37.36 14.29-52.95 51.65 63.67 129.3 105.3 216.4 109.8-1.624-7.797-2.599-15.92-2.599-24.04 0-57.83 46.78-104.9 104.9-104.9 30.21 0 57.5 12.67 76.67 33.14 23.72-4.548 46.46-13.32 66.6-25.34-7.798 24.37-24.37 44.83-46.13 57.83 21.12-2.273 41.58-8.122 60.43-16.24-14.29 20.79-32.16 39.31-52.63 54.25z"></path></svg></button></a></div><div class=""><a href="https://www.buymeacoffee.com/hlassiege" target="_blank"><img src="https://cdn.buymeacoffee.com/buttons/v2/default-red.png" alt="Buy Me A Coffee" style="height:48px !important;width:209px !important;"></a></div></div></div><div id="hyvor-talk-view"></div></div></div><!--]--><!--]--><footer class="lg:mt-40 border-t border-t-2"><div class="flex flex-col items-center mt-16"><div class="flex mb-3 space-x-4"><a aria-label="Open RSS feed" target="_self" href="/rss.xml" class="text-sm text-gray-500 transition hover:text-gray-600"><img alt="RSS" class="transition-transform hover:scale-110 w-8 h-8" src="/_nuxt/rss.9e0b880c.svg"></a><a aria-label="Open Mastodon profile" class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="me" href="https://piaille.fr/@hugolassiege"><span class="sr-only">Mastodon</span><img alt="Mastodon" class="transition-transform hover:scale-110 w-8 h-8" src="/_nuxt/mastodon.f0ecdde8.svg"></a><a aria-label="Open github profile" class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="nofollow noopener noreferrer" href="https://github.com/hlassiege"><span class="sr-only">github</span><img alt="github" class="transition-transform hover:scale-110 w-8 h-8" src="/_nuxt/github_new.4e3fe23c.svg"></a><a aria-label="Open linkedin profile" class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://www.linkedin.com/in/hugolassiege/"><span class="sr-only">Linkedin</span><img alt="Linkedin" class="transition-transform hover:scale-110 w-8 h-8" src="/_nuxt/linkeding.34c3bc6d.svg"></a><a aria-label="Open twitter profile" target="_blank" rel="nofollow noopener noreferrer" href="https://twitter.com/hugolassiege" class="text-sm text-gray-500 transition hover:text-gray-600"><img alt="Twitter" class="transition-transform hover:scale-110 w-8 h-8" src="/_nuxt/twitter.457cff27.svg"></a></div><div class="flex mb-2 space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>Copyright © 2023</div><div>•</div> EventuallyCoding - A la fin de l&#39;envoi, je code !</div><div class="text-sm text-gray-500"> Credits to www.freepik.com - <a href="https://www.freepik.com/vectors/citizen">Citizen vector created by freepik - </a><a href="https://www.freepik.com/vectors/css">Css vector created by vectorjuice</a></div></div></footer></div></section><!--]--></div><script type="module">import p from "/2014/03/06/recherche-textuelle-avec-mongodb/_payload.js";window.__NUXT__={...p,...((function(a,b){return {state:{},_errors:{},serverRendered:true,config:{public:{content:{locales:[],defaultLocale:b,integrity:1678315877341,experimental:{stripQueryParameters:a,clientDB:a},api:{baseURL:"\u002Fapi\u002F_content"},navigation:{fields:[]},tags:{p:"prose-p",a:"prose-a",blockquote:"prose-blockquote","code-inline":"prose-code-inline",code:"prose-code",em:"prose-em",h1:"prose-h1",h2:"prose-h2",h3:"prose-h3",h4:"prose-h4",h5:"prose-h5",h6:"prose-h6",hr:"prose-hr",img:"prose-img",ul:"prose-ul",ol:"prose-ol",li:"prose-li",strong:"prose-strong",table:"prose-table",thead:"prose-thead",tbody:"prose-tbody",td:"prose-td",th:"prose-th",tr:"prose-tr"},highlight:a,wsUrl:b,documentDriven:a,host:b,trailingSlash:a,anchorLinks:{depth:4,exclude:[1]}}},app:{baseURL:"\u002F",buildAssetsDir:"\u002F_nuxt\u002F",cdnURL:b}},prerenderedAt:1678315913321}}(false,"")))}</script><script type="module" src="/_nuxt/entry.7d332305.js" crossorigin></script><script type="module" src="/_nuxt/default.df2a0245.js" crossorigin></script><script type="module" src="/_nuxt/_id_.52b9300e.js" crossorigin></script><script type="module" src="/_nuxt/ContentRenderer.1d8dc26d.js" crossorigin></script><script type="module" src="/_nuxt/ContentRendererMarkdown.f17ceaa4.js" crossorigin></script><script type="module" src="/_nuxt/ProseP.76194ecd.js" crossorigin></script><script type="module" src="/_nuxt/ProseA.d6665fdd.js" crossorigin></script><script type="module" src="/_nuxt/ProseStrong.b1095715.js" crossorigin></script><script type="module" src="/_nuxt/ProseUl.914a0c72.js" crossorigin></script><script type="module" src="/_nuxt/ProseLi.e54c74a2.js" crossorigin></script><script type="module" src="/_nuxt/ProseH2.264e0d6d.js" crossorigin></script><script type="module" src="/_nuxt/ProseImg.4d9cd443.js" crossorigin></script></body>
</html>
[{"data":1,"prerenderedAt":328},["Reactive",2],{"/articles/2011/10/06/nemrod-et-play-framework-love-story-nemrod-55":3},{"_path":4,"_dir":5,"_draft":6,"_partial":6,"_locale":7,"title":8,"description":9,"id":10,"date":11,"categories":12,"tags":14,"cover":18,"readingTime":19,"body":24,"_type":323,"_id":324,"_source":325,"_file":326,"_extension":327},"/articles/2011/10/06/nemrod-et-play-framework-love-story-nemrod-55","06",false,"","Nemrod et Play Framework : love story (Nemrod 5/5)","J’ai découvert Play Framework en version 1...","417","2011-10-06",[13],"waza",[15,16,17],"localizeyourapps","nemrod","play","logo-web.png",{"text":20,"minutes":21,"time":22,"words":23},"7 min read",6.985,419100,1397,{"type":25,"children":26,"toc":303},"root",[27,41,57,62,67,74,81,86,92,106,112,123,131,137,142,148,153,158,163,169,174,180,185,191,196,201,206,212,218,223,228,238,243,257,265,271,276,282,287,293,298],{"type":28,"tag":29,"props":30,"children":31},"element","p",{},[32,38],{"type":28,"tag":33,"props":34,"children":37},"img",{"alt":7,"src":35,"title":36},"/images/logo-web.png","logo-web",[],{"type":39,"value":40},"text"," J’ai découvert Play Framework en version 1.0 (octobre 2009 si j’en crois la release notes) et j’avais tout de suite adhéré au concept. Sa productivité m’a tout de suite rappelé mes lointaines années où je faisais du PHP avec les avantages du Java en plus. Mais ça n’était encore qu’une version 1.0, pas très reconnu et avec de belles inconnues concernant son utilisation sur une application conséquente.",{"type":28,"tag":29,"props":42,"children":43},{},[44,46,55],{"type":39,"value":45},"Le temps a passé, ",{"type":28,"tag":47,"props":48,"children":52},"a",{"href":49,"rel":50},"http://www.playframework.org/",[51],"nofollow",[53],{"type":39,"value":54},"Play Framework",{"type":39,"value":56}," a 2 ans d’existence, sa stack s’est étoffé de pas mal de modules et on commence à trouver des applications qui l’utilisent.",{"type":28,"tag":29,"props":58,"children":59},{},[60],{"type":39,"value":61},"Bref, si vous vous rappelez ce qui avait été dit dans les chapitres précédents, l’objectif était de développer vite, de voir rapidement une idée se matérialiser sur une page web. Il était hors de question de créer 5 fichiers java, 3 fichiers xml et je ne sais quoi encore pour avoir un résultat. On perd vite de vue l’objectif quand on met longtemps à le réaliser.",{"type":28,"tag":29,"props":63,"children":64},{},[65],{"type":39,"value":66},"Allez, maintenant dans le détail, voici ce qui nous a plus et moins plu sur Play Framework. Attention, ceci n’est pas un tutorial d’utilisation de Play Framework mais uniquement un retour d’expérience.",{"type":28,"tag":68,"props":69,"children":71},"h2",{"id":70},"ce-quon-a-aimé",[72],{"type":39,"value":73},"Ce qu'on a aimé",{"type":28,"tag":75,"props":76,"children":78},"h3",{"id":77},"la-compilation-à-chaud",[79],{"type":39,"value":80},"La compilation à chaud",{"type":28,"tag":29,"props":82,"children":83},{},[84],{"type":39,"value":85},"Sans doute l’un des points les plus importants. Je ne vais pas le détailler c’est sans doute celui que tout le monde connaît. Une modif dans le code, pas de relance de serveur, un F5 sur la page et tout est recompilé. Encore plus puissant que PHP si vous avez activé le mode update de JPA puisque vous n’avez même pas à faire vos ALTER en base de données. Au pire, même si vous relancez le serveur si par exemple la sémantique de vos données à changé, on est loin du temps de redémarrage d’un serveur “classique”, 10 secondes sur mon poste.",{"type":28,"tag":75,"props":87,"children":89},{"id":88},"les-intercepteurs",[90],{"type":39,"value":91},"Les intercepteurs",{"type":28,"tag":29,"props":93,"children":94},{},[95,97,104],{"type":39,"value":96},"Play Framework utilise (certains disent “abuse”) de la programmation par aspect. Pour les actions écrites dans les contrôleurs, vous pouvez donc définir des comportements via les intercepteurs : @After, @Before, @Catch, @Finally Et vous pouvez écrire vos propres intercepteurs avec @With. Tout le module de sécurité de ",{"type":28,"tag":47,"props":98,"children":101},{"href":99,"rel":100},"http://www.localizeyourapps.com",[51],[102],{"type":39,"value":103},"Localizeyourapps",{"type":39,"value":105}," utilise une extension du module Secure qui fonctionne sur ce principe.",{"type":28,"tag":75,"props":107,"children":109},{"id":108},"les-redirections",[110],{"type":39,"value":111},"Les redirections",{"type":28,"tag":29,"props":113,"children":114},{},[115,117],{"type":39,"value":116},"Vous avez déjà fait du Struts ? Vous vous rappelez du fichier qui définit toute la navigation et des ActionForward ? La même chose avec Play Framework : ",{"type":28,"tag":118,"props":119,"children":120},"code",{"className":7},[121],{"type":39,"value":122},"public static void show(Long id) { Client client = Client.findById(id); render(client); }",{"type":28,"tag":29,"props":124,"children":125},{},[126],{"type":28,"tag":118,"props":127,"children":128},{"className":7},[129],{"type":39,"value":130},"public static void create(String name) { Client client = new Client(name); client.save(); // On redirige vers la page qui montre le client juste en appelant la méthode du contrôleur ! show(client.id); }",{"type":28,"tag":75,"props":132,"children":134},{"id":133},"les-validateurs",[135],{"type":39,"value":136},"Les validateurs",{"type":28,"tag":29,"props":138,"children":139},{},[140],{"type":39,"value":141},"Par défaut l’API est déjà très sympa pour valider les formulaires. Vous rajoutez à cela les validateurs custom et le module Jquery Validation et vous avez un framework très puissant pour la gestion de vos formulaires.",{"type":28,"tag":75,"props":143,"children":145},{"id":144},"les-jobs",[146],{"type":39,"value":147},"Les jobs",{"type":28,"tag":29,"props":149,"children":150},{},[151],{"type":39,"value":152},"Lancer un job toutes les heures, facile, une petite annotation et le tour est joué :",{"type":28,"tag":29,"props":154,"children":155},{},[156],{"type":39,"value":157},"@Every(\"1h\")",{"type":28,"tag":29,"props":159,"children":160},{},[161],{"type":39,"value":162},"Les jobs sont utilisés dans Nemrod pour la purge des fichiers d’import et le chargement d’un jeu de données initial à l’import.",{"type":28,"tag":75,"props":164,"children":166},{"id":165},"lintégration",[167],{"type":39,"value":168},"L’intégration",{"type":28,"tag":29,"props":170,"children":171},{},[172],{"type":39,"value":173},"Je parlais des jobs Quartz juste au dessus. Mais finalement l’énorme force de Play Framework c’est l’intégration des outils. Que ce soit Quartz ou JPA. tout est intégré avec une configuration minimale et pas de prise de tête. Pour peu que vous vouliez utiliser d’autres frameworks comme CAMEL, AMQP etc..., il y a des modules pour ça.",{"type":28,"tag":75,"props":175,"children":177},{"id":176},"lempreinte-mémoire",[178],{"type":39,"value":179},"L’empreinte mémoire",{"type":28,"tag":29,"props":181,"children":182},{},[183],{"type":39,"value":184},"Vous savez combien Nemrod utilise de mémoire sur l’instance live ? 64Mo de ram ! Et il y a clairement de la marge, aucun tuning n’a été fait pour l’instant. Vous en aviez marre des 1Go de lancement de vos serveurs d’applis traditionnels, Play est fait pour vous.",{"type":28,"tag":75,"props":186,"children":188},{"id":187},"le-déploiement-sur-playapps",[189],{"type":39,"value":190},"Le déploiement sur playapps",{"type":28,"tag":29,"props":192,"children":193},{},[194],{"type":39,"value":195},"Nemrod est déployé sur playapps. Et pour cela, on utilise un module Playapps qui permet de réaliser l’install en moins de 5 minutes. D’ailleurs je compte proposer quelques patchs pour l’utilisation du module en mode non interactif histoire de pouvoir l’automatiser sur Jenkins. Pour info, si vous êtes sur Stax, Cloudbees ou Heroku, il y a aussi des modules pour vous.",{"type":28,"tag":29,"props":197,"children":198},{},[199],{"type":39,"value":200},"Bon, après je ne vais pas non plus m’étendre mais l’architecture en général d’une appli Play a vraiment de quoi plaire, du Stateless, des url faciles à réécrire etc...",{"type":28,"tag":29,"props":202,"children":203},{},[204],{"type":39,"value":205},"Bon, mais si voyait maintenant les points un peu moins bons",{"type":28,"tag":68,"props":207,"children":209},{"id":208},"ce-quon-a-moins-aimé",[210],{"type":39,"value":211},"Ce qu'on a moins aimé",{"type":28,"tag":75,"props":213,"children":215},{"id":214},"les-tests",[216],{"type":39,"value":217},"Les tests",{"type":28,"tag":29,"props":219,"children":220},{},[221],{"type":39,"value":222},"Je vais peut être surprendre quelques personnes mais oui, les tests nous ont posé problème avec Play. Déjà pour utiliser play auto-test, il faut que chaque test étendent UnitTest. Sauf que étendre UnitTest ca implique un démarrage du serveur Play pour chaque test. Et ça, c’est plutôt coûteux. Grosso modo nous avons environ 2s par classe de tests. Multipliez ça par une 30aine de tests et vous obtenez rapidement un temps qui frôle la minute. Imaginez ça sur des suites de tests plus importantes, ça peut être assez gênant.",{"type":28,"tag":29,"props":224,"children":225},{},[226],{"type":39,"value":227},"Toujours sur les tests, il n’est pas si simple de tester un contrôleur.",{"type":28,"tag":229,"props":230,"children":231},"ul",{},[232],{"type":28,"tag":233,"props":234,"children":235},"li",{},[236],{"type":39,"value":237},"Soit on fait du FunctionalTest mais il est difficile d'enchaîner plusieurs actions après une page authentifié. J’ai pas trouvé d’exemples là-dessus et je n’ai pas réussi pour l’instant.",{"type":28,"tag":29,"props":239,"children":240},{},[241],{"type":39,"value":242},"C’est dommage, sachant que chaque action correspondant à une méthode d’un contrôleur, de ne pas pouvoir tester un contrôleur de façon plus simple.",{"type":28,"tag":29,"props":244,"children":245},{},[246,248,255],{"type":39,"value":247},"Il y a un module qui tente d’apporter des solutions : ",{"type":28,"tag":47,"props":249,"children":252},{"href":250,"rel":251},"https://github.com/GuyMograbi/play%5C_test%5C_module",[51],[253],{"type":39,"value":254},"https://github.com/GuyMograbi/play\\_test\\_module",{"type":39,"value":256}," Mais devoir créer un contrôleur de test par contrôleur et surcharger chaque méthode ne me plaît pas des masses.",{"type":28,"tag":229,"props":258,"children":259},{},[260],{"type":28,"tag":233,"props":261,"children":262},{},[263],{"type":39,"value":264},"Soit on fait du selenium. Mais je ne suis pas un grand fan du selenium à outrance. C’est souvent lourd à maintenir, surtout quand l’appli évolue vite côté IHM comme c’est le cas de Nemrod. Et je n’ai pas encore vu comment ajouter ces propres librairies de méthodes dans les tags selenium qui sont compris par Play. A la limite ça permettrait de factoriser quelques actions.",{"type":28,"tag":75,"props":266,"children":268},{"id":267},"le-build",[269],{"type":39,"value":270},"Le build",{"type":28,"tag":29,"props":272,"children":273},{},[274],{"type":39,"value":275},"Autre point qui me chagrine c’est le build. Ok je suis super habitué à Maven et j’aime bien pouvoir choisir les plugins que j'exécute en fonction des profiles. J’aime bien séparer mes tests unitaires de mes tests d’intégration ou de mes tests de performance. La c’est plus dur. J’ai un goal auto-test pour lancer tout les types de tests sans distinctions. Si je déclare un plugin cobertura il s’execute tout le temps, même quand je fais tourner le site en DEV. Quand je déclare une dépendance elle est toujours incluse, il n’y a pas de notions de scope de test par exemple. Bref, il manque un peu de maturité et sans doute quelques modules pour avoir plus de souplesse sur le build.",{"type":28,"tag":75,"props":277,"children":279},{"id":278},"les-templates",[280],{"type":39,"value":281},"Les templates",{"type":28,"tag":29,"props":283,"children":284},{},[285],{"type":39,"value":286},"Sur le principe, les templates dans Play sont vraiment sympa. Les tags sont facile à créer, il y a pas de cycle de vie méga complexe à comprendre pour créer une page etc... Mais en pratique, il y a quand même des petits trucs rapidement fatiguants. Premièrement la courbe d’apprentissage est relativement élevé. Heureusement qu’ils ont rajouté une cheatsheet récemment parce que sinon c’est pas inné de connaître tout les signes cryptiques utilisable dans un template. Mais bon, on va dire que c’est un mauvais moment à passer. Par contre le fait de ne pas avoir d’auto complétion ou de vérification syntaxique dans mon IDE ça c’est dur. Même une fois qu’on commence à comprendre les templates on n’est jamais à l’abri d’une faute découverte à l'exécution. Sur ce sujet, il semble que Play 2.0 va bientôt intégrer Japid et que ce dernier peut être utilisé avec un plugin Eclipse. Ok, ça c’est une bonne chose. Même si la lecture de la doc du plugin Japid m’a un peu donné mal à la tête ^^ Vive les notations $ ~ { % ! Je prévois quand même d’y passer, ne serait-ce que pour les perfs qui sont annoncées bien meilleures qu’avec les templates Groovy.",{"type":28,"tag":75,"props":288,"children":290},{"id":289},"jpa",[291],{"type":39,"value":292},"JPA",{"type":28,"tag":29,"props":294,"children":295},{},[296],{"type":39,"value":297},"Allez, soyons honnête, ça n’a rien à voir avec Play mais JPA commence à me sortir par les yeux. Ça fait quelques temps que j’utilise Hibernate et JPA maintenant et c’est vraiment “pourquoi faire simple quand on peut faire compliqué”. Malheureusement comme je souhaite que Nemrod soit multi base de données, c’est un passage obligé. Et donc mon seul reproche de Play sur ce coup là c’est que ce soit tellement simple d’utiliser JPA ^^ Ben oui, pour le coup comme c’est simple et que les modifs de schéma sont faites sans relancer le serveur ça en devient presque magique. Et puis un jour on se réveille avec 4000 requêtes joués par page, des transactions super longues qui bloquent la base et des performances en berne.",{"type":28,"tag":29,"props":299,"children":300},{},[301],{"type":39,"value":302},"Au final, Play c’est quand même le productivity killer, le retour aux sources pour les développement web. Il manque quelques petits trucs et j’attends de découvrir la version 2.0 avec impatience pour voir l’évolution prise.",{"title":7,"searchDepth":304,"depth":304,"links":305},2,[306,317],{"id":70,"depth":304,"text":73,"children":307},[308,310,311,312,313,314,315,316],{"id":77,"depth":309,"text":80},3,{"id":88,"depth":309,"text":91},{"id":108,"depth":309,"text":111},{"id":133,"depth":309,"text":136},{"id":144,"depth":309,"text":147},{"id":165,"depth":309,"text":168},{"id":176,"depth":309,"text":179},{"id":187,"depth":309,"text":190},{"id":208,"depth":304,"text":211,"children":318},[319,320,321,322],{"id":214,"depth":309,"text":217},{"id":267,"depth":309,"text":270},{"id":278,"depth":309,"text":281},{"id":289,"depth":309,"text":292},"markdown","content:articles:2011:10:06:nemrod-et-play-framework-love-story-nemrod-55.md","content","articles/2011/10/06/nemrod-et-play-framework-love-story-nemrod-55.md","md",1708364373137]
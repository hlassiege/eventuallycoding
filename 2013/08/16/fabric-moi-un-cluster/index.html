<!DOCTYPE html>
<html lang="fr">
<head><meta charset="utf-8">
<title>Fabric moi un cluster | EventuallyCoding</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://digianalytics.fr/js/script.js" data-host="https://digianalytics.fr" id="ZwSg9rf6GA" async="" defer="" type="text/javascript"></script>
<meta name="description" content="Je vous propose dans ce billet de prendre en main Fabric...">
<meta name="og:description" content="Je vous propose dans ce billet de prendre en main Fabric...">
<meta name="og:type" content="article">
<meta name="og:title" content="Fabric moi un cluster">
<meta name="og:url" content="https://eventuallycoding.com/2013/08/16/fabric-moi-un-cluster">
<meta name="og:image" content="https://eventuallycoding.com/images/covers/cover2.jpg">
<meta name="og:image:alt" content="Fabric moi un cluster">
<meta name="twitter:text:title" content="Fabric moi un cluster">
<meta name="twitter:image" content="https://eventuallycoding.com/images/covers/cover2.jpg">
<meta name="twitter:card" content="summary">
<meta name="article:published_time" content="2013-08-16T00:00:00.000Z">
<meta name="article:article:modified_time" content="2013-08-16T00:00:00.000Z">
<meta name="article:article:tag" content="devops,fabric,python">
<link rel="canonical" href="https://eventuallycoding.com/2013/08/16/fabric-moi-un-cluster">
<link rel="alternate" href="https://eventuallycoding.com/2013/08/16/fabric-moi-un-cluster" hreflang="fr"><link rel="modulepreload" href="/2013/08/16/fabric-moi-un-cluster/_payload.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/entry.d6f53a58.js"><link rel="preload" as="style" href="/_nuxt/entry.874fac0a.css"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/default.6e61ddc0.js"><link rel="preload" as="style" href="/_nuxt/TheHeader.e21518f4.css"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/nuxt-link.1d001661.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/siteMetaData.b74feb44.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/_id_.f758ba0d.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/Dropdown.98526847.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/_commonjsHelpers.28e086c5.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ContentRenderer.1b10f33c.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ContentRendererMarkdown.000df400.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/index.a6ef77ff.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/query.87ff800c.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/index.61d74bb5.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/utils.8795dd76.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/composables.ba6f512d.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseP.39302eeb.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseImg.d1cd0e0a.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseA.bc2f0d65.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseH2.c7115736.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseCode.553aed44.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseUl.9bdc8544.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseLi.2f95f442.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseEm.c8986d33.js"><link rel="prefetch" as="script" crossorigin href="/_nuxt/error-component.dc11f53f.js"><link rel="prefetch" as="image" type="image/svg+xml" href="/_nuxt/github_new.4e3fe23c.svg"><link rel="prefetch" as="image" type="image/svg+xml" href="/_nuxt/rss.9e0b880c.svg"><link rel="prefetch" as="image" type="image/svg+xml" href="/_nuxt/mastodon.f0ecdde8.svg"><link rel="prefetch" as="image" type="image/svg+xml" href="/_nuxt/linkeding.34c3bc6d.svg"><link rel="prefetch" as="image" type="image/svg+xml" href="/_nuxt/twitter.457cff27.svg"><link rel="stylesheet" href="/_nuxt/entry.874fac0a.css"><link rel="stylesheet" href="/_nuxt/TheHeader.e21518f4.css"><style>.inverted[data-v-a060ef80]{--tw-bg-opacity:1;background-color:rgb(248 250 252/var(--tw-bg-opacity))}.inverted .font-to-invert-to-pink[data-v-a060ef80]{color:rgb(236 72 153/var(--tw-text-opacity))}.inverted .font-to-invert-to-black[data-v-a060ef80],.inverted .font-to-invert-to-pink[data-v-a060ef80]{--tw-text-opacity:1;transition-duration:.15s;transition-property:all;transition-timing-function:cubic-bezier(.4,0,.2,1)}.inverted .font-to-invert-to-black[data-v-a060ef80]{color:rgb(51 65 85/var(--tw-text-opacity))}.inverted .font-to-invert-to-black[data-v-a060ef80]:hover{--tw-text-opacity:1;color:rgb(255 255 255/var(--tw-text-opacity))}.link[data-v-a060ef80]{display:block;font-size:1rem;font-weight:500;line-height:1.5rem;overflow:hidden;padding-left:.75rem;padding-right:.75rem;position:relative;text-decoration:none}.link.NuxtLink-exact-active[data-v-a060ef80]:after{bottom:-2px;height:100%;left:0;width:100%}.link[data-v-a060ef80]:after{background:rgba(236,64,122,.25);bottom:-6px;content:"";height:calc(100% - 8px);left:18px;position:absolute;transition:.35s cubic-bezier(.25,.1,0,2.05);width:calc(100% - 8px);z-index:-1}.link[data-v-a060ef80]:hover:after{bottom:-2px;height:100%;left:0;width:100%}</style><style>.nuxt-content h2{font-size:28px;font-weight:700}.nuxt-content h3{font-size:22px;font-weight:700}.nuxt-content p{margin-bottom:20px}</style><style>pre code .line{display:block;min-height:1rem}</style></head>
<body ><div id="__nuxt"><!--[--><section class="w-full pb-12 antialiased"><div class="mx-auto max-w-8xl"><div data-v-a060ef80><nav id="header-menu" class="transition-colors fixed w-full z-10 top-0 inverted" data-v-a060ef80><div class="max-w-7xl mx-auto px-2 sm:px-6 lg:px-8" data-v-a060ef80><div class="relative flex items-center justify-between h-16" data-v-a060ef80><div class="absolute inset-y-0 left-0 flex items-center sm:hidden" data-v-a060ef80><button type="button" class="inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-white hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-white" aria-controls="mobile-menu" aria-expanded="false" data-v-a060ef80><span class="sr-only" data-v-a060ef80>Open main menu</span><svg class="block h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" data-v-a060ef80><path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" data-v-a060ef80></path></svg><svg class="hidden h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" data-v-a060ef80><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" data-v-a060ef80></path></svg></button></div><div class="flex-1 flex items-center justify-center sm:items-stretch sm:justify-start" data-v-a060ef80><div class="flex-shrink-0 flex items-center" data-v-a060ef80><span class="text-white text-base font-medium font-bruno text-2xl font-to-invert-to-pink" data-v-a060ef80><a href="/" class="" data-v-a060ef80>EventuallyCoding.com</a></span></div><div class="hidden sm:block sm:ml-6 absolute right-0 font-mark" data-v-a060ef80><div class="flex space-x-4" data-v-a060ef80><!--[--><a href="/speaking" class="link text-white font-to-invert-to-black" data-v-a060ef80>Speaking</a><a href="/blog" class="link text-white font-to-invert-to-black" data-v-a060ef80>Writing</a><a href="/resources" class="link text-white font-to-invert-to-black" data-v-a060ef80>Resources</a><a href="/about" class="link text-white font-to-invert-to-black" data-v-a060ef80>About</a><!--]--></div></div></div></div></div><div class="hidden" data-v-a060ef80><div class="px-2 pt-2 pb-3 space-y-1" data-v-a060ef80><!--[--><a href="/speaking" class="text-white hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium font-to-invert-to-black" data-v-a060ef80>Speaking</a><a href="/blog" class="text-white hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium font-to-invert-to-black" data-v-a060ef80>Writing</a><a href="/resources" class="text-white hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium font-to-invert-to-black" data-v-a060ef80>Resources</a><a href="/about" class="text-white hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium font-to-invert-to-black" data-v-a060ef80>About</a><!--]--></div></div></nav></div><!--[--><!--[--><div><div class="flex justify-center mt-24"><img src="/images/covers/cover2.jpg" alt="Fabric moi un cluster" class="object-cover w-96"></div><div class="px-4 mx-auto sm:px-6 xl:max-w-7xl xl:px-0 mt-10"><div><h1 class="text-4xl text-gray-700 font-extrabold text-center mb-3">Fabric moi un cluster</h1><p class="text-slate-400 text-center mb-1"><!----></p><div class="grid grid-cols-3 text-center sm:w-full md:w-1/2 mx-auto"><div><p class="text-center font-bold my-4 text-slate-400 text-xs"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline-block" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg> August 16, 2013</p></div><div><p class="text-center font-bold my-4 text-slate-400 text-xs"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline-block" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> 6 min read</p></div><div class="flex items-center font-medium sm:mx-3 justify-center"><img src="/hugo-nb.jpg" loading="lazy" alt="" class="mr-3 w-10 h-10 rounded-full bg-slate-50 dark:bg-slate-800"><div><div class="font-bold text-slate-400 text-xs">Hugo Lassiège</div><a target="_blank" href="https://twitter.com/hugolassiege" class="font-bold text-sky-400 text-xs hover:text-sky-600"> @hugolassiege</a></div></div></div></div><div class="text-left mx-auto"><div class="flex flex-wrap lg:flex-row-reverse py-12"><div class="w-full lg:w-1/4 px-5"><div class="lg:sticky top-0 pt-5 -mt-5 font-proxima"><div class="toc hidden lg:block"><p class="border-b-4 pb-3 mb-3 border-gray-200 text-xl"> On this page </p><ul class="pl-0"><!--[--><li class="py-1"><a class="hover:text-smalt-blue-700" href="#installation">Installation</a></li><li class="py-1"><a class="hover:text-smalt-blue-700" href="#mon-premier-script">Mon premier script</a></li><li class="py-1"><a class="hover:text-smalt-blue-700" href="#le-parralélisme">Le parralélisme</a></li><li class="py-1"><a class="hover:text-smalt-blue-700" href="#maintenir-une-topologie-de-nœuds">Maintenir une topologie de nœuds</a></li><li class="py-1"><a class="hover:text-smalt-blue-700" href="#la-gestion-des-erreurs">La gestion des erreurs</a></li><li class="py-1"><a class="hover:text-smalt-blue-700" href="#la-manipulation-de-fichier">La manipulation de fichier</a></li><li class="py-1"><a class="hover:text-smalt-blue-700" href="#lordonnancement">L’ordonnancement</a></li><li class="py-1"><a class="hover:text-smalt-blue-700" href="#la-modularisation">La modularisation</a></li><!--]--></ul></div><div class="text-right mb-12"><div class="relative inline-block text-left ml-2 block lg:hidden"><div><span class="rounded-md shadow-sm"><button type="button" class="inline-flex justify-center w-full rounded-md border border-gray-300 px-4 py-2 bg-white text-sm leading-5 font-medium text-black hover:text-white hover:bg-smalt-blue-500 focus:outline-none transition ease-in-out duration-150" aria-haspopup="true" aria-expanded="true"><!--[-->On this page<!--]--><svg class="-mr-1 ml-2 h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></span></div><!----></div></div></div></div><div class="lg:w-3/4 w-full px-5 max-w-none centered-image"><div id="nuxtContent" class="prose font-proxima text-sm md:text-xl font-medium min-w-full md:p-10 mx-auto"><p><!--[--><img src="/images/b9590-python.jpeg" alt="python">Je vous propose dans ce billet de prendre en main <a href="http://docs.fabfile.org/en/1.7/" rel="nofollow"><!--[-->Fabric<!--]--></a>, un outil que j’ai utilisé récemment et qui vous permettra de scripter des déploiements sur plusieurs machines assez simplement.<!--]--></p><p><!--[-->Pour résumer, Fabric est une lib Python qui vous permet d’automatiser des executions de commandes via ssh sur des serveurs distants.<!--]--></p><p><!--[-->En sus, Fabric permet de créer une topologie de votre application : quels sont les machines “web”, les machines “bases de données” etc...<!--]--></p><p><!--[-->Grâce à ces infos, Fabric permet ensuite exécuter des scripts par famille de nœud. Par exemple installer la dernière version de votre Webapp sur tous les nœuds “web”.<!--]--></p><p><!--[-->Peut-être que si vous connaissiez déjà <a href="http://rundeck.org/" rel="nofollow"><!--[-->Rundeck<!--]--></a> tout ceci vous rappelle quelque chose puisqu’il répond a peu près à la même problématique.<!--]--></p><p><!--[-->Python Fabric est plus simple d’utilisation, vous ne retrouverez pas l’application Web qui permettait de gérer votre topologie et vous ne retrouverez pas les hooks qui permettaient de déclencher des actions. Mais vous allez voir qu’on y perd pas au change.<!--]--></p><p><!--[-->Pourquoi Fabric et pas simplement faire du script Shell ? Nous le verrons dans la suite du billet.<!--]--></p><p><!--[-->Et pour illustrer ce billet par un exemple de la vraie vie, vous trouverez à la fin de ce billet les sources pour installer un Cluster de 3 noeuds pour elasticsearch, MongoDB et Cassandra qui devraient fonctionner sous Debian.<!--]--></p><h2 id="installation"><a href="#installation"><!--[-->Installation<!--]--></a></h2><!--[--><pre><code>pip install fabric
</code></pre><!--]--><p><!--[-->Oui, super complexe...<!--]--></p><h2 id="mon-premier-script"><a href="#mon-premier-script"><!--[-->Mon premier script<!--]--></a></h2><p><!--[-->(issu de la doc)<!--]--></p><p><!--[-->Dans un fichier nommé fabfile.py, écrire les lignes suivantes :<!--]--></p><!--[--><pre><code>from fabric.api import *

@task
def host_type():
    run(&#39;uname -s&#39;)
</code></pre><!--]--><p><!--[-->Rien d’extraordinaire pour l’instant, nous allons juste executer cette commande sur des machines distantes.<!--]--></p><!--[--><pre><code>$ fab -H localhost,linuxbox host_type
[localhost] run: uname -s
[localhost] out: Darwin
[linuxbox] run: uname -s
[linuxbox] out: Linux
Done. 
Disconnecting from localhost... done. 
Disconnecting from linuxbox... done.
</code></pre><!--]--><p><!--[-->La même chose avec un script shell :<!--]--></p><!--[--><pre><code>for machine in localhost linuxbox ; do ssh user@$machine &quot;uname -s&quot;; done
</code></pre><!--]--><p><!--[-->Premier réflexe une fois qu’on connaît l’équivalent en shell, pourquoi pas du shell uniquement ? Voici mes raisons :<!--]--></p><ul><!--[--><li><!--[-->je préfère coder en Python (la raison la plus subjective :))<!--]--></li><li><!--[-->je ne réinvente pas la roue, les appels ssh, le parallélisme, la gestion des erreurs, les familles de noeuds, tout est déjà codé<!--]--></li><!--]--></ul><p><!--[-->Voyons cela en détail.<!--]--></p><h2 id="le-parralélisme"><a href="#le-parralélisme"><!--[-->Le parralélisme<!--]--></a></h2><p><!--[-->Changeons désormais notre méthode pour la remplacer par<!--]--></p><!--[--><pre><code>@task
@parallel
def host_type():
    run(‘uname -s’)
</code></pre><!--]--><p><!--[-->Et lors de l’execution :<!--]--></p><!--[--><pre><code>$ fab -H localhost,linuxbox host_type
[localhost] Executing task ‘host_type’
[linuxbox] Executing task ‘host_type’
[linuxbox] run: uname -s
[localhost run: uname -s
[linuxbox] out: Linux
[linuxbox] out:
[localhost] out: Darwin
[localhost] out:
</code></pre><!--]--><p><!--[-->Comme son nom l’indique, notre décorateur nous a permis de lancer notre commande en parallèle sur les hôtes passés en paramètre.<!--]--></p><h2 id="maintenir-une-topologie-de-nœuds"><a href="#maintenir-une-topologie-de-nœuds"><!--[-->Maintenir une topologie de nœuds<!--]--></a></h2><p><!--[-->Comme je le disais en intro Fabric permet de gérer des topologies applicatives.<!--]--></p><p><!--[-->Par exemple, nous allons définir 3 type de rôles :<!--]--></p><!--[--><pre><code>env.roledefs = {
‘test’:  [&#39;localhost&#39; ],
‘database’:  [&#39;root@xx.xx.xx.10&#39;, &#39;root@xx.xx.xx.11&#39;, &#39;root@xx.xx.xx.12&#39; ],
‘web’:  [&#39;root@xx.xx.xx.1&#39;, &#39;root@xx.xx.xx.2&#39;, &#39;root@xx.xx.xx.3&#39; ]
}
</code></pre><!--]--><p><!--[-->Et nous allons définir une tâche pour installer java uniquement sur les machines Web :<!--]--></p><!--[--><pre><code>@task
@parallel
@roles(‘web’)
def java():
    run(‘apt-get install openjdk-7-jdk –assume-yes’)
</code></pre><!--]--><p><!--[-->En tapant cette commande : fab java<!--]--></p><p><!--[-->Fabric va lancer l’install de Java uniquement sur les machines de type “web”<!--]--></p><h2 id="la-gestion-des-erreurs"><a href="#la-gestion-des-erreurs"><!--[-->La gestion des erreurs<!--]--></a></h2><p><!--[-->En réalité lorsque vous lancez une commande, il ne s’agit pas uniquement de lancer votre commande et basta. Vous espérez aussi que cela s’est bien passé. Fabric va vérifier cela pour vous en regardant le code retour de chaque opération. Exemple ici :<!--]--></p><!--[--><pre><code>@task
@roles(‘web’)
@parallel
def something _wrong():
    run(‘rm /tmp/unknown _file’)
</code></pre><!--]--><p><!--[-->Et l’execution<!--]--></p><!--[--><pre><code>$ fab something _wrong
 [root@linuxbox ] Executing task ‘something _wrong’
 [root@linuxbox ] run: rm /tmp/unknown _file
 [root@linuxbox ] out: rm: impossible de supprimer « /tmp/unknown _file »: Aucun fichier ou dossier de ce type
 [root@linuxbox ] out:
Fatal error: run() received nonzero return code 1 while executing!
Requested: rm /tmp/unknown _file
Executed: /bin/bash -l -c « rm /tmp/unknown _file »
Aborting.

Fatal error: One or more hosts failed while executing task ‘something _wrong’
Aborting.
</code></pre><!--]--><p><!--[-->Evidemment parfois on s’attend à une erreur, par exemple sur la tâche suivante :<!--]--></p><!--[--><pre><code>@task
@roles(‘database’)
@parallel
def remove():
    run(‘service mongodb stop’)
    run(‘aptitude purge mongodb-10gen –assume-yes’)
    run(‘rm -rf /var/lib/mongodb/ *’)
</code></pre><!--]--><p><!--[-->Et si MongoDB n’est pas démarré ? C’est un cas normal et la désinstall doit tout de même se poursuivre.<!--]--></p><p><!--[-->Dans ce cas, on pourra ignorer l’erreur :<!--]--></p><!--[--><pre><code>@task
@roles(‘database’)
@parallel
def remove():
    with settings(warn _only=True):
        run(‘service mongodb stop’)
    run(‘aptitude purge mongodb-10gen –assume-yes’)
    run(‘rm -rf /var/lib/mongodb/ *’)
</code></pre><!--]--><p><!--[-->Le décorateur @with_settings vous permettra d’ignorer les erreurs pour une tâche entière.<!--]--></p><h2 id="la-manipulation-de-fichier"><a href="#la-manipulation-de-fichier"><!--[-->La manipulation de fichier<!--]--></a></h2><p><!--[-->Plutôt fréquent dans une installation, vous devez modifier la configuration par défaut. Fabric vous propose plusieurs méthodes pour cela à base de sed.<!--]--></p><p><!--[-->La première, la plus simple dont on va se servir pour configurer le nom du cluster elasticsearch :<!--]--></p><p><!--[-->sed(&#39;/etc/elasticsearch/elasticsearch.yml&#39;, &#39;.<em><!--[-->cluster.name:.<!--]--></em>&#39;, &#39;cluster.name: eventuallycoding&#39;)<!--]--></p><p><!--[-->Parfois cependant on a une logique plus alambiqué : si jamais la ligne n’existe pas tu la rajoutes, sinon tu la modifies (par exemple pour rajouter un dépot apt).<!--]--></p><p><!--[-->Fabric vous propose ceci :<!--]--></p><!--[--><pre><code>append(&#39;/etc/apt/sources.list.d/mongodb.list&#39;,&#39;deb http://downloads-distro.mongodb.org/repo/debian-sysvinit dist 10gen&#39;)
</code></pre><!--]--><p><!--[-->La ligne ne sera pas ajouté si elle existe déjà. Et surtout le fichier sera créé s’il n’existait pas.<!--]--></p><h2 id="lordonnancement"><a href="#lordonnancement"><!--[-->L’ordonnancement<!--]--></a></h2><p><!--[-->Il arrive régulièrement d’avoir une “super tâche” Fabric qui ordonnance une mise à jour sur l’ensemble des noeuds, par exemple Web et Database. Ce serait dommage de devoir scripter en shell les appels successifs aux tâches Fabric non ?<!--]--></p><p><!--[-->Donc Fabric vous propose d’appeler des tâches à l’intérieur d’une tâche :<!--]--></p><!--[--><pre><code>@task
@roles(&#39;database&#39;)
def migrate():
    # Database stuff here.
    pass

@task
@roles(&#39;web&#39;)
def update():
    # Code updates here.
    pass

@task
def deploy():
    execute(migrate)
    execute(update)
</code></pre><!--]--><p><!--[-->La tâche deploy va lancer successivement les tâches migrate et update sur les bons noeuds de votre application.<!--]--></p><h2 id="la-modularisation"><a href="#la-modularisation"><!--[-->La modularisation<!--]--></a></h2><p><!--[-->Pour bien faire les choses, nous allons modulariser nos instructions d’installation. Ici je vais vous présenter un cas concret, l’installation d’un cluster MongoDB, d’un cluster ElasticSearch et d’un cluster Cassandra.<!--]--></p><p><!--[-->Pas question évidemment d’avoir toutes les instructions dans un seul fichier fabfile. Nous allons donc créer : elasticsearch.py, mongodb.py, cassandra.py.<!--]--></p><p><!--[-->Dans notre fichier fabfile.py il nous suffira de faire :<!--]--></p><p><!--[-->import mongodb, elasticsearch, cassandra<!--]--></p><p><!--[-->afin d’avoir accès à l’ensemble des tâches présentes pour chaque module.<!--]--></p><p><!--[-->Et ensuite pour l’utilisateur, pour connaître la liste des tâches disponibles :<!--]--></p><!--[--><pre><code>$ fab -l
Available commands:

install
cassandra.install
cassandra.start
cassandra.stop
cassandra.uninstall
elasticsearch.install
elasticsearch.uninstall
elasticsearch.start
elasticsearch.stop
java.java
mongodb.install
mongodb.uninstall
mongodb.start
mongodb.stop
</code></pre><!--]--><p><!--[-->Et voilà. Comme tout outil de qualité qui se respecte, sa simplicité nous a permis d’en faire le tour rapidement.<!--]--></p><p><!--[-->En bonus vous pouvez aller voir ce repository github qui contient des scripts fabric pour installer MongoDB, ElasticSearch et Cassandra en cluster, chose dont j’ai eu besoin récemment pour réaliser des benchs sur les 3 (peut être un futur billet) :<!--]--></p><p><!--[--><a href="https://github.com/hlassiege/fabric-sample" rel="nofollow"><!--[-->https://github.com/hlassiege/fabric-sample<!--]--></a><!--]--></p></div></div></div></div><div class="mt-10 text-slate-600 font-extrabold text-sm font-medium min-w-full mx-auto mb-2"><a href="https://github.com/hlassiege/eventuallycoding/blob/master/content/articles/2013/08/16/fabric-moi-un-cluster.md" rel="noopener noreferrer" target="_blank">Edit on Github <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 inline-block text-slate-600 -mt-1" viewBox="0 0 512 512"><path d="M320 0c-17.7 0-32 14.3-32 32s14.3 32 32 32h82.7L201.4 265.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L448 109.3V192c0 17.7 14.3 32 32 32s32-14.3 32-32V32c0-17.7-14.3-32-32-32H320zM80 32C35.8 32 0 67.8 0 112V432c0 44.2 35.8 80 80 80H400c44.2 0 80-35.8 80-80V320c0-17.7-14.3-32-32-32s-32 14.3-32 32V432c0 8.8-7.2 16-16 16H80c-8.8 0-16-7.2-16-16V112c0-8.8 7.2-16 16-16H192c17.7 0 32-14.3 32-32s-14.3-32-32-32H80z"></path></svg></a></div><hr class="mb-8"><div><span class="font-proxima text-sm md:text-xl font-medium"> Did you like this blog post? </span><div class="mt-4 flex flex-row"><div><a href="https://facebook.com/sharer/sharer.php?u=https://eventuallycoding.com/2013/08/16/fabric-moi-un-cluster" target="_blank" rel="noopener" aria-label="Share on Facebook"><button aria-label="Share on Facebook" type="button" class="text-white bg-[#3b5998] hover:bg-[#3b5998]/90 focus:ring-4 focus:outline-none focus:ring-[#3b5998]/50 font-medium rounded-lg text-sm px-3 py-3 text-center inline-flex items-center dark:focus:ring-[#3b5998]/55 mr-2 mb-2"><svg class="w-6 h-6" aria-hidden="true" focusable="false" data-prefix="fab" data-icon="facebook-f" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M279.1 288l14.22-92.66h-88.91v-60.13c0-25.35 12.42-50.06 52.24-50.06h40.42V6.26S260.4 0 225.4 0c-73.22 0-121.1 44.38-121.1 124.7v70.62H22.89V288h81.39v224h100.2V288z"></path></svg></button></a></div><div><a href="https://twitter.com/share?url=https://eventuallycoding.com/2013/08/16/fabric-moi-un-cluster&amp;text=Fabric moi un cluster&amp;via=hugolassiege" target="_blank" title="Share on Twitter" rel="noopener noreferrer" aria-label="Share on Twitter"><button aria-label="Share on Twitter" type="button" class="text-white bg-[#1da1f2] hover:bg-[#1da1f2]/90 focus:ring-4 focus:outline-none focus:ring-[#1da1f2]/50 font-medium rounded-lg text-sm px-3 py-3 text-center inline-flex items-center dark:focus:ring-[#1da1f2]/55 mr-2 mb-2"><svg class="w-6 h-6" aria-hidden="true" focusable="false" data-prefix="fab" data-icon="twitter" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M459.4 151.7c.325 4.548 .325 9.097 .325 13.65 0 138.7-105.6 298.6-298.6 298.6-59.45 0-114.7-17.22-161.1-47.11 8.447 .974 16.57 1.299 25.34 1.299 49.06 0 94.21-16.57 130.3-44.83-46.13-.975-84.79-31.19-98.11-72.77 6.498 .974 12.99 1.624 19.82 1.624 9.421 0 18.84-1.3 27.61-3.573-48.08-9.747-84.14-51.98-84.14-102.1v-1.299c13.97 7.797 30.21 12.67 47.43 13.32-28.26-18.84-46.78-51.01-46.78-87.39 0-19.49 5.197-37.36 14.29-52.95 51.65 63.67 129.3 105.3 216.4 109.8-1.624-7.797-2.599-15.92-2.599-24.04 0-57.83 46.78-104.9 104.9-104.9 30.21 0 57.5 12.67 76.67 33.14 23.72-4.548 46.46-13.32 66.6-25.34-7.798 24.37-24.37 44.83-46.13 57.83 21.12-2.273 41.58-8.122 60.43-16.24-14.29 20.79-32.16 39.31-52.63 54.25z"></path></svg></button></a></div><div class=""><a href="https://www.buymeacoffee.com/hlassiege" target="_blank"><img src="https://cdn.buymeacoffee.com/buttons/v2/default-red.png" alt="Buy Me A Coffee" style="height:48px !important;width:209px !important;"></a></div></div></div><div id="hyvor-talk-view"></div></div></div><!--]--><!--]--><footer class="lg:mt-40 border-t border-t-2"><div class="flex flex-col items-center mt-16"><div class="flex mb-3 space-x-4"><a aria-label="Open RSS feed" target="_self" href="/rss.xml" class="text-sm text-gray-500 transition hover:text-gray-600"><img alt="RSS" class="transition-transform hover:scale-110 w-8 h-8" src="/_nuxt/rss.9e0b880c.svg"></a><a aria-label="Open Mastodon profile" class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="me" href="https://piaille.fr/@hugolassiege"><span class="sr-only">Mastodon</span><img alt="Mastodon" class="transition-transform hover:scale-110 w-8 h-8" src="/_nuxt/mastodon.f0ecdde8.svg"></a><a aria-label="Open github profile" class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="nofollow noopener noreferrer" href="https://github.com/hlassiege"><span class="sr-only">github</span><img alt="github" class="transition-transform hover:scale-110 w-8 h-8" src="/_nuxt/github_new.4e3fe23c.svg"></a><a aria-label="Open linkedin profile" class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://www.linkedin.com/in/hugolassiege/"><span class="sr-only">Linkedin</span><img alt="Linkedin" class="transition-transform hover:scale-110 w-8 h-8" src="/_nuxt/linkeding.34c3bc6d.svg"></a><a aria-label="Open twitter profile" target="_blank" rel="nofollow noopener noreferrer" href="https://twitter.com/hugolassiege" class="text-sm text-gray-500 transition hover:text-gray-600"><img alt="Twitter" class="transition-transform hover:scale-110 w-8 h-8" src="/_nuxt/twitter.457cff27.svg"></a></div><div class="flex mb-2 space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>Copyright © 2023</div><div>•</div> EventuallyCoding - A la fin de l&#39;envoi, je code !</div><div class="text-sm text-gray-500"> Credits to www.freepik.com - <a href="https://www.freepik.com/vectors/citizen">Citizen vector created by freepik - </a><a href="https://www.freepik.com/vectors/css">Css vector created by vectorjuice</a></div></div></footer></div></section><!--]--></div><script type="module">import p from "/2013/08/16/fabric-moi-un-cluster/_payload.js";window.__NUXT__={...p,...((function(a,b){return {state:{},_errors:{},serverRendered:true,config:{public:{content:{locales:[],defaultLocale:b,integrity:1678534486067,experimental:{stripQueryParameters:a,clientDB:a},api:{baseURL:"\u002Fapi\u002F_content"},navigation:{fields:[]},tags:{p:"prose-p",a:"prose-a",blockquote:"prose-blockquote","code-inline":"prose-code-inline",code:"prose-code",em:"prose-em",h1:"prose-h1",h2:"prose-h2",h3:"prose-h3",h4:"prose-h4",h5:"prose-h5",h6:"prose-h6",hr:"prose-hr",img:"prose-img",ul:"prose-ul",ol:"prose-ol",li:"prose-li",strong:"prose-strong",table:"prose-table",thead:"prose-thead",tbody:"prose-tbody",td:"prose-td",th:"prose-th",tr:"prose-tr"},highlight:a,wsUrl:b,documentDriven:a,host:b,trailingSlash:a,anchorLinks:{depth:4,exclude:[1]}}},app:{baseURL:"\u002F",buildAssetsDir:"\u002F_nuxt\u002F",cdnURL:b}},prerenderedAt:1678534518858}}(false,"")))}</script><script type="module" src="/_nuxt/entry.d6f53a58.js" crossorigin></script><script type="module" src="/_nuxt/default.6e61ddc0.js" crossorigin></script><script type="module" src="/_nuxt/_id_.f758ba0d.js" crossorigin></script><script type="module" src="/_nuxt/ContentRenderer.1b10f33c.js" crossorigin></script><script type="module" src="/_nuxt/ContentRendererMarkdown.000df400.js" crossorigin></script><script type="module" src="/_nuxt/ProseP.39302eeb.js" crossorigin></script><script type="module" src="/_nuxt/ProseImg.d1cd0e0a.js" crossorigin></script><script type="module" src="/_nuxt/ProseA.bc2f0d65.js" crossorigin></script><script type="module" src="/_nuxt/ProseH2.c7115736.js" crossorigin></script><script type="module" src="/_nuxt/ProseCode.553aed44.js" crossorigin></script><script type="module" src="/_nuxt/ProseUl.9bdc8544.js" crossorigin></script><script type="module" src="/_nuxt/ProseLi.2f95f442.js" crossorigin></script><script type="module" src="/_nuxt/ProseEm.c8986d33.js" crossorigin></script></body>
</html>
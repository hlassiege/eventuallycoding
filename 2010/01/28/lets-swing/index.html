<!DOCTYPE html>
<html data-head-attrs="">
<head><title>Let's Swing ! | EventuallyCoding</title><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><script src="https://digianalytics.fr/js/script.js" data-host="https://digianalytics.fr" data-dnt="false" id="ZwSg9rf6GA" async defer type="text/javascript"></script><meta name="description" content="Vous connaissez Swing ? Oui, enfin non, pas la [musique](http://fr.wikipedia.org/wiki/Swing_%28musique%29 &quot;Musique swing&quot;)... En plus d'avoir fait dan..."><meta name="og:description" content="Vous connaissez Swing ? Oui, enfin non, pas la [musique](http://fr.wikipedia.org/wiki/Swing_%28musique%29 &quot;Musique swing&quot;)... En plus d'avoir fait dan..."><meta name="og:type" content="article"><meta name="og:title" content="Let's Swing !"><meta name="og:url" content="https://eventuallycoding.com/2010/01/28/lets-swing"><meta name="og:image" content="https://eventuallycoding.com/images/covers/cover7.jpg"><meta name="og:image:alt" content="Let's Swing !"><meta name="twitter:text:title" content="Let's Swing !"><meta name="twitter:image" content="https://eventuallycoding.com/images/covers/cover7.jpg"><meta name="twitter:card" content="summary"><meta name="article:published_time" content="2010-01-28T00:00:00.000Z"><meta name="article:article:modified_time" content="2010-01-28T00:00:00.000Z"><meta name="article:article:tag" content="edt,substance,swing"><link rel="canonical" href="https://eventuallycoding.com/2010/01/28/lets-swing"><meta name="head:count" content="17"><link rel="modulepreload" href="/2010/01/28/lets-swing/_payload.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/entry.fcab9936.js"><link rel="preload" as="style" href="/_nuxt/entry.2fb37f22.css"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/default.4dae085d.js"><link rel="preload" as="style" href="/_nuxt/TheHeader.19f98060.css"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/TheHeader.80ba6813.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/TheFooter.105aff6f.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/sitemetainfo.7469eb96.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/github_new.3002adce.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/_id_.3f719124.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/PageSidebar.5a145493.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/Dropdown.689d645d.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/_commonjsHelpers.f8a6f4fc.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ContentRenderer.1a0871f4.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ContentRendererMarkdown.ccdf1d5f.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/BlogCard.vue_vue_type_script_setup_true_lang.db51df5b.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/asyncData.39f6bbba.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/query.1873f872.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/utils.1e1af48e.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/HeroSection.bfef0b1b.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseP.c989a686.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseA.7367bf3d.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseUl.81ca777e.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseLi.d738630a.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseH3.c5819dab.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseH4.f28d56da.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseEm.56cdc98b.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseH5.0e8273c0.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseOl.650c9814.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseStrong.1bfd5325.js"><link rel="prefetch" as="script" crossorigin href="/_nuxt/web-socket.bba264a4.js"><link rel="prefetch" as="script" crossorigin href="/_nuxt/error-component.53e7cf93.js"><link rel="prefetch" as="image" type="image/svg+xml" href="/_nuxt/rss.9e0b880c.svg"><link rel="prefetch" as="image" type="image/svg+xml" href="/_nuxt/linkeding.34c3bc6d.svg"><link rel="prefetch" as="image" type="image/svg+xml" href="/_nuxt/twitter.457cff27.svg"><link rel="prefetch" as="image" type="image/svg+xml" href="/_nuxt/github_new.4e3fe23c.svg"><link rel="stylesheet" href="/_nuxt/entry.2fb37f22.css"><link rel="stylesheet" href="/_nuxt/TheHeader.19f98060.css"><style>.nuxt-content h2{font-size:28px;font-weight:700}.nuxt-content h3{font-size:22px;font-weight:700}.nuxt-content p{margin-bottom:20px}</style><style>.nuxt-content h2{font-size:28px;font-weight:700}.nuxt-content h3{font-size:22px;font-weight:700}.nuxt-content p{margin-bottom:20px}.clip-ellipse{--tw-bg-opacity:1;background-color:rgb(255 255 255/var(--tw-bg-opacity));-webkit-clip-path:ellipse(60% 100% at 50% 0);clip-path:ellipse(60% 100% at 50% 0);height:100px;width:100%}</style></head>
<body data-head-attrs=""><div id="__nuxt"><!--[--><section class="w-full pb-12 antialiased"><div class="mx-auto max-w-8xl"><div data-v-b5718d32><nav class="transition-colors fixed w-full z-10 top-0" id="header-menu" data-v-b5718d32><div class="max-w-7xl mx-auto px-2 sm:px-6 lg:px-8" data-v-b5718d32><div class="relative flex items-center justify-between h-16" data-v-b5718d32><div class="absolute inset-y-0 left-0 flex items-center sm:hidden" data-v-b5718d32><button type="button" class="inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-white hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-white" aria-controls="mobile-menu" aria-expanded="false" data-v-b5718d32><span class="sr-only" data-v-b5718d32>Open main menu</span><svg class="block h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" data-v-b5718d32><path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" data-v-b5718d32></path></svg><svg class="hidden h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" data-v-b5718d32><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" data-v-b5718d32></path></svg></button></div><div class="flex-1 flex items-center justify-center sm:items-stretch sm:justify-start" data-v-b5718d32><div class="flex-shrink-0 flex items-center" data-v-b5718d32><span class="text-white text-base font-medium font-bruno text-2xl font-to-invert-to-pink" data-v-b5718d32> EventuallyCoding.com </span></div><div class="hidden sm:block sm:ml-6 absolute right-0" data-v-b5718d32><div class="flex space-x-4" data-v-b5718d32><!--[--><a href="/" class="link text-white font-to-invert-to-black" data-v-b5718d32>Home</a><a href="/blog" class="link text-white font-to-invert-to-black" data-v-b5718d32>Blog</a><a href="/resources" class="link text-white font-to-invert-to-black" data-v-b5718d32>Resources</a><!--]--></div></div></div></div></div><div class="hidden" data-v-b5718d32><div class="px-2 pt-2 pb-3 space-y-1" data-v-b5718d32><!--[--><a href="/" class="text-white hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium font-to-invert-to-black" data-v-b5718d32>Home</a><a href="/blog" class="text-white hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium font-to-invert-to-black" data-v-b5718d32>Blog</a><a href="/resources" class="text-white hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium font-to-invert-to-black" data-v-b5718d32>Resources</a><!--]--></div></div></nav></div><!--[--><!--[--><div><section class="flex items-center justify-center h-128 bg-transparent"><canvas id="c" class="-z-10 absolute w-full h-128 block"></canvas><div class="clip-ellipse absolute top-124 rotate-180"></div><!--[--><div class="absolute top-96 w-96 -translate-y-20"><img src="/images/covers/cover7.jpg" alt="Let&#39;s Swing !" class="object-cover"></div><!--]--></section><div class="px-4 mx-auto sm:px-6 xl:max-w-7xl xl:px-0 mt-10"><h1 class="text-4xl text-gray-700 font-extrabold mb-10 text-center">Let&#39;s Swing !</h1><div class="grid grid-cols-3 text-center sm:w-full md:w-1/2 mx-auto"><div><p class="text-center font-bold my-5 text-slate-400 text-xs"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline-block" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg> January 28, 2010</p></div><div><p class="text-center font-bold my-5 text-slate-400 text-xs"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline-block" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> 9 min read</p></div><div class="flex items-center font-medium sm:mx-3 justify-center"><img src="/hugo-nb.jpg" loading="lazy" alt="" class="mr-3 w-10 h-10 rounded-full bg-slate-50 dark:bg-slate-800"><div><div class="font-bold text-slate-400 text-xs">Hugo Lassi√®ge</div><a target="_blank" href="https://twitter.com/hugolassiege" class="font-bold text-sky-400 text-xs hover:text-sky-600"> @hugolassiege</a></div></div></div><div class="sm:w-full md:w-1/2 mx-auto"><p class="mt-2 text-xs my-3 flex flex-wrap -m-1 justify-center"><!--[--><a href="/blog?tag=edt" class="m-1 leading-loose text-slate-400 border border-current lowercase px-2 rounded font-medium">#edt</a><a href="/blog?tag=substance" class="m-1 leading-loose text-slate-400 border border-current lowercase px-2 rounded font-medium">#substance</a><a href="/blog?tag=swing" class="m-1 leading-loose text-slate-400 border border-current lowercase px-2 rounded font-medium">#swing</a><!--]--></p></div><div class="text-left mx-auto"><div class="flex flex-wrap lg:flex-row-reverse py-12"><div class="w-full lg:w-1/4 px-5"><div class="lg:sticky top-0 pt-5 -mt-5"><div class="toc hidden lg:block"><h3 class="border-b-4 pb-3 mb-3 border-gray-200 text-xl">On this page</h3><ul class="pl-0"><!--[--><li class="ml-4 py-1"><a class="text-shark-400 hover:text-smalt-blue-700" href="#ledt-et-la-gestion-des-threads">l&#39;EDT et la gestion des threads</a></li><!--]--></ul></div><div class="text-right mb-12"><div class="relative inline-block text-left ml-2 block lg:hidden"><div><span class="rounded-md shadow-sm"><button type="button" class="inline-flex justify-center w-full rounded-md border border-gray-300 px-4 py-2 bg-white text-sm leading-5 font-medium text-black hover:text-white hover:bg-smalt-blue-500 focus:outline-none transition ease-in-out duration-150" aria-haspopup="true" aria-expanded="true"><!--[-->On this page<!--]--><svg class="-mr-1 ml-2 h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></span></div><!----></div></div></div></div><div class="lg:w-3/4 w-full px-5 max-w-none centered-image"><div id="nuxtContent" class="prose font-proxima text-sm md:text-xl font-medium min-w-full md:p-10 mx-auto"><p><!--[-->Vous connaissez Swing ? Oui, enfin non, pas la <a href="http://fr.wikipedia.org/wiki/Swing_%28musique%29" rel="nofollow" title="Musique swing"><!--[-->musique<!--]--></a>... En plus d&#39;avoir fait danser des g√©n√©rations, il s&#39;agit aussi de la librairie Java pour les interfaces lourdes en Java (ok c&#39;est moins glamour).<!--]--></p><p><!--[-->A propos de Swing on parle souvent de sa grande complexit√© et le moins que l&#39;on puisse dire, c&#39;est que ce n&#39;est pas exag√©r√© (l√† on peut voir la comparaison avec la musique en fin de compte). Profitons de cet article pour revenir sur quelques uns de ces aspects qui en ont d√©j√† d√©rout√© plus d&#39;un¬† :<!--]--></p><ul><!--[--><li><!--[-->la complexit√© de la gestion de l&#39;EDT<!--]--></li><li><!--[-->les pi√®ges du mod√®le √©v√©nementiel.<!--]--></li><!--]--></ul><p><!--[-->Si ces deux points viennent souvent en t√™te des mauvaises pratiques de programmation les plus courantes, leurs effets sont surtout une des causes de <a href="http://www.developpez.net/forums/d833682-4/java/interfaces-graphiques-java/on-faire-client-lourd-java/" rel="nofollow" title="La mauvaise r√©putation de Swing"><!--[-->la mauvaise r√©putation<!--]--></a> de Swing.<!--]--></p><p><!--[-->Allez, entrons dans le vif du sujet.<!--]--></p><h3 id="ledt-et-la-gestion-des-threads"><a href="#ledt-et-la-gestion-des-threads"><!--[-->l&#39;EDT et la gestion des threads<!--]--></a></h3><p><!--[-->L&#39;un des √©ceuils majeurs sur beaucoup d&#39;IHM Java c&#39;est la gestion des threads. En effet Swing repose sur un thread principal pour la gestion de l&#39;affichage. Je ne d√©crirais pas dans le d√©tail l&#39;objet de ce Thread mais celui-ci a pour objectif de repeindre les diff√©rentes parties affich√© dans un certain ordre. Ce thread appel√© EDT (Event dispatcher Thread) suit donc un algorithme relativement s√©quentiel pour l&#39;affichage. Si vous voulez en savoir plus sur l&#39;EDT, je vous conseille la lecture de <a href="http://filthyrichclients.org/" rel="nofollow" title="Filthy Rich Client"><!--[-->Filthy Rich Clients<!--]--></a>, son fonctionnement y est d√©crit en d√©tail dans plusieurs chapitres.<!--]--></p><p><!--[-->Ce qu&#39;il faut en retenir, c&#39;est que l&#39;affichage g√©r√© par l&#39;EDT n&#39;est pas Thread safe ! Les op√©rations li√©es √† l&#39;affichage des composants graphiques est monothread et toute mise √† jour en dehors de ce thread peut avoir un comportement impr√©visible.<!--]--></p><p><!--[-->Ce qui implique :<!--]--></p><ul><!--[--><li><!--[-->si l&#39;affichage est monothread, il faut placer le traitements longs qui ne sont pas li√©s √† l&#39;affichage dans des threads s√©par√©s<!--]--></li><li><!--[-->√† l&#39;inverse, pour les modifications des composants graphiques il faut poster toutes les demandes de modifications de l&#39;IHM dans l&#39;EDT<!--]--></li><!--]--></ul><p><!--[-->sinon vous risquez respectivement :<!--]--></p><ul><!--[--><li><!--[-->d&#39;avoir une application extr√®mement lente puisque les traitements sous-jacents vont ralentir l&#39;affichage<!--]--></li><li><!--[-->d&#39;avoir des erreurs d&#39;affichage puisque les ordres de repaint ne seront pas execut√©s dans le bon sens<!--]--></li><!--]--></ul><p><!--[-->Je vous renvoie √† <a href="http://gfx.developpez.com/tutoriel/java/swing/swing-threading/" rel="nofollow"><!--[-->un excellent article de Romain Guy (Gfx)<!--]--></a>, co-auteur de Filthy Rich Client justement,¬† pour plus de d√©tails.<!--]--></p><p><!--[-->Soyons clairs, d√©butants comme confirm√©s peuvent tomber dans ces pi√®ges. Je vais surtout parler des probl√®mes d&#39;affichage car bien souvent les probl√®mes de lenteur sont plus simples √† d√©busquer (ils arrivent √† des moments pr√©cis du coup on devine &quot;facilement&quot; le traitement qui ralentit).<!--]--></p><h4 id="les-probl√®mes-daffichage"><a href="#les-probl√®mes-daffichage"><!--[-->Les probl√®mes d&#39;affichage<!--]--></a></h4><p><!--[-->Les probl√®mes d&#39;affichage peuvent √™tre beaucoup plus pervers. Vous avez les traditionnels √©crans gris. Mais vous pouvez aussi avoir des choses plus vicieuses :<!--]--></p><ul><!--[--><li><!--[-->des doubles affichages de fen√™tre fantomes,<!--]--></li><li><!--[-->des textes incomplets,<!--]--></li><li><!--[-->des pertes de focus etc...<!--]--></li><!--]--></ul><p><!--[-->Un probl√®me d&#39;affichage comme je l&#39;indiquais r√©sulte de l&#39;EDT qui tente de raffraichir l&#39;√©cran et l&#39;ensemble des informations visibles avec des informations que vous lui avez donn√© de facon incoh√©rente. Par exemple vous avez modifi√© un tableau hors de l&#39;EDT ou repositionn√© une fen√™tre etc...<!--]--></p><p><!--[-->Outre le symptome graphique, vous pouvez rencontrer ce type de trace dans votre application :<!--]--></p><p><!--[-->Exception in thread &quot;AWT-EventQueue-0&quot; java.lang.ArrayIndexOutOfBoundsException: Array index out of range: 5
at java.util.Vector.get(Unknown Source)
at com.developpez.table.TableSelectionModel.isSelectionEmpty(TableSelectionModel.java:565)
at javax.swing.DefaultListSelectionModel.clear(Unknown Source)
at javax.swing.DefaultListSelectionModel.changeSelection(Unknown Source)
at javax.swing.DefaultListSelectionModel.changeSelection(Unknown Source)
at javax.swing.DefaultListSelectionModel.setLeadSelectionIndex(Unknown Source)
at com.developpez.table.TableSelectionModel.clearSelection(TableSelectionModel.java:94)
at com.developpez.table.MyInputBean.focusGained(MyInputBean.java:99)
at java.awt.AWTEventMulticaster.focusGained(Unknown Source)
at java.awt.Component.processFocusEvent(Unknown Source)
at java.awt.Component.processEvent(Unknown Source)
at java.awt.Container.processEvent(Unknown Source)
at java.awt.Component.dispatchEventImpl(Unknown Source)
at java.awt.Container.dispatchEventImpl(Unknown Source)
at java.awt.Component.dispatchEvent(Unknown Source)
at java.awt.KeyboardFocusManager.redispatchEvent(Unknown Source)
at java.awt.DefaultKeyboardFocusManager.typeAheadAssertions(Unknown Source)
at java.awt.DefaultKeyboardFocusManager.dispatchEvent(Unknown Source)
at java.awt.Component.dispatchEventImpl(Unknown Source)
at java.awt.Container.dispatchEventImpl(Unknown Source)
at java.awt.Component.dispatchEvent(Unknown Source)
at java.awt.EventQueue.dispatchEvent(Unknown Source)
at java.awt.EventDispatchThread.pumpOneEventForHierarchy(Unknown Source)
at java.awt.EventDispatchThread.pumpEventsForHierarchy(Unknown Source)
at java.awt.EventDispatchThread.pumpEvents(Unknown Source)
at java.awt.EventDispatchThread.pumpEvents(Unknown Source)
at java.awt.EventDispatchThread.run(Unknown Source)<!--]--></p><p><!--[--><em><!--[-->probl√®me de focus sur une table modifi√© hors de l&#39;EDT<!--]--></em><!--]--></p><p><!--[-->java.lang.ArrayIndexOutOfBoundsException: No such child: 2
at java.awt.Container.getComponent(Container.java:237)
at javax.swing.JComponent.rectangleIsObscured(JComponent.java:3702)
at javax.swing.JComponent.paint(JComponent.java:806)
at javax.swing.JLayeredPane.paint(JLayeredPane.java:557)
at javax.swing.JComponent.paintWithOffscreenBuffer(JComponent.java:4787)
at javax.swing.JComponent.paintDoubleBuffered(JComponent.java:4740)
at javax.swing.JComponent._paintImmediately(JComponent.java:4685)
at javax.swing.JComponent.paintImmediately(JComponent.java:4488)
at javax.swing.RepaintManager.paintDirtyRegions(RepaintManager.java:410)
at javax.swing.SystemEventQueueUtilities$ComponentWorkRequest.run(SystemEventQueueUtilities.java:117)
at java.awt.event.InvocationEvent.dispatch(InvocationEvent.java:189)
at java.awt.EventQueue.dispatchEvent(EventQueue.java:478)
at java.awt.EventDispatchThread.pumpOneEventForHierarchy(EventDispatchThread.java:201)
at java.awt.EventDispatchThread.pumpEventsForHierarchy(EventDispatchThread.java:151)
at java.awt.EventDispatchThread.pumpEvents(EventDispatchThread.java:145)
at java.awt.EventDispatchThread.pumpEvents(EventDispatchThread.java:137)
at java.awt.EventDispatchThread.run(EventDispatchThread.java:100)<!--]--></p><p><!--[--><em><!--[-->probl√®me de repaint sur des zones modifi√© hors de l&#39;EDT<!--]--></em><!--]--></p><p><!--[-->Avec cette stacktrace on se rend compte de la difficult√© du probl√®me : ce n&#39;est pas notre code ^^ Donc en debug il y a de grands risques que l&#39;on ne voit rien. C&#39;est vrai qu&#39;avec un peu d&#39;exp√©rience on comprend rapidement qu&#39;on est face √† un probl√®me d&#39;EDT mais traquer manuellement le code responsable reste p√©nible.<!--]--></p><h4 id="les-solutions"><a href="#les-solutions"><!--[-->Les solutions<!--]--></a></h4><p><!--[-->Heureusement, certains ont pris le temps de r√©fl√©chir √† cet √©pineux probl√®me et il existe plusieurs solutions.<!--]--></p><p><!--[-->Attention, toutes les solutions d√©crites ci-dessous s&#39;attachent √† la d√©tection des bouts de codes fautifs. Une fois le code rep√©r√©, c&#39;est √† vous de le corriger. Ce ne sont pas des fix magiques qui rendent clean votre code.<!--]--></p><h5 id="swinghelper-httpsswinghelperdevjavanet"><!--[-->Swinghelper (<a href="https://swinghelper.dev.java.net/" rel="nofollow" title="SwingHelper"><!--[-->https://swinghelper.dev.java.net/<!--]--></a>)<!--]--></h5><p><!--[-->Au sein du swinglab on retrouve Swinghelper, un projet d&#39;utilitaires qui permet justement de d√©tecter les mises √† jour hors de l&#39;EDT via un ThreadCheckingRepaintManager. Ce repaint manager permet de d√©tecter que les ordres de repaint ont √©t√© envoy√© dans l&#39;EDT, dans le cas contraire on affiche une belle stacktrace qui permet de retrouver le bout de code fautif. Cependant cette m√©thode a pour d√©faut qu&#39;elle ne prend pas en compte les appels qui n&#39;envoient pas de repaint (les getters par exemple). C&#39;est d√©j√† une bonne premi√®re piste et c&#39;est assez peu intrusif.<!--]--></p><h5 id="substance-httpssubstancedevjavanet"><!--[-->Substance (<a href="https://substance.dev.java.net/" rel="nofollow" title="Substance"><!--[-->https://substance.dev.java.net/<!--]--></a>)<!--]--></h5><p><!--[-->La c&#39;est un peu plus qu&#39;une solution de d√©tection de la mauvaise utilisation de l&#39;EDT et c&#39;est assez intrusif. Substance est une librairie de look and feel java assez sympa dont j&#39;ai d√©j√† parl√© <a href="http://localhost/localweb/wordpress/?p=136" rel="nofollow" title="Substance, une librairie ¬´¬†hype¬†¬ª pour Swing"><!--[-->dans un pr√©c√©dent billet<!--]--></a>. Et c&#39;est Substance qui rajoute un check de coh√©rence dans votre application Swing. Si on se r√©f√®re √† <a href="http://www.pushing-pixels.org/?p=368" rel="nofollow"><!--[-->l&#39;article de l&#39;auteur<!--]--></a>, d√®s qu&#39;un composant est cr√©√©, Substance va faire un check lors de l&#39;appel √† createUI. Ca ne prend pas en compte tout les cas de figure (seul les instanciations de composants sont blind√©s) mais c&#39;est une s√©curit√© suppl√©mentaire pour √©viter une mauvaise programmation. Utiliser Substance juste pour cette fonctionnalit√© serait ridicule, par contre si vous l&#39;avez adopt√© pour ces look and feel cette fonctionnalit√© est un bonus appr√©ciable.<!--]--></p><h5 id="les-aspects"><!--[-->Les aspects<!--]--></h5><p><!--[-->La <a href="http://ewawszczyk.developpez.com/tutoriel/java/spring/aop/" rel="nofollow" title="Programmation par aspect"><!--[-->programmation par aspect<!--]--></a> trouve ici une bonne application.<!--]--></p><p><!--[-->L&#39;utilisation de l&#39;AOP pour le d√©buggage Swing a √©t√© d√©crite <a href="http://weblogs.java.net/blog/alexfromsun/archive/2006/02/debugging_swing.html" rel="nofollow" title="Swing debug"><!--[-->sur l&#39;article suivant<!--]--></a> en anglais par Alexander Potochkin. L&#39;aspect cr√©√© par l&#39;auteur permet ici d&#39;enrober les appels sur les JComponents pour d√©tecter tout appel Swing hors de l&#39;EDT.<!--]--></p><p><!--[-->Le code de l&#39;aspect :<!--]--></p><p><!--[-->import javax.swing.*;<!--]--></p><p><!--[-->aspect EdtRuleChecker
{
private boolean isStressChecking = true;<!--]--></p><p><!--[-->public pointcut anySwingMethods(JComponent c):
target(c) &amp;&amp; call(* *(..));<!--]--></p><p><!--[-->public pointcut threadSafeMethods():
call(* repaint(..)) ||
call(* revalidate()) ||
call(* invalidate()) ||
call(* getListeners(..)) ||
call(* add*Listener(..)) ||
call(* remove*Listener(..));<!--]--></p><p><!--[-->//calls of any JComponent method, including subclasses
before(JComponent c): anySwingMethods(c) &amp;&amp; !threadSafeMethods() &amp;&amp;¬†¬†¬† !within(EdtRuleChecker)
{
if(!SwingUtilities.isEventDispatchThread() &amp;&amp; (isStressChecking || c.isShowing()))
{
System.err.println(thisJoinPoint.getSourceLocation());
System.err.println(thisJoinPoint.getSignature());
System.err.println();
}
}<!--]--></p><p><!--[-->//calls of any JComponent constructor, including subclasses
before(): call(JComponent+.new(..))
{
if (isStressChecking &amp;&amp; !SwingUtilities.isEventDispatchThread())
{
System.err.println(thisJoinPoint.getSourceLocation());
System.err.println(thisJoinPoint.getSignature() +
&quot; *constructor*&quot;);
System.err.println();
}
}
}<!--]--></p><p><!--[-->Cet aspect permet d&#39;intercepter toutes les m√©thodes non thread safe pour les afficher. Evidemment il y a un peu plus de mise en place pour l&#39;utiliser. Personnellement j&#39;ai utilis√© le <a href="http://www.eclipse.org/ajdt/" rel="nofollow" title="Plugin AspectJ pour Eclipse"><!--[-->plugin AspectJ pour eclipse<!--]--></a> qui m&#39;a permis d&#39;utiliser directement aspectJ au runtime lors d&#39;une s√©ance de debugging eclipse.<!--]--></p><p><!--[-->Attention, certains pourraient vouloir modifier cet aspect pour directement reposter les √©v√®nements dans l&#39;EDT avec <a href="http://java.sun.com/javase/6/docs/api/javax/swing/SwingUtilities.html#invokeAndWait%28java.lang.Runnable%29" rel="nofollow" title="Swing utilities"><!--[-->SwingUtilitiesHelper.invokeAndWait<!--]--></a>. Je le d√©conseille, ce serait une rustine. Nettoyez plut√¥t votre code.<!--]--></p><h5 id="conclusion"><!--[-->Conclusion<!--]--></h5><p><!--[-->Voil√†, rien de magique mais des m√©thodes tr√®s efficaces qui selon les contextes devraient vraiment vous aider. J&#39;ai personnellement utilis√© les aspects sur une appli un peu vieillote sur laquelle j&#39;ai travaill√© et sur laquelle la r√™gle de l&#39;EDT n&#39;avait jamais √©t√© respect√©. Sur un code m√™me modeste de 40 000 lignes je ne m&#39;en serais jamais sorti manuellement ^^<!--]--></p><h4 id="le-mod√®le-√©v√®nementiel"><a href="#le-mod√®le-√©v√®nementiel"><!--[-->Le mod√®le √©v√®nementiel<!--]--></a></h4><p><!--[-->En Swing on parle souvent de <a href="http://fr.wikipedia.org/wiki/Programmation_%C3%A9v%C3%A9nementielle" rel="nofollow" title="Programmation √©venementielle"><!--[-->programmation √©v√®nementielle<!--]--></a>. Plusieurs types d&#39;√©v√®nements peuvent √™tre &quot;√©cout√©s&quot; pour d√©clencher des actions : click sur un bouton, gain de focus, etc....<!--]--></p><p><!--[-->Dans ce type de programmation on utilise souvent le design pattern Observer. Je vous laisse lire l&#39;article suivant si vous ne connaissez pas ce pattern : <a href="http://www.design-patterns.fr/Observateur.html" rel="nofollow"><!--[-->http://www.design-patterns.fr/Observateur.html<!--]--></a>. Or ce design pattern a un d√©faut assez commun si on l&#39;utilise mal : les fuites m√©moires<!--]--></p><p><!--[-->Prenons un exemple simple :<!--]--></p><ol><!--[--><li><!--[-->un observateur O<!--]--></li><li><!--[-->un observ√© A s&#39;inscrit aupr√®s de O<!--]--></li><li><!--[-->l&#39;observ√© A n&#39;est plus utilis√© pour une raison quelconque<!--]--></li><!--]--></ol><p><!--[-->Dans cet exemple, le d√©veloppeur n&#39;utilisant plus l&#39;objet A va s&#39;attendre √† ce que celui-ci soit collect√© par le garbage collector. Or il n&#39;en sera jamais rien puisqu&#39;une r√©f√©rence subsiste aupr√®s de O qui continue d&#39;observer A. Il aurait fallu que l&#39;objet A se d√©sinscrivent pour ne plus conserver de r√©f√©rences actives.<!--]--></p><p><!--[-->(Plus d&#39;info sur le garbage collector <a href="http://gfx.developpez.com/tutoriel/java/gc/" rel="nofollow" title="Garbage collector"><!--[-->ici<!--]--></a>)<!--]--></p><p><!--[-->Ce type de probl√®mes est rencontr√© tr√®s fr√©quemment dans les applications Swing. Je l&#39;ai rencontr√© lors d&#39;une mission ou ce design pattern avait √©t√© beaucoup utilis√© sans jamais penser √† la d√©sinscription des observ√©s. Lors des phases de d√©veloppement les concepteurs n&#39;avaient pas d√©tect√© ce probl√®me. Mais en production, au bout de plusieurs heures d&#39;utilisation l&#39;application a commenc√© √† beaucoup consomm√© et √™tre tr√®s lente, avant de finalement crasher avec un OutOfMemoryError.<!--]--></p><p><!--[-->Ok, mais que faire sur une application existante pour laquelle la recherche de ces mauvaises utilisations va prendre beaucoup de temps et risque de ne pas √™tre triviale ?<!--]--></p><h5 id="une-solution-utiliser-les-weak-references-"><!--[-->Une solution, utiliser les weak references !<!--]--></h5><p><!--[-->La WeakReference va vous permettre de n&#39;intervenir que sur le code des observateurs et donc de centraliser votre correction.<!--]--></p><p><!--[-->On peut en trouver une impl√©mentation sur un <a href="http://gfx.developpez.com/tutoriel/java/reference-memoire/" rel="nofollow"><!--[-->article de Romain Guy sur developpez.com<!--]--></a>.<!--]--></p><p><!--[-->Voici un code succinct qui vous permettra de la comprendre :<!--]--></p><p><!--[-->protected void fireMessageCalled(MyEvent e)
{
int count = listeners.size();
for (int i = 0; i &lt; count; i++)
{
WeakReference ref = (WeakReference) listeners.elementAt(i);
final myListener listener = (myListener) ref.get();
if (listener != null)
{
listener.messageCalled(e);
} else
{
listeners.remove(ref);
}
}
}<!--]--></p><p><!--[-->Ici l&#39;√©v√®nement d√©clench√© appelle la m√©thode fireMessageCalled. Celui ci parcourt la liste des listeners (les observ√©s) et les notifie. Si un des listener n&#39;est plus r√©f√©renc√©, alors sa r√©f√©rence sera nulle car nous avons utilis√© des r√©f√©rences faibles (WeakReference).<!--]--></p><p><!--[-->Une autre impl√©mentation pour simplifier le code pourra √™tre d&#39;utiliser une <a href="http://java.sun.com/j2se/1.5.0/docs/api/java/util/WeakHashMap.html" rel="nofollow" title="WeakHashMap"><!--[-->WeakHashMap.<!--]--></a><!--]--></p><p><!--[-->Cette fois c&#39;est la collection qui va g√©rer la suppression des √©l√©ments qui ne sont plus r√©f√©renc√©s.<!--]--></p><p><!--[--><strong><!--[-->Attention<!--]--></strong> cependant, la cl√© dans la map sera l&#39;observ√© lui-m√™me. Il faut donc impl√©menter les m√©thodes hashcode et equals et faire en sorte que ces m√©thodes renvoient un r√©sultat qui ne varie pas au cours du temps (immuabilit√© de la cl√©). Je vous invite √† lire attentivement les petits warnings indiqu√©s dans la JavaDoc de cette classe sur son utilisation.<!--]--></p><h5 id="conclusion-1"><!--[-->Conclusion<!--]--></h5><p><!--[-->Cette m√©thode ne pourra s&#39;appliquer qu&#39;√† votre code et vous √©vitera d&#39;impl√©menter des m√©thodes pour d√©sinscrire les observ√©s. Cependant que cela ne vous donne pas de mauvaises habitudes, ces m√©thodes existent pour les observateurs de l&#39;API Swing et si elles sont la c&#39;est pas pour la d√©co !<!--]--></p><p><!--[-->Voil√†, en esp√©rant que ces petites astuces auront pu vous aider. En me basant sur ce que j&#39;ai vu ce sont deux probl√®mes qui reviennent souvent, y compris pour des d√©veloppeurs confirm√©s alors ne faites pas l&#39;impasse dessus !<!--]--></p><p><!--[-->a+<!--]--></p></div></div></div></div><hr class="mb-12"><div><span> Partager sur : </span><div class="mt-4"><a href="https://facebook.com/sharer/sharer.php?u=https://eventuallycoding.com2010/01/28/lets-swing" target="_blank" rel="noopener" aria-label=""><button type="button" class="text-white bg-[#3b5998] hover:bg-[#3b5998]/90 focus:ring-4 focus:outline-none focus:ring-[#3b5998]/50 font-medium rounded-lg text-sm px-3 py-3 text-center inline-flex items-center dark:focus:ring-[#3b5998]/55 mr-2 mb-2"><svg class="w-6 h-6" aria-hidden="true" focusable="false" data-prefix="fab" data-icon="facebook-f" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M279.1 288l14.22-92.66h-88.91v-60.13c0-25.35 12.42-50.06 52.24-50.06h40.42V6.26S260.4 0 225.4 0c-73.22 0-121.1 44.38-121.1 124.7v70.62H22.89V288h81.39v224h100.2V288z"></path></svg></button></a><a href="https://twitter.com/share?url=https://eventuallycoding.com2010/01/28/lets-swing&amp;text=Let&#39;s Swing !&amp;via=hugolassiege" target="_blank" title="Share on Twitter" rel="noopener noreferrer"><button type="button" class="text-white bg-[#1da1f2] hover:bg-[#1da1f2]/90 focus:ring-4 focus:outline-none focus:ring-[#1da1f2]/50 font-medium rounded-lg text-sm px-3 py-3 text-center inline-flex items-center dark:focus:ring-[#1da1f2]/55 mr-2 mb-2"><svg class="w-6 h-6" aria-hidden="true" focusable="false" data-prefix="fab" data-icon="twitter" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M459.4 151.7c.325 4.548 .325 9.097 .325 13.65 0 138.7-105.6 298.6-298.6 298.6-59.45 0-114.7-17.22-161.1-47.11 8.447 .974 16.57 1.299 25.34 1.299 49.06 0 94.21-16.57 130.3-44.83-46.13-.975-84.79-31.19-98.11-72.77 6.498 .974 12.99 1.624 19.82 1.624 9.421 0 18.84-1.3 27.61-3.573-48.08-9.747-84.14-51.98-84.14-102.1v-1.299c13.97 7.797 30.21 12.67 47.43 13.32-28.26-18.84-46.78-51.01-46.78-87.39 0-19.49 5.197-37.36 14.29-52.95 51.65 63.67 129.3 105.3 216.4 109.8-1.624-7.797-2.599-15.92-2.599-24.04 0-57.83 46.78-104.9 104.9-104.9 30.21 0 57.5 12.67 76.67 33.14 23.72-4.548 46.46-13.32 66.6-25.34-7.798 24.37-24.37 44.83-46.13 57.83 21.12-2.273 41.58-8.122 60.43-16.24-14.29 20.79-32.16 39.31-52.63 54.25z"></path></svg></button></a></div></div><!----><div id="hyvor-talk-view"></div></div></div><!--]--><!--]--><footer class="lg:mt-52 border-t border-t-2"><div class="flex flex-col items-center mt-16"><div class="flex mb-3 space-x-4"><a target="_self" href="/rss.xml" class="text-sm text-gray-500 transition hover:text-gray-600"><img class="transition-transform hover:scale-110 w-8 h-8" src="/_nuxt/rss.9e0b880c.svg"></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="nofollow noopener noreferrer" href="https://github.com/hlassiege"><span class="sr-only">github</span><img class="transition-transform hover:scale-110 w-8 h-8" src="/_nuxt/github_new.4e3fe23c.svg"></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://www.linkedin.com/in/hugolassiege/"><span class="sr-only">Linkedin</span><img class="transition-transform hover:scale-110 w-8 h-8" src="/_nuxt/linkeding.34c3bc6d.svg"></a><a target="_blank" rel="nofollow noopener noreferrer" href="https://twitter.com/hugolassiege" class="text-sm text-gray-500 transition hover:text-gray-600"><img class="transition-transform hover:scale-110 w-8 h-8" src="/_nuxt/twitter.457cff27.svg"></a></div><div class="flex mb-2 space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>Copyright ¬© 2022</div><div>‚Ä¢</div> EventuallyCoding - A la fin de l&#39;envoi, je code !</div><div class="text-sm text-gray-500">Credits to www.freepik.com - <a href="https://www.freepik.com/vectors/citizen">Citizen vector created by freepik - </a><a href="https://www.freepik.com/vectors/css">Css vector created by vectorjuice</a></div></div></footer></div></section><!--]--></div><script type="module">import p from "/2010/01/28/lets-swing/_payload.js";window.__NUXT__={...p,...((function(a,b){return {state:{},_errors:{},serverRendered:true,config:{public:{content:{clientDB:{isSPA:a,integrity:1668116682115},navigation:{fields:[]},base:"_content",tags:{p:"prose-p",a:"prose-a",blockquote:"prose-blockquote","code-inline":"prose-code-inline",code:"prose-code",em:"prose-em",h1:"prose-h1",h2:"prose-h2",h3:"prose-h3",h4:"prose-h4",h5:"prose-h5",h6:"prose-h6",hr:"prose-hr",img:"prose-img",ul:"prose-ul",ol:"prose-ol",li:"prose-li",strong:"prose-strong",table:"prose-table",thead:"prose-thead",tbody:"prose-tbody",td:"prose-td",th:"prose-th",tr:"prose-tr"},highlight:a,wsUrl:b,documentDriven:a,anchorLinks:{depth:4,exclude:[1]}}},app:{baseURL:"\u002F",buildAssetsDir:"\u002F_nuxt\u002F",cdnURL:b}},prerenderedAt:1668116720435}}(false,"")))}</script><script type="module" src="/_nuxt/entry.fcab9936.js" crossorigin></script><script type="module" src="/_nuxt/default.4dae085d.js" crossorigin></script><script type="module" src="/_nuxt/TheHeader.80ba6813.js" crossorigin></script><script type="module" src="/_nuxt/_id_.3f719124.js" crossorigin></script><script type="module" src="/_nuxt/TheFooter.105aff6f.js" crossorigin></script><script type="module" src="/_nuxt/HeroSection.bfef0b1b.js" crossorigin></script><script type="module" src="/_nuxt/PageSidebar.5a145493.js" crossorigin></script><script type="module" src="/_nuxt/Dropdown.689d645d.js" crossorigin></script><script type="module" src="/_nuxt/ContentRenderer.1a0871f4.js" crossorigin></script><script type="module" src="/_nuxt/ContentRendererMarkdown.ccdf1d5f.js" crossorigin></script><script type="module" src="/_nuxt/ProseP.c989a686.js" crossorigin></script><script type="module" src="/_nuxt/ProseA.7367bf3d.js" crossorigin></script><script type="module" src="/_nuxt/ProseUl.81ca777e.js" crossorigin></script><script type="module" src="/_nuxt/ProseLi.d738630a.js" crossorigin></script><script type="module" src="/_nuxt/ProseH3.c5819dab.js" crossorigin></script><script type="module" src="/_nuxt/ProseH4.f28d56da.js" crossorigin></script><script type="module" src="/_nuxt/ProseEm.56cdc98b.js" crossorigin></script><script type="module" src="/_nuxt/ProseH5.0e8273c0.js" crossorigin></script><script type="module" src="/_nuxt/ProseOl.650c9814.js" crossorigin></script><script type="module" src="/_nuxt/ProseStrong.1bfd5325.js" crossorigin></script></body>
</html>
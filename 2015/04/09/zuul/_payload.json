[{"data":1,"prerenderedAt":384},["Reactive",2],{"/articles/2015/04/09/zuul":3},{"_path":4,"_dir":5,"_draft":6,"_partial":6,"_locale":7,"title":8,"description":9,"id":10,"date":11,"categories":12,"tags":14,"cover":20,"readingTime":21,"body":26,"_type":379,"_id":380,"_source":381,"_file":382,"_extension":383},"/articles/2015/04/09/zuul","09",false,"","Micro-services : routing avec Zuul","[![spring-cloud](/images/3b14a-spring-cloud.png)](http://eventuallycoding.com/wp-content/uploads/2015/04/3b14a-spring-cloud.png)Long time no see, le d...","1160","2015-04-09",[13],"waza",[15,16,17,18,19],"backend","microservices","spring-boot","spring-cloud","zuul","3b14a-spring-cloud.png",{"text":22,"minutes":23,"time":24,"words":25},"3 min read",2.76,165600,552,{"type":27,"children":28,"toc":376},"root",[29,42,107,112,117,158,172,202,216,221,234,239,244,249,262,267,285,290,295,300,305,310,315,320,339,357,362,371],{"type":30,"tag":31,"props":32,"children":33},"element","p",{},[34,39],{"type":30,"tag":35,"props":36,"children":38},"img",{"alt":18,"src":37},"/images/3b14a-spring-cloud.png",[],{"type":40,"value":41},"text","Long time no see, le dernier billet de blog date de janvier, une éternité en temps de développement. Ce délai car nous avons beaucoup travaillé sur Hopwork à repenser notre architecture et du coup, et bien je n'avais pas le temps pour blogger ^^ Mais qu'avons nous fait justement ? Eh bien nous avions déjà entamé un premier virage vers les micro services l'année dernière mais il restait encore beaucoup de points à adresser. Le temps pour passer de \"grosse appli monolithique\" à \"plein de trucs qui communiquent entre eux\" est non négligeable et on découvre des tas de petits détails qu'on n'imagine pas au début :",{"type":30,"tag":43,"props":44,"children":45},"ul",{},[46,52,57,62,67,72,77,82,87,92,97,102],{"type":30,"tag":47,"props":48,"children":49},"li",{},[50],{"type":40,"value":51},"comment gérer une fédération d'identité (one login to rule them all)",{"type":30,"tag":47,"props":53,"children":54},{},[55],{"type":40,"value":56},"gérer une configuration distribuée",{"type":30,"tag":47,"props":58,"children":59},{},[60],{"type":40,"value":61},"le routage",{"type":30,"tag":47,"props":63,"children":64},{},[65],{"type":40,"value":66},"le load balancing",{"type":30,"tag":47,"props":68,"children":69},{},[70],{"type":40,"value":71},"dispatcher des évènements sur plusieurs services",{"type":30,"tag":47,"props":73,"children":74},{},[75],{"type":40,"value":76},"les jobs",{"type":30,"tag":47,"props":78,"children":79},{},[80],{"type":40,"value":81},"la découverte de services",{"type":30,"tag":47,"props":83,"children":84},{},[85],{"type":40,"value":86},"simplifier l'écriture des appels de services",{"type":30,"tag":47,"props":88,"children":89},{},[90],{"type":40,"value":91},"la composition de page",{"type":30,"tag":47,"props":93,"children":94},{},[95],{"type":40,"value":96},"la résistance aux pannes",{"type":30,"tag":47,"props":98,"children":99},{},[100],{"type":40,"value":101},"le monitoring",{"type":30,"tag":47,"props":103,"children":104},{},[105],{"type":40,"value":106},"le déploiement",{"type":30,"tag":31,"props":108,"children":109},{},[110],{"type":40,"value":111},"etc...",{"type":30,"tag":31,"props":113,"children":114},{},[115],{"type":40,"value":116},"Je vais essayer de parler de ces points à travers différents futurs articles. Et je vous propose de commencer par le routage.",{"type":30,"tag":31,"props":118,"children":119},{},[120,122,132,134,141,143,150,152],{"type":40,"value":121},"Si on a beaucoup parlé de ",{"type":30,"tag":123,"props":124,"children":129},"a",{"href":125,"rel":126,"title":128},"http://www.eventuallycoding.com/index.php/spring-boot-dans-le-doute-reboote/",[127],"nofollow","Spring Boot : dans le doute reboote",[130],{"type":40,"value":131},"Spring boot",{"type":40,"value":133}," ces derniers temps, un autre projet de Spring va sans doute devenir l'un des plus importants sujets de discussion dans les prochains mois, le dénommé ",{"type":30,"tag":123,"props":135,"children":139},{"href":136,"rel":137,"title":138},"http://projects.spring.io/spring-cloud/",[127],"Spring cloud",[140],{"type":40,"value":138},{"type":40,"value":142},". Si Spring-Cloud a désormais presque un an au compteur pour sa version 1.0.0, les composants qui vont tout changer pour ceux qui pratiquent les micro services en Java ont à peine 1 mois en version stable : ",{"type":30,"tag":123,"props":144,"children":147},{"href":145,"rel":146},"http://cloud.spring.io/spring-cloud-netflix/spring-cloud-netflix.html",[127],[148],{"type":40,"value":149},"Spring-cloud-netflix",{"type":40,"value":151},", première release en ",{"type":30,"tag":153,"props":154,"children":155},"strong",{},[156],{"type":40,"value":157},"mars 2015",{"type":30,"tag":31,"props":159,"children":160},{},[161,163,170],{"type":40,"value":162},"Basiquement, il s'agit de l'intégration des outils de ",{"type":30,"tag":123,"props":164,"children":167},{"href":165,"rel":166},"https://github.com/Netflix",[127],[168],{"type":40,"value":169},"netflix",{"type":40,"value":171}," dans la stack spring-boot. Cette fameuse stack netflix, c'est celle qui leur sert pour que leur site soit \"hautement disponible\" et oui, on peut dire que leur intégration dans la stack Spring est une sacré bonne nouvelle",{"type":30,"tag":43,"props":173,"children":174},{},[175,184,193],{"type":30,"tag":47,"props":176,"children":177},{},[178],{"type":30,"tag":123,"props":179,"children":182},{"href":180,"rel":181},"http://fr.slideshare.net/stonse/microservices-at-netflix",[127],[183],{"type":40,"value":180},{"type":30,"tag":47,"props":185,"children":186},{},[187],{"type":30,"tag":123,"props":188,"children":191},{"href":189,"rel":190},"http://techblog.netflix.com/2012/11/hystrix.html",[127],[192],{"type":40,"value":189},{"type":30,"tag":47,"props":194,"children":195},{},[196],{"type":30,"tag":123,"props":197,"children":200},{"href":198,"rel":199},"http://techblog.netflix.com/2013/01/announcing-ribbon-tying-netflix-mid.html",[127],[201],{"type":40,"value":198},{"type":30,"tag":31,"props":203,"children":204},{},[205,207,214],{"type":40,"value":206},"Prenons l'un des premiers pour l'instant, ",{"type":30,"tag":123,"props":208,"children":211},{"href":209,"rel":210},"https://github.com/Netflix/zuul",[127],[212],{"type":40,"value":213},"Zuul",{"type":40,"value":215},".",{"type":30,"tag":31,"props":217,"children":218},{},[219],{"type":40,"value":220},"Non, pas le gardien du portail dans Ghostbusters...",{"type":30,"tag":31,"props":222,"children":223},{},[224],{"type":30,"tag":123,"props":225,"children":228},{"href":226,"rel":227},"http://eventuallycoding.com/wp-content/uploads/2015/04/716c0-zuulterrordog1.png",[127],[229],{"type":30,"tag":35,"props":230,"children":233},{"alt":231,"src":232},"ZuulTerrorDog1","/images/716c0-zuulterrordog1.png",[],{"type":30,"tag":31,"props":235,"children":236},{},[237],{"type":40,"value":238},"Zuul est l'un des composants de base de la stack, c'est en soi un simple reverse proxy Java. Un reverse proxy, c'est un routeur qui va dispatcher vos utilisateurs sur vos différents services en fonction des urls appelés.",{"type":30,"tag":31,"props":240,"children":241},{},[242],{"type":40,"value":243},"Par exemple un appel sur /blog renverra vers le blog, un appel vers /forum vers le forum etc...",{"type":30,"tag":31,"props":245,"children":246},{},[247],{"type":40,"value":248},"Pour tout les services \"externes\", on utilisera apache ou nginx qui sont de très bons outils pour cela. Par exemple avec nginx pour une redirection vers le blog de hopwork :",{"type":30,"tag":31,"props":250,"children":251},{},[252,254,260],{"type":40,"value":253},"location /blog {\nrewrite ^/blog/(.*) /$1 break;\nproxy_pass ",{"type":30,"tag":123,"props":255,"children":258},{"href":256,"rel":257},"https://rblog.hopwork.com",[127],[259],{"type":40,"value":256},{"type":40,"value":261},";\nproxy_read_timeout 90;\n}",{"type":30,"tag":31,"props":263,"children":264},{},[265],{"type":40,"value":266},"Mais Zuul va apporter quelques petites choses en plus lorsqu'il s'agit d'une architecture micro services :",{"type":30,"tag":43,"props":268,"children":269},{},[270,275,280],{"type":30,"tag":47,"props":271,"children":272},{},[273],{"type":40,"value":274},"un routage dynamique et du load balancing (on verra plus tard avec eureka et ribbon)",{"type":30,"tag":47,"props":276,"children":277},{},[278],{"type":40,"value":279},"la gestion de coupe circuit (on verra plus tard avec hystrix)",{"type":30,"tag":47,"props":281,"children":282},{},[283],{"type":40,"value":284},"des filtres",{"type":30,"tag":31,"props":286,"children":287},{},[288],{"type":40,"value":289},"et, point non négligeable, aucun nginx à configurer sur le poste du développeur pour bénéficier d'un reverse proxy pendant la phase de dev.",{"type":30,"tag":31,"props":291,"children":292},{},[293],{"type":40,"value":294},"Et comment ça marche ?",{"type":30,"tag":31,"props":296,"children":297},{},[298],{"type":40,"value":299},"Eh bien c'est vraiment très simple.",{"type":30,"tag":31,"props":301,"children":302},{},[303],{"type":40,"value":304},"Voici une appli Spring boot qui utilise Zuul :",{"type":30,"tag":31,"props":306,"children":307},{},[308],{"type":40,"value":309},"@SpringBootApplication\n@EnableZuulProxy\npublic class FrontApplication {\npublic static void main(String[] args) {\nSpringApplication.run(FrontApplication.class, args);\n}\n}",{"type":30,"tag":31,"props":311,"children":312},{},[313],{"type":40,"value":314},"Simple non ? Juste une annotation pour démarrer Zuul.",{"type":30,"tag":31,"props":316,"children":317},{},[318],{"type":40,"value":319},"Ensuite vous avez une configuration vous permettant de définir votre routing dans votre fichier application.yml",{"type":30,"tag":31,"props":321,"children":322},{},[323,325,331,333],{"type":40,"value":324},"zuul:\nroutes:\nresource1:\npath: /resource1/**\nurl: ",{"type":30,"tag":123,"props":326,"children":329},{"href":327,"rel":328},"http://localhost:9001/resource1/",[127],[330],{"type":40,"value":327},{"type":40,"value":332},"\nresource2:\npath: /resource2/**\nurl: ",{"type":30,"tag":123,"props":334,"children":337},{"href":335,"rel":336},"http://localhost:9002/resource2/",[127],[338],{"type":40,"value":335},{"type":30,"tag":31,"props":340,"children":341},{},[342,344,350,352],{"type":40,"value":343},"Et c'est terminé. Désormais pour l'utilisateur, il verra ",{"type":30,"tag":123,"props":345,"children":348},{"href":346,"rel":347},"http://localhost:8080/resource1",[127],[349],{"type":40,"value":346},{"type":40,"value":351}," mais en réalité il sera sur ",{"type":30,"tag":123,"props":353,"children":355},{"href":327,"rel":354},[127],[356],{"type":40,"value":327},{"type":30,"tag":31,"props":358,"children":359},{},[360],{"type":40,"value":361},"Pour l'essayer vous même, le projet d'exemple est sur github",{"type":30,"tag":31,"props":363,"children":364},{},[365],{"type":30,"tag":123,"props":366,"children":369},{"href":367,"rel":368},"https://github.com/hlassiege/zuul-sample",[127],[370],{"type":40,"value":367},{"type":30,"tag":31,"props":372,"children":373},{},[374],{"type":40,"value":375},"La suite dans les prochains billets.",{"title":7,"searchDepth":377,"depth":377,"links":378},2,[],"markdown","content:articles:2015:04:09:zuul.md","content","articles/2015/04/09/zuul.md","md",1700467047534]
<!DOCTYPE html>
<html lang="fr">
<head><meta charset="utf-8">
<title>Micro-services : la composition de page avec Zuul et Sitemesh | EventuallyCoding</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://digianalytics.fr/pixel/73jqBv5FmFIZiWt2" defer="" type="text/javascript"></script>
<meta name="description" content="[![03BC](/images/07933-03bc.gif)](http://eventuallycoding.com/wp-content/uploads/2015/04/07933-03bc.gif) Le dernier billet de ce blog entamait une min...">
<meta name="og:description" content="[![03BC](/images/07933-03bc.gif)](http://eventuallycoding.com/wp-content/uploads/2015/04/07933-03bc.gif) Le dernier billet de ce blog entamait une min...">
<meta name="og:type" content="article">
<meta name="og:title" content="Micro-services : la composition de page avec Zuul et Sitemesh">
<meta name="og:url" content="https://eventuallycoding.com/2015/04/13/micro-services-la-composition-de-page-avec-zuul-et-sitemesh">
<meta name="og:image" content="https://eventuallycoding.com/images/covers/cover2.jpg">
<meta name="og:image:alt" content="Micro-services : la composition de page avec Zuul et Sitemesh">
<meta name="twitter:text:title" content="Micro-services : la composition de page avec Zuul et Sitemesh">
<meta name="twitter:image" content="https://eventuallycoding.com/images/covers/cover2.jpg">
<meta name="twitter:card" content="summary">
<meta name="article:published_time" content="2015-04-13T00:00:00.000Z">
<meta name="article:article:modified_time" content="2015-04-13T00:00:00.000Z">
<meta name="article:article:tag" content="backend,microservices,sitemesh,spring-boot,zuul">
<link rel="canonical" href="https://eventuallycoding.com/2015/04/13/micro-services-la-composition-de-page-avec-zuul-et-sitemesh">
<link rel="alternate" href="https://eventuallycoding.com/2015/04/13/micro-services-la-composition-de-page-avec-zuul-et-sitemesh" hreflang="fr"><link rel="modulepreload" href="/2015/04/13/micro-services-la-composition-de-page-avec-zuul-et-sitemesh/_payload.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/entry.4e8e9ab9.js"><link rel="preload" as="style" href="/_nuxt/entry.b1b3c88d.css"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/default.743f7445.js"><link rel="preload" as="style" href="/_nuxt/TheHeader.e21518f4.css"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/nuxt-link.e9d75e63.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/siteMetaData.b74feb44.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/_id_.4a64e0b1.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/Dropdown.15ce24da.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/_commonjsHelpers.28e086c5.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ContentRenderer.3100fbb0.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ContentRendererMarkdown.4cbb432c.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/index.a6ef77ff.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/query.45aca0d8.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/index.61d74bb5.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/utils.b17ecf85.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/composables.c57ce97e.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseP.497c769a.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseA.ae2ece81.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseImg.792b26d4.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseUl.4aa2bcf5.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseLi.be1ca92a.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseH2.d151cff5.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseTable.5798b369.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseThead.b92c4ff8.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseTr.d615d78c.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseTh.2384a209.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseTbody.15d8a727.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseTd.e1a62aba.js"><link rel="prefetch" as="script" crossorigin href="/_nuxt/error-component.debf2df0.js"><link rel="prefetch" as="image" type="image/svg+xml" href="/_nuxt/github_new.4e3fe23c.svg"><link rel="prefetch" as="image" type="image/svg+xml" href="/_nuxt/rss.9e0b880c.svg"><link rel="prefetch" as="image" type="image/svg+xml" href="/_nuxt/mastodon.f0ecdde8.svg"><link rel="prefetch" as="image" type="image/svg+xml" href="/_nuxt/linkeding.34c3bc6d.svg"><link rel="prefetch" as="image" type="image/svg+xml" href="/_nuxt/twitter.457cff27.svg"><link rel="stylesheet" href="/_nuxt/entry.b1b3c88d.css"><link rel="stylesheet" href="/_nuxt/TheHeader.e21518f4.css"><style>.inverted[data-v-a060ef80]{--tw-bg-opacity:1;background-color:rgb(248 250 252/var(--tw-bg-opacity))}.inverted .font-to-invert-to-pink[data-v-a060ef80]{color:rgb(236 72 153/var(--tw-text-opacity))}.inverted .font-to-invert-to-black[data-v-a060ef80],.inverted .font-to-invert-to-pink[data-v-a060ef80]{--tw-text-opacity:1;transition-duration:.15s;transition-property:all;transition-timing-function:cubic-bezier(.4,0,.2,1)}.inverted .font-to-invert-to-black[data-v-a060ef80]{color:rgb(51 65 85/var(--tw-text-opacity))}.inverted .font-to-invert-to-black[data-v-a060ef80]:hover{--tw-text-opacity:1;color:rgb(255 255 255/var(--tw-text-opacity))}.link[data-v-a060ef80]{display:block;font-size:1rem;font-weight:500;line-height:1.5rem;overflow:hidden;padding-left:.75rem;padding-right:.75rem;position:relative;text-decoration:none}.link.NuxtLink-exact-active[data-v-a060ef80]:after{bottom:-2px;height:100%;left:0;width:100%}.link[data-v-a060ef80]:after{background:rgba(236,64,122,.25);bottom:-6px;content:"";height:calc(100% - 8px);left:18px;position:absolute;transition:.35s cubic-bezier(.25,.1,0,2.05);width:calc(100% - 8px);z-index:-1}.link[data-v-a060ef80]:hover:after{bottom:-2px;height:100%;left:0;width:100%}</style><style>.nuxt-content h2{font-size:28px;font-weight:700}.nuxt-content h3{font-size:22px;font-weight:700}.nuxt-content p{margin-bottom:20px}</style></head>
<body ><div id="__nuxt"><!--[--><section class="w-full pb-12 antialiased"><div class="mx-auto max-w-8xl"><div data-v-a060ef80><nav id="header-menu" class="transition-colors fixed w-full z-10 top-0 inverted" data-v-a060ef80><div class="max-w-7xl mx-auto px-2 sm:px-6 lg:px-8" data-v-a060ef80><div class="relative flex items-center justify-between h-16" data-v-a060ef80><div class="absolute inset-y-0 left-0 flex items-center sm:hidden" data-v-a060ef80><button type="button" class="inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-white hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-white" aria-controls="mobile-menu" aria-expanded="false" data-v-a060ef80><span class="sr-only" data-v-a060ef80>Open main menu</span><svg class="block h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" data-v-a060ef80><path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" data-v-a060ef80></path></svg><svg class="hidden h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" data-v-a060ef80><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" data-v-a060ef80></path></svg></button></div><div class="flex-1 flex items-center justify-center sm:items-stretch sm:justify-start" data-v-a060ef80><div class="flex-shrink-0 flex items-center" data-v-a060ef80><span class="text-white text-base font-medium font-bruno text-2xl font-to-invert-to-pink" data-v-a060ef80><a href="/" class="" data-v-a060ef80>EventuallyCoding.com</a></span></div><div class="hidden sm:block sm:ml-6 absolute right-0 font-mark" data-v-a060ef80><div class="flex space-x-4" data-v-a060ef80><!--[--><a href="/speaking" class="link text-white font-to-invert-to-black" data-v-a060ef80>Speaking</a><a href="/blog" class="link text-white font-to-invert-to-black" data-v-a060ef80>Writing</a><a href="/resources" class="link text-white font-to-invert-to-black" data-v-a060ef80>Resources</a><a href="/about" class="link text-white font-to-invert-to-black" data-v-a060ef80>About</a><!--]--></div></div></div></div></div><div class="hidden" data-v-a060ef80><div class="px-2 pt-2 pb-3 space-y-1" data-v-a060ef80><!--[--><a href="/speaking" class="text-white hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium font-to-invert-to-black" data-v-a060ef80>Speaking</a><a href="/blog" class="text-white hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium font-to-invert-to-black" data-v-a060ef80>Writing</a><a href="/resources" class="text-white hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium font-to-invert-to-black" data-v-a060ef80>Resources</a><a href="/about" class="text-white hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium font-to-invert-to-black" data-v-a060ef80>About</a><!--]--></div></div></nav></div><!--[--><!--[--><div><div class="flex justify-center mt-24"><img src="/images/covers/cover2.jpg" alt="Micro-services : la composition de page avec Zuul et Sitemesh" class="object-cover w-96"></div><div class="px-4 mx-auto sm:px-6 xl:max-w-7xl xl:px-0 mt-10"><div><h1 class="text-4xl text-gray-700 font-extrabold text-center mb-3">Micro-services : la composition de page avec Zuul et Sitemesh</h1><p class="text-slate-400 text-center mb-1"><!----></p><div class="grid grid-cols-3 text-center sm:w-full md:w-1/2 mx-auto"><div><p class="text-center font-bold my-4 text-slate-400 text-xs"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline-block" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg> April 13, 2015</p></div><div><p class="text-center font-bold my-4 text-slate-400 text-xs"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline-block" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> 9 min read</p></div><div class="flex items-center font-medium sm:mx-3 justify-center"><img src="/hugo-nb.jpg" loading="lazy" alt="" class="mr-3 w-10 h-10 rounded-full bg-slate-50 dark:bg-slate-800"><div><div class="font-bold text-slate-400 text-xs">Hugo Lassiège</div><a target="_blank" href="https://twitter.com/hugolassiege" class="font-bold text-sky-400 text-xs hover:text-sky-600"> @hugolassiege</a></div></div></div></div><div class="text-left mx-auto"><div class="flex flex-wrap lg:flex-row-reverse py-12"><div class="w-full lg:w-1/4 px-5"><div class="lg:sticky top-0 pt-5 -mt-5 font-proxima"><div class="toc hidden lg:block"><p class="border-b-4 pb-3 mb-3 border-gray-200 text-xl"> On this page </p><ul class="pl-0"><!--[--><li class="py-1"><a class="hover:text-smalt-blue-700" href="#dupliquer-vos-éléments-communs-dans-chaque-application">Dupliquer vos éléments communs dans chaque application.</a></li><li class="py-1"><a class="hover:text-smalt-blue-700" href="#reconstruire-le-code-du-footer-et-du-menu-dynamiquement-via-des-méta-données-dans-une-base-de-données">Reconstruire le code du footer et du menu dynamiquement via des méta données dans une base de données</a></li><li class="py-1"><a class="hover:text-smalt-blue-700" href="#partager-une-jsp-commune-dans-un-jar-pour-pouvoir-linclure-dans-chaque-application-web">Partager une jsp commune dans un jar pour pouvoir l&#39;inclure dans chaque application web</a></li><li class="py-1"><a class="hover:text-smalt-blue-700" href="#utilisons-sitemesh-alors">Utilisons sitemesh alors</a></li><li class="py-1"><a class="hover:text-smalt-blue-700" href="#autre-pistes-non-explorées-encore-les-filtres-zuul">Autre pistes non explorées encore : les filtres Zuul</a></li><li class="py-1"><a class="hover:text-smalt-blue-700" href="#et-un-widget-js">Et un widget js ?</a></li><li class="py-1"><a class="hover:text-smalt-blue-700" href="#et-les-webcomponents">Et les webcomponents ?</a></li><li class="py-1"><a class="hover:text-smalt-blue-700" href="#tableau-récapitulatif">Tableau récapitulatif</a></li><!--]--></ul></div><div class="text-right mb-12"><div class="relative inline-block text-left ml-2 block lg:hidden"><div><span class="rounded-md shadow-sm"><button type="button" class="inline-flex justify-center w-full rounded-md border border-gray-300 px-4 py-2 bg-white text-sm leading-5 font-medium text-black hover:text-white hover:bg-smalt-blue-500 focus:outline-none transition ease-in-out duration-150" aria-haspopup="true" aria-expanded="true"><!--[-->On this page<!--]--><svg class="-mr-1 ml-2 h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></span></div><!----></div></div></div></div><div class="lg:w-3/4 w-full px-5 max-w-none centered-image"><div id="nuxtContent" class="prose font-proxima text-sm md:text-xl font-medium min-w-full md:p-10 mx-auto"><p><!--[--><a href="http://eventuallycoding.com/wp-content/uploads/2015/04/07933-03bc.gif" rel="nofollow"><!--[--><img src="/images/07933-03bc.gif" alt="03BC"><!--]--></a> Le dernier billet de ce blog entamait une mini-série sur les microservices et j&#39;espère bien susciter des commentaires afin d&#39;améliorer le travail réalisé jusqu&#39;ici. Voici une liste non exhaustive des différents sujets que j&#39;aimerais traiter :<!--]--></p><ul><!--[--><li><!--[-->comment gérer une fédération d’identité (one login to rule them all)<!--]--></li><li><!--[-->gérer une configuration distribuée<!--]--></li><li><!--[--><a href="http://www.eventuallycoding.com/index.php/zuul/" rel="nofollow" title="Micro-services : routing avec Zuul"><!--[-->le routage<!--]--></a><!--]--></li><li><!--[-->le load balancing<!--]--></li><li><!--[-->dispatcher des évènements sur plusieurs services<!--]--></li><li><!--[-->les jobs<!--]--></li><li><!--[-->la découverte de services<!--]--></li><li><!--[-->simplifier l’écriture des appels de services<!--]--></li><li><!--[-->la composition de page<!--]--></li><li><!--[-->la résistance aux pannes<!--]--></li><li><!--[-->le monitoring<!--]--></li><li><!--[-->le déploiement<!--]--></li><!--]--></ul><p><!--[-->Le <a href="http://www.eventuallycoding.com/index.php/zuul/" rel="nofollow" title="Micro-services : routing avec Zuul"><!--[-->dernier billet<!--]--></a> s&#39;attardait sur le routage. Dans ce billet j&#39;aimerais aborder une problématique récurrente : la composition de pages<!--]--></p><p><!--[-->TLDR; le code avec l&#39;utilisation de sitemesh est disponible sur <a href="https://github.com/hlassiege/microservice-sandbox/tree/master/compose" rel="nofollow"><!--[-->github<!--]--></a><!--]--></p><p><!--[-->Tout d&#39;abord, resituons le problème. Imaginons une application, au hasard Hopwork, que nous avons décomposé en microservices comme suit :<!--]--></p><ul><!--[--><li><!--[-->le moteur de recherche<!--]--></li><li><!--[-->le back office freelance/clients<!--]--></li><li><!--[-->les pages &quot;statiques&quot; (accueil, comment ca marche etc...)<!--]--></li><!--]--></ul><p><!--[--><a href="http://eventuallycoding.com/wp-content/uploads/2015/04/df8a2-services.jpg" rel="nofollow"><!--[--><img src="/images/df8a2-services.jpg" alt="services"><!--]--></a><!--]--></p><p><!--[-->Vous remarquerez sur les captures d&#39;écran qu&#39;il y a tout de même un élément commun : le menu Et si nous allions en bas de la page, nous aurions également le footer. Chaque page est donc composée comme suit :<!--]--></p><p><!--[--><a href="http://eventuallycoding.com/wp-content/uploads/2015/04/c7c59-composition.png" rel="nofollow"><!--[--><img src="/images/c7c59-composition.png" alt="composition"><!--]--></a><!--]--></p><p><!--[-->Le footer ne bouge pas. Par contre le menu est dynamique. Il affiche votre nom quand vous êtes loggés ainsi que des items de menus différents par exemple.<!--]--></p><p><!--[-->Traditionnellement sur une application monolithique vous utiliseriez des inclusions de jsp, des custom tags, <a href="https://tiles.apache.org/" rel="nofollow"><!--[-->tiles<!--]--></a>, <a href="http://www.thymeleaf.org/" rel="nofollow"><!--[-->thymeleaf<!--]--></a> etc...<!--]--></p><p><!--[-->Et pour une application décomposé en plusieurs services ? Quelles seraient les solutions à envisager ?<!--]--></p><h2 id="dupliquer-vos-éléments-communs-dans-chaque-application"><a href="#dupliquer-vos-éléments-communs-dans-chaque-application"><!--[-->Dupliquer vos éléments communs dans chaque application.<!--]--></a></h2><p><!--[-->Sans doute la pire solution mais il ne faut rien écarter. Ici il s&#39;agit simplement d&#39;avoir votre menu et votre footer dupliqué dans chaque micro services.<!--]--></p><p><!--[--><a href="http://eventuallycoding.com/wp-content/uploads/2015/04/3f257-duplication.jpg" rel="nofollow"><!--[--><img src="/images/3f257-duplication.jpg" alt="duplication"><!--]--></a><!--]--></p><p><!--[-->Bon, vous imaginez sans mal les inconvénients :<!--]--></p><ul><!--[--><li><!--[-->effort de maintenance démultipliée<!--]--></li><li><!--[-->aucun mécanisme pour qu&#39;une application ait le même menu que les autres, vous pourriez avoir des liens dans le footer différent par exemple<!--]--></li><!--]--></ul><p><!--[-->Par contre à sa décharge, cette méthode a quand même des avantages :<!--]--></p><ul><!--[--><li><!--[-->vous pouvez utiliser des technologies de templating différentes dans chaque application (jinja en python, jsp en java etc...)<!--]--></li><li><!--[-->vous pouvez utiliser des versions différentes de css pour un rendu équivalent<!--]--></li><li><!--[-->vos applications sont vraiment autonomes et peuvent être utilisées toute seules<!--]--></li><!--]--></ul><p><!--[-->Ce dernier point est très important. Mais l&#39;effort de maintenance reste beaucoup trop important pour envisager sérieusement cette solution.<!--]--></p><h2 id="reconstruire-le-code-du-footer-et-du-menu-dynamiquement-via-des-méta-données-dans-une-base-de-données"><a href="#reconstruire-le-code-du-footer-et-du-menu-dynamiquement-via-des-méta-données-dans-une-base-de-données"><!--[-->Reconstruire le code du footer et du menu dynamiquement via des méta données dans une base de données<!--]--></a></h2><p><!--[-->C&#39;est une petite amélioration du cas précédent. Le code css/js/html reste dupliqué, permettant à chaque microservices d&#39;évoluer indépendamment. Mais le contenu du menu et du footer est dynamique. Ce qui reste une petite amélioration intéressante.<!--]--></p><p><!--[--><a href="http://eventuallycoding.com/wp-content/uploads/2015/04/43bd1-duplication-with-db1.jpg" rel="nofollow"><!--[--><img src="/images/43bd1-duplication-with-db1.jpg" alt="duplication-with-db"><!--]--></a><!--]--></p><p><!--[-->L&#39;effort de maintenance reste très important.<!--]--></p><p><!--[-->Une variante de cette solution serait d&#39;avoir le code html complet du header/footer en base de données.<!--]--></p><p><!--[-->Cette fois on élimine l&#39;effort de maintenance. Le versionning peut se faire facilement.<!--]--></p><p><!--[-->Le défaut majeur repose sur le fait que votre menu peut avoir des composantes dynamiques et afficher certains items :<!--]--></p><ul><!--[--><li><!--[-->si l&#39;utilisateur est loggé ou non<!--]--></li><li><!--[-->si certaines fonctionnalités sont affichées pour lui (feature flipping)<!--]--></li><li><!--[-->si certaines fonctionnalités lui sont accessibles (hopwork analytiques ou widgets non disponible pour les clients par exemple)<!--]--></li><!--]--></ul><p><!--[-->Voyons autre chose.<!--]--></p><h2 id="partager-une-jsp-commune-dans-un-jar-pour-pouvoir-linclure-dans-chaque-application-web"><a href="#partager-une-jsp-commune-dans-un-jar-pour-pouvoir-linclure-dans-chaque-application-web"><!--[-->Partager une jsp commune dans un jar pour pouvoir l&#39;inclure dans chaque application web<!--]--></a></h2><p><!--[-->Ca parait simple comme idée, il suffit ensuite d&#39;utiliser cette jsp ensuite avec une directive d&#39;inclusion :<!--]--></p><p><!--[-->&lt;%@ include file=&quot;include/menu.jsp&quot;/&gt;<!--]--></p><p><!--[--><a href="http://eventuallycoding.com/wp-content/uploads/2015/04/65476-webresources.jpg" rel="nofollow"><!--[--><img src="/images/65476-webresources.jpg" alt="webresources"><!--]--></a><!--]--></p><p><!--[-->Plusieurs défauts à celà :<!--]--></p><ul><!--[--><li><!--[-->ce n&#39;est pas si simple de partager une jsp dans un jar. D&#39;ailleurs je n&#39;ai pas réussi. La seule solution technique que j&#39;ai trouvé a été d&#39;utiliser une dépendance sous forme de war avec le plugin maven war qui fait ensuite une fusion des deux wars<!--]--></li><li><!--[-->cela implique que toutes vos applications web partagent la même technologie. Si a un moment vous choisisissez d&#39;utiliser Thymeleaf ou velocity dans un autre service, votre jsp devient inutile.<!--]--></li><li><!--[-->Pire, même pour du contenu statique, vous êtes obligé d&#39;en faire une jsp. Dommage.<!--]--></li><li><!--[-->cela impose de relivrer pour avoir la dernière version du menu ou du footer<!--]--></li><!--]--></ul><p><!--[-->Quelques avantages :<!--]--></p><ul><!--[--><li><!--[-->vos applications sont vraiment autonomes et peuvent être utilisées toute seules<!--]--></li><li><!--[-->vous dépendez d&#39;une version stable et pouvez évoluer quand vous le souhaitez (pensez aux gros refactoring js et css qui pourrait impacter chaque application)<!--]--></li><!--]--></ul><p><!--[-->Evidemment on peut partir du principe que ces éléments bougent peu donc le jeu ne vaut pas la chandelle d&#39;aller plus loin et on peut accepter des désynchro de temps en temps. Pour être honnête, c&#39;était ma première pensée de prime abord.<!--]--></p><p><!--[-->Et puis je suis tombé sur un vieux billet de Matt Raible de 2005 : <a href="http://raibledesigns.com/rd/entry/use_sitemesh_to_decorate_multiple" rel="nofollow"><!--[-->Use SiteMesh to decorate multiple webapps<!--]--></a><!--]--></p><h2 id="utilisons-sitemesh-alors"><a href="#utilisons-sitemesh-alors"><!--[-->Utilisons sitemesh alors<!--]--></a></h2><p><!--[-->Je ne connaissais pas bien <a href="http://wiki.sitemesh.org/wiki/" rel="nofollow"><!--[-->sitemesh<!--]--></a>. Je l&#39;avais croisé sur un projet pour un voyagiste d&#39;affaire il y a quelques années mais a l&#39;époque, tout le monde se demandait surtout ce que ca foutait dans le projet :) Les joies du legacy. Mais ce billet très court de M. Raible m&#39;a convaincu de tester.<!--]--></p><p><!--[-->Sitemesh en soi est finalement très simple à comprendre. Il agit en tant que filtre de servlet pour décorer votre page. C&#39;est très différent d&#39;un <a href="https://tiles.apache.org/" rel="nofollow"><!--[-->tiles<!--]--></a> dans le sens ou votre page d&#39;origine est complète. Nous sommes ici dans le cas d&#39;un parfait exemple du <a href="http://fr.wikipedia.org/wiki/D%C3%A9corateur_%28patron_de_conception%29" rel="nofollow"><!--[-->pattern decorator<!--]--></a>.<!--]--></p><p><!--[-->Vous pourriez par exemple avoir le code suivant :<!--]--></p><p><!--[-->A title<!--]--></p><p><!--[-->hello world<!--]--></p><p><!--[-->Cette décoration se fait à l&#39;aide d&#39;un fichier decorators.html qui décrit la décoration à réaliser. Par exemple :<!--]--></p><p><!--[-->Site name : A title<!--]--></p><p><!--[-->added by sitemesh<!--]--></p><p><!--[-->hello world<!--]--></p><p><!--[-->added by sitemesh<!--]--></p><p><!--[-->Chose intéressante, le billet de M. Raible semblait suggérer que ce décorateur pouvait se trouver dans une autre application web.<!--]--></p><p><!--[-->Bon, ce ne fut pas si simple au final. En effet sitemesh est un projet peu actif (5 commits en un an). La version 3 a apporté son lot de simplification, mais elle a aussi dégagé le support des décorateurs cross webapp (dans une autre application web).<!--]--></p><p><!--[-->Cependant ca s&#39;est quand même avéré très simple à mettre en place.<!--]--></p><p><!--[-->Il a suffit de rajouter un filtre sitemesh :<!--]--></p><p><!--[-->@Configuration
@ConditionalOnProperty(&quot;sitemesh.filter.enabled&quot;)
public class SitemeshConfig {
@Bean
public FilterRegistrationBean siteMeshFilter() {
FilterRegistrationBean filterRegistrationBean = new FilterRegistrationBean();
filterRegistrationBean.setFilter(new MySiteMeshFilter());
return filterRegistrationBean;
}
}<!--]--></p><p><!--[-->Au passage vous remarquerez l&#39;utilisation des beans conditionnels facilité avec spring-boot. Ce filtre est actif ou non en fonction d&#39;une configuration &quot;sitemesh.filter.enabled&quot;<!--]--></p><p><!--[-->Et le filtre sitemesh en lui-même :<!--]--></p><p><!--[-->public class MySiteMeshFilter extends ConfigurableSiteMeshFilter {
@Override
protected void applyCustomConfiguration(SiteMeshFilterBuilder builder) {
builder.addDecoratorPath(&quot;/*&quot;, &quot;/decorators/decorator&quot;);
}
}<!--]--></p><p><!--[-->Ok, mais ce n&#39;est pas cross webapp ça.<!--]--></p><p><!--[-->Effectivement, mais l&#39;astuce très simple consiste à créer un controleur qui va servir le contenu d&#39;une autre page distante<!--]--></p><p><!--[-->@Controller
public class SitemeshController {
private final OkHttpClient client = new OkHttpClient();
@Value(&quot;${sitemesh.decorator.url}&quot;)
private String decoratorUrl;
@RequestMapping(value = &quot;/decorators/decorator&quot;, method = RequestMethod.GET)
@ResponseBody
public Object decorator() throws IOException {
Request request = new Request.Builder()
.url(decoratorUrl)
.build();
Response response = client.newCall(request).execute();
return response.body().string();
}
}<!--]--></p><p><!--[-->J&#39;ai utilisé ici <a href="http://square.github.io/okhttp/" rel="nofollow"><!--[-->okHttp<!--]--></a> pour la récupération du contenu distant.<!--]--></p><p><!--[-->A partir de là, vous êtes capable de décorer votre page à partir d&#39;un décorateur commun à tous vos services.<!--]--></p><p><!--[--><a href="http://eventuallycoding.com/wp-content/uploads/2015/04/3d5ad-sitemesh.jpg" rel="nofollow"><!--[--><img src="/images/3d5ad-sitemesh.jpg" alt="sitemesh"><!--]--></a><!--]--></p><p><!--[-->Mais que vient faire Zuul dans tout cela ?<!--]--></p><p><!--[-->Si vous avez lu le premier billet de cette série, nous utilisons Zuul pour présenter une seule url au client et pour lui inviter de naviguer sans arrêt entre différents sous domaines correspondant à mes applications.<!--]--></p><p><!--[-->Et dans notre cas cela nous permet de partager aussi des ressources en commun :<!--]--></p><p><!--[--><a href="http://eventuallycoding.com/wp-content/uploads/2015/04/ad5b9-zuul-sitemesh.jpg" rel="nofollow"><!--[--><img src="/images/ad5b9-zuul-sitemesh.jpg" alt="zuul-sitemesh"><!--]--></a><!--]--></p><p><!--[-->Au final cette solution est très intéressante :<!--]--></p><ul><!--[--><li><!--[-->aucune duplication de code<!--]--></li><li><!--[-->les pages dans vos applications sont complètes et peuvent donc être utilisées de facon autonome<!--]--></li><li><!--[-->vous pouvez utiliser des technologies de templating différentes dans chaque application (jinja en python, jsp en java etc...)<!--]--></li><!--]--></ul><p><!--[-->mais elle comporte quand même des inconvénients :<!--]--></p><ul><!--[--><li><!--[-->si vous souhaitez le rendu final, vous devez avoir au moins le proxy Zuul lancé en même temps pour travailler.<!--]--></li><li><!--[-->si vous partagez des css/js sur le proxy Zuul, il y a des risques de casser votre microservice le jour ou le proxy Zuul fait évoluer ces ressources sans prévenir. Il faut sans doute penser à les versionner<!--]--></li><li><!--[-->la petite astuce avec le controleur intermédiaire n&#39;est pas des plus optimales en terme de chemin.<!--]--></li><!--]--></ul><h2 id="autre-pistes-non-explorées-encore-les-filtres-zuul"><a href="#autre-pistes-non-explorées-encore-les-filtres-zuul"><!--[-->Autre pistes non explorées encore : les filtres Zuul<!--]--></a></h2><p><!--[-->Selon moi, spring-cloud qui se veut la réponse absolue pour construire des microservices en Java aurait vocation à répondre à ce point. Et je pense que cela pourrait passer par l&#39;utilisation de filtres Zuul en post filtering. Par contre ceux-ci sont assez mal documentées et je n&#39;ai pas encore bien compris comment en rajouter. On en entend parler sur <a href="https://github.com/Netflix/zuul/wiki/Writing-Filters" rel="nofollow"><!--[-->la doc officielle de Netflix<!--]--></a>, mais rien ne permet de comprendre comment les associer à Zuul dans le cas de Spring-cloud.<!--]--></p><p><!--[-->Par rapport à la solution précédente, on déporterait la responsabilité de la décoration au proxy. Cela éviterait la petite astuce avec le controleur supplémentaire vu ci-dessus. Par contre on reste obligé d&#39;avoir le proxy Zuul lancé pour travailler. Mais de toute facon ca semble assez inéluctable vu les responsabilités qu&#39;on lui donne de plus en plus.<!--]--></p><h2 id="et-un-widget-js"><a href="#et-un-widget-js"><!--[-->Et un widget js ?<!--]--></a></h2><p><!--[-->Piste intéressante, ca se versionne sans souci, ca permet de laisser chaque application vivre sa vie indépendamment. Ca oblige toujours à garder le proxy Zuul qui héberge la resource allumé cependant. Par contre je ne suis vraiment pas fan d&#39;avoir un composant qui js qui induit une petite pause au chargement et un affichage qui se fait en deux temps.<!--]--></p><h2 id="et-les-webcomponents"><a href="#et-les-webcomponents"><!--[-->Et les webcomponents ?<!--]--></a></h2><p><!--[-->Aucune idée pour être honnête, je ne connais pas assez pour savoir si c&#39;est très différent d&#39;une widget (en mieux). Mais si le défaut de l&#39;affichage est le même, pas plus d&#39;intérêt selon moi.<!--]--></p><h2 id="tableau-récapitulatif"><a href="#tableau-récapitulatif"><!--[-->Tableau récapitulatif<!--]--></a></h2><table><!--[--><thead><!--[--><tr><!--[--><th><!--[-->Solution<!--]--></th><th><!--[-->Utilisation de contenu dynamique<!--]--></th><th><!--[-->Pas de duplication de code<!--]--></th><th><!--[-->Insensible au refactoring<!--]--></th><th><!--[-->Pas de relivraison pour mise à jour<!--]--></th><th><!--[-->Peut utiliser des technos différentes<!--]--></th><th><!--[-->Microservices autonomes<!--]--></th><th><!--[-->Confort utilisateur<!--]--></th><!--]--></tr><!--]--></thead><tbody><!--[--><tr><!--[--><td><!--[-->widgets/webcomponent<!--]--></td><td><!--[-->non (1)<!--]--></td><td><!--[-->non<!--]--></td><td><!--[-->non<!--]--></td><td><!--[-->non<!--]--></td><td><!--[-->oui<!--]--></td><td><!--[-->non<!--]--></td><td><!--[-->non<!--]--></td><!--]--></tr><tr><!--[--><td><!--[-->zuul filter<!--]--></td><td><!--[-->oui<!--]--></td><td><!--[-->oui<!--]--></td><td><!--[-->non<!--]--></td><td><!--[-->oui<!--]--></td><td><!--[-->oui<!--]--></td><td><!--[-->non<!--]--></td><td><!--[-->oui<!--]--></td><!--]--></tr><tr><!--[--><td><!--[-->sitemesh<!--]--></td><td><!--[-->oui<!--]--></td><td><!--[-->oui<!--]--></td><td><!--[-->non<!--]--></td><td><!--[-->oui<!--]--></td><td><!--[-->oui<!--]--></td><td><!--[-->non<!--]--></td><td><!--[-->oui<!--]--></td><!--]--></tr><tr><!--[--><td><!--[-->Construction via base de données<!--]--></td><td><!--[-->non (1)<!--]--></td><td><!--[-->oui<!--]--></td><td><!--[-->non<!--]--></td><td><!--[-->partiel<!--]--></td><td><!--[-->oui<!--]--></td><td><!--[-->oui<!--]--></td><td><!--[-->oui<!--]--></td><!--]--></tr><tr><!--[--><td><!--[-->Duplication html/js/jsp<!--]--></td><td><!--[-->oui<!--]--></td><td><!--[-->oui<!--]--></td><td><!--[-->oui<!--]--></td><td><!--[-->non<!--]--></td><td><!--[-->non<!--]--></td><td><!--[-->oui<!--]--></td><td><!--[-->oui<!--]--></td><!--]--></tr><tr><!--[--><td><!--[-->Partage de jsp<!--]--></td><td><!--[-->oui<!--]--></td><td><!--[-->oui<!--]--></td><td><!--[-->oui<!--]--></td><td><!--[-->non<!--]--></td><td><!--[-->non<!--]--></td><td><!--[-->oui<!--]--></td><td><!--[-->oui<!--]--></td><!--]--></tr><!--]--></tbody><!--]--></table><p><!--[-->(1) on pourrait imager un menu statique qui présenterait un aspect &quot;basique&quot; et qui serait ensuite modifié en js si l&#39;utilisateur est connecté et si certains items devait être rajouté au menu. Cela laisserait cependant un désagréable effet de clignotement pour l&#39;utilisateur final<!--]--></p><p><!--[-->Si cela vous intéresse, voici le code sous github : <a href="https://github.com/hlassiege/microservice-sandbox/tree/master/compose" rel="nofollow"><!--[-->microservices-sandbox<!--]--></a><!--]--></p></div></div></div></div><div class="mt-10 text-slate-600 font-extrabold text-sm font-medium min-w-full mx-auto mb-2"><a href="https://github.com/hlassiege/eventuallycoding/blob/master/content/articles/2015/04/13/micro-services-la-composition-de-page-avec-zuul-et-sitemesh.md" rel="noopener noreferrer" target="_blank">Edit on Github <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 inline-block text-slate-600 -mt-1" viewBox="0 0 512 512"><path d="M320 0c-17.7 0-32 14.3-32 32s14.3 32 32 32h82.7L201.4 265.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L448 109.3V192c0 17.7 14.3 32 32 32s32-14.3 32-32V32c0-17.7-14.3-32-32-32H320zM80 32C35.8 32 0 67.8 0 112V432c0 44.2 35.8 80 80 80H400c44.2 0 80-35.8 80-80V320c0-17.7-14.3-32-32-32s-32 14.3-32 32V432c0 8.8-7.2 16-16 16H80c-8.8 0-16-7.2-16-16V112c0-8.8 7.2-16 16-16H192c17.7 0 32-14.3 32-32s-14.3-32-32-32H80z"></path></svg></a></div><hr class="mb-8"><div><span class="font-proxima text-sm md:text-xl font-medium"> Did you like this blog post? </span><div class="mt-4 flex flex-row"><div><a href="https://facebook.com/sharer/sharer.php?u=https://eventuallycoding.com/2015/04/13/micro-services-la-composition-de-page-avec-zuul-et-sitemesh" target="_blank" rel="noopener" aria-label="Share on Facebook"><button aria-label="Share on Facebook" type="button" class="text-white bg-[#3b5998] hover:bg-[#3b5998]/90 focus:ring-4 focus:outline-none focus:ring-[#3b5998]/50 font-medium rounded-lg text-sm px-3 py-3 text-center inline-flex items-center dark:focus:ring-[#3b5998]/55 mr-2 mb-2"><svg class="w-6 h-6" aria-hidden="true" focusable="false" data-prefix="fab" data-icon="facebook-f" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M279.1 288l14.22-92.66h-88.91v-60.13c0-25.35 12.42-50.06 52.24-50.06h40.42V6.26S260.4 0 225.4 0c-73.22 0-121.1 44.38-121.1 124.7v70.62H22.89V288h81.39v224h100.2V288z"></path></svg></button></a></div><div><a href="https://twitter.com/share?url=https://eventuallycoding.com/2015/04/13/micro-services-la-composition-de-page-avec-zuul-et-sitemesh&amp;text=Micro-services : la composition de page avec Zuul et Sitemesh&amp;via=hugolassiege" target="_blank" title="Share on Twitter" rel="noopener noreferrer" aria-label="Share on Twitter"><button aria-label="Share on Twitter" type="button" class="text-white bg-[#1da1f2] hover:bg-[#1da1f2]/90 focus:ring-4 focus:outline-none focus:ring-[#1da1f2]/50 font-medium rounded-lg text-sm px-3 py-3 text-center inline-flex items-center dark:focus:ring-[#1da1f2]/55 mr-2 mb-2"><svg class="w-6 h-6" aria-hidden="true" focusable="false" data-prefix="fab" data-icon="twitter" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M459.4 151.7c.325 4.548 .325 9.097 .325 13.65 0 138.7-105.6 298.6-298.6 298.6-59.45 0-114.7-17.22-161.1-47.11 8.447 .974 16.57 1.299 25.34 1.299 49.06 0 94.21-16.57 130.3-44.83-46.13-.975-84.79-31.19-98.11-72.77 6.498 .974 12.99 1.624 19.82 1.624 9.421 0 18.84-1.3 27.61-3.573-48.08-9.747-84.14-51.98-84.14-102.1v-1.299c13.97 7.797 30.21 12.67 47.43 13.32-28.26-18.84-46.78-51.01-46.78-87.39 0-19.49 5.197-37.36 14.29-52.95 51.65 63.67 129.3 105.3 216.4 109.8-1.624-7.797-2.599-15.92-2.599-24.04 0-57.83 46.78-104.9 104.9-104.9 30.21 0 57.5 12.67 76.67 33.14 23.72-4.548 46.46-13.32 66.6-25.34-7.798 24.37-24.37 44.83-46.13 57.83 21.12-2.273 41.58-8.122 60.43-16.24-14.29 20.79-32.16 39.31-52.63 54.25z"></path></svg></button></a></div><div class=""><a href="https://www.buymeacoffee.com/hlassiege" target="_blank"><img src="https://cdn.buymeacoffee.com/buttons/v2/default-red.png" alt="Buy Me A Coffee" style="height:48px !important;width:209px !important;"></a></div></div></div><div id="hyvor-talk-view"></div></div></div><!--]--><!--]--><footer class="lg:mt-40 border-t border-t-2"><div class="flex flex-col items-center mt-16"><div class="flex mb-3 space-x-4"><a aria-label="Open RSS feed" target="_self" href="/rss.xml" class="text-sm text-gray-500 transition hover:text-gray-600"><img alt="RSS" class="transition-transform hover:scale-110 w-8 h-8" src="/_nuxt/rss.9e0b880c.svg"></a><a aria-label="Open Mastodon profile" class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="me" href="https://piaille.fr/@hugolassiege"><span class="sr-only">Mastodon</span><img alt="Mastodon" class="transition-transform hover:scale-110 w-8 h-8" src="/_nuxt/mastodon.f0ecdde8.svg"></a><a aria-label="Open github profile" class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="nofollow noopener noreferrer" href="https://github.com/hlassiege"><span class="sr-only">github</span><img alt="github" class="transition-transform hover:scale-110 w-8 h-8" src="/_nuxt/github_new.4e3fe23c.svg"></a><a aria-label="Open linkedin profile" class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://www.linkedin.com/in/hugolassiege/"><span class="sr-only">Linkedin</span><img alt="Linkedin" class="transition-transform hover:scale-110 w-8 h-8" src="/_nuxt/linkeding.34c3bc6d.svg"></a><a aria-label="Open twitter profile" target="_blank" rel="nofollow noopener noreferrer" href="https://twitter.com/hugolassiege" class="text-sm text-gray-500 transition hover:text-gray-600"><img alt="Twitter" class="transition-transform hover:scale-110 w-8 h-8" src="/_nuxt/twitter.457cff27.svg"></a></div><div class="flex mb-2 space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>Copyright © 2023</div><div>•</div> EventuallyCoding - A la fin de l&#39;envoi, je code !</div><div class="text-sm text-gray-500"> Credits to www.freepik.com - <a href="https://www.freepik.com/vectors/citizen">Citizen vector created by freepik - </a><a href="https://www.freepik.com/vectors/css">Css vector created by vectorjuice</a></div></div></footer></div></section><!--]--></div><script type="module">import p from "/2015/04/13/micro-services-la-composition-de-page-avec-zuul-et-sitemesh/_payload.js";window.__NUXT__={...p,...((function(a,b){return {state:{},_errors:{},serverRendered:true,config:{public:{content:{locales:[],defaultLocale:b,integrity:1698390327037,experimental:{stripQueryParameters:a,clientDB:a},api:{baseURL:"\u002Fapi\u002F_content"},navigation:{fields:[]},tags:{p:"prose-p",a:"prose-a",blockquote:"prose-blockquote","code-inline":"prose-code-inline",code:"prose-code",em:"prose-em",h1:"prose-h1",h2:"prose-h2",h3:"prose-h3",h4:"prose-h4",h5:"prose-h5",h6:"prose-h6",hr:"prose-hr",img:"prose-img",ul:"prose-ul",ol:"prose-ol",li:"prose-li",strong:"prose-strong",table:"prose-table",thead:"prose-thead",tbody:"prose-tbody",td:"prose-td",th:"prose-th",tr:"prose-tr"},highlight:a,wsUrl:b,documentDriven:a,host:b,trailingSlash:a,anchorLinks:{depth:4,exclude:[1]}}},app:{baseURL:"\u002F",buildAssetsDir:"\u002F_nuxt\u002F",cdnURL:b}},prerenderedAt:1698390363674}}(false,"")))}</script><script type="module" src="/_nuxt/entry.4e8e9ab9.js" crossorigin></script><script type="module" src="/_nuxt/default.743f7445.js" crossorigin></script><script type="module" src="/_nuxt/_id_.4a64e0b1.js" crossorigin></script><script type="module" src="/_nuxt/ContentRenderer.3100fbb0.js" crossorigin></script><script type="module" src="/_nuxt/ContentRendererMarkdown.4cbb432c.js" crossorigin></script><script type="module" src="/_nuxt/ProseP.497c769a.js" crossorigin></script><script type="module" src="/_nuxt/ProseA.ae2ece81.js" crossorigin></script><script type="module" src="/_nuxt/ProseImg.792b26d4.js" crossorigin></script><script type="module" src="/_nuxt/ProseUl.4aa2bcf5.js" crossorigin></script><script type="module" src="/_nuxt/ProseLi.be1ca92a.js" crossorigin></script><script type="module" src="/_nuxt/ProseH2.d151cff5.js" crossorigin></script><script type="module" src="/_nuxt/ProseTable.5798b369.js" crossorigin></script><script type="module" src="/_nuxt/ProseThead.b92c4ff8.js" crossorigin></script><script type="module" src="/_nuxt/ProseTr.d615d78c.js" crossorigin></script><script type="module" src="/_nuxt/ProseTh.2384a209.js" crossorigin></script><script type="module" src="/_nuxt/ProseTbody.15d8a727.js" crossorigin></script><script type="module" src="/_nuxt/ProseTd.e1a62aba.js" crossorigin></script></body>
</html>
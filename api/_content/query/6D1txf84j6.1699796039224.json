{"_path":"/articles/2020/04/19/une-documentation-qui-vit","_dir":"19","_draft":false,"_partial":false,"_locale":"","title":"Une documentation qui vit","description":"Et si on parlait documentation ?   La documentation c'est un peu le sujet maudit et polémique dans les équipes tech. Entre ceux qui en font trop, ceux...","id":"1511","date":"2020-04-19","categories":["waza"],"tags":["antora","doc"],"img":"image-2.png","cover":"cover2.jpg","readingTime":{"text":"8 min read","minutes":7.61,"time":456600,"words":1522},"body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Et si on parlait documentation ?"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nLa documentation c'est un peu le sujet maudit et polémique dans les équipes tech. Entre ceux qui en font trop, ceux qui n'en font pas assez ou pas du tout. Est-ce que même parler de \"faire de la doc\" sur un blog technique c'est pas un peu... un troll ? :)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://eventuallycoding.com/wp-content/uploads/2020/04/image-2.png","rel":["nofollow"]},"children":[{"type":"element","tag":"img","props":{"alt":"Troll face","src":"/images/image-2.png"},"children":[]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"J'ai connu des périodes assez variées d'un point de vue personnel concernant les pratiques documentaires que je vous propose de passer en revue."}]},{"type":"element","tag":"h2","props":{"id":"une-indigestion-de-doc"},"children":[{"type":"text","value":"Une indigestion de doc"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"J'ai commencé dans une ESN/Société de Service/Marchand... C'était il y a maintenant presque 20 ans, la documentation était très carré. Je faisais partie d'une société qui pouvait se vanter d'être certifié avec des labels à n'en plus finir et de bosser elle même pour des clients certifiés également."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Je ne vais pas dire que c'était 100% efficace mais ça avait le mérite d'être très méthodique. On passait de l'expression du besoin, aux spécifications fonctionnelles, puis aux specs techniques, aux cahier de recettes etc… Tout était précis, carré, pénible. Pour chaque nouvelle version du logiciel on livrait également un bordereau de livraison listant l'ensemble des documentations ayant changé. Et chaque doc était relivrée en mode relecture. La doc était un livrable, testé, comme le reste. Chaque doc avait un acronyme particulier. Par exemple STBL, EB etc… et possédait un versionning très précis (que j'ai oublié). On pouvait avoir des anomalies documentaires, pour lesquelles on recherchait les causes racines qui parfois se retrouvait dans l'expression de besoin cliente. Ce qui donnait lieu à des discussions pleines de joie et de bonheur."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Je suis ironique et ça peut sembler lourd (ça l'était). Mais pour être fair-play, avec le recul, ça avait le mérite d'être mature et au moins la documentation était à jour. A un coût démesuré mais elle était à jour."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nForcément cela demande beaucoup d'énergie (et d'argent) qui ampute grandement la rapidité de dev, la capacité à répondre vite à vos utilisateurs avec le bon produit. Mais une doc exhaustive et à jour pour des plateaux de centaines de personnes sur 20 ans, c'est quand même important."}]},{"type":"element","tag":"h2","props":{"id":"ou-pas-de-doc-du-tout"},"children":[{"type":"text","value":"Ou pas de doc du tout ?"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"C'était en 2002. Un an plus tôt des personnes formalisaient ce qu'on appelle le manifeste agile et deux de ces piliers étaient :"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"un logiciel fonctionnel plutôt qu’une documentation complète"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"s'adapter aux changements plutôt que suivre le plan"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"En gros si je caricature, faites moins de plan et de doc, voyez-vous plus souvent avec vos utilisateurs, montrez leur votre avancement et avancez pas à pas avec lui."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Rapidement, c'est devenu pour beaucoup : ne faites pas de doc. Même si ce n'était pas la définition de départ."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nPour ceux ayant connu comme moi la période précédente, c'était peut être aussi une grosse indigestion mal vécu qui conduisait à un gros rejet de tout ce qui ressemble de près ou de loin à un référentiel documentaire."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"L'agilité pronait un retour à l'écoute du client avec plus de co-conception, et aux bonnes pratiques d'ingénierie (XP), les fondamentaux en somme."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Pour beaucoup, le code pouvait remplacer toute documentation. Il est constamment à jour et pour caricaturer, un README et une javadoc suffisait."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nEn sus, il y avait de nombreux professionnels qui insistaient (insistent toujours) sur l'expressivité du code. Cette expressivité doit remplacer des commentaires souvent inutile ou présents pour expliquer une complexité qui n'a pas lieu d'être et qui ont en plus la facheuse tendance à devenir obsolète. Donc la javadoc (ou équivalent dans le language de votre choix) devenait uniquement un index des classes et méthodes, avec l'espoir d'un bon nommage."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Mon opinion personnelle : de trop de doc, on est passé à pas assez de doc."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nOui le code doit être expressif mais il est nécessaire aussi de parler de ce qui n'est pas dans le code : les choix, les non-choix, les compromis, la vision d'ensemble etc…"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nUne règle métier ne peut pas juste se résumer à une méthode bien nommée."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Après je comprends aussi que ce ne soit pas le sujet le plus sexy en apparence. La documentation ne semble pas aussi motivante intellectuellement que de développer un algo, de débugger un problème velu, de faire fonctionner un système."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Maintenant que j'ai fait cette intro, je vous propose de vous décrire ce que nous avons mis en place pour essayer de trouver un juste milieu entre une documentation utile, à jour et éviter une lourdeur à la société ITIL-CMMI-ISO dont la vélocité n'est plus à démontrer…"}]},{"type":"element","tag":"h2","props":{"id":"une-documentation-générée"},"children":[{"type":"text","value":"Une documentation générée"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Nous sommes partis du principe qu'une grande partie de l'information, la plus précise, se devait d'être :"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"toujours à jour"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"la plus proche possible de son utilisation"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Pour cela, il fallait donc la générer à partir du code quand c'était possible ou la placer très proche de celui-ci quand ce n'était pas possible (le fameux README)."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Mais nous voulions aller au délà d'une simple Javadoc."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nNous avons donc codé des utilitaires pour extraire certaines informations du code et en faire de la documentation."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nQuelques exemples :"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"un outil qui extrait du code toute les classes et méthodes annoté par "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"PreAuthorize"}]},{"type":"text","value":" pour lister l'ensemble des rôles (permissions) possible et comment c'est utilisé"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"un outil qui extrait toutes les classes dérivant de \"Event\", la classe générique des événements mis dans RabbitMq, pour lister tous les events possibles avec leurs consommateurs et producteurs"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"des annotations adhoc destiné à mettre en valeur certains bouts de code de référence : "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"@HowTo"}]},{"type":"text","value":" afin de faire une section de FAQ avec tout les HowTo : "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"comment faire un job Quartz, comment faire un tests unitaire avec Junit5 et Mockito"}]},{"type":"text","value":" etc… Le code étant donc toujours à jour dans la documentation puisque utilisé en prod et testé."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"des annotations d'illustration des concepts métiers "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"@CoreConcept, @GuidedTour"}]},{"type":"text","value":" permettant de générer des tours guidés sur des sujets métiers bien spécifiques."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\net j'en passe."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Pour cela nous avons utilisé "},{"type":"element","tag":"a","props":{"href":"https://github.com/paul-hammant/qdox","rel":["nofollow"]},"children":[{"type":"text","value":"qdox"}]},{"type":"text","value":" et quelques outils de parsing maison pour du json, js etc…"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://eventuallycoding.com/wp-content/uploads/2022/05/doc-emails.png","rel":["nofollow"]},"children":[{"type":"element","tag":"img","props":{"alt":"","src":"/images/doc-emails.png"},"children":[]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Nous avons cependant une limitation actuellement : nous avons une base de code Kotlin qui est de plus en plus importante et ce code n'est pas couvert par qdox. Il faut que nous trouvions un remplaçant pour Kotlin. Si vous avez, je suis preneur."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Une fois cela fait, il fallait y rajouter une information plus méta et aggréger le tout au même endroit"}]},{"type":"element","tag":"h2","props":{"id":"portail-de-développement"},"children":[{"type":"text","value":"Portail de développement"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Auparavant nous avions un site statique très simple constituée des fichiers générés plus haut mais ce n'était pas satisfaisant pour ajouter de la doc méta facilement."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nJ'ai donc cherché un outil qui puisse servir à réaliser un portail de documentation développeur avec les contraintes suivantes :"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"peut acceuillir de la doc généré"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"facile d'accès en rédaction avec une syntaxe de type markdown ou asciidoc"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Comme je ne savais pas bien quoi utiliser je suis passé par "},{"type":"element","tag":"a","props":{"href":"https://twitter.com/hugolassiege/status/1228390348499693568","rel":["nofollow"]},"children":[{"type":"text","value":"Twitter"}]},{"type":"text","value":" et j'ai eu de très nombreuses réponses :)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nmkdocs, readme.io, documize, gitbook, wiki.js, docusaurus, asciidoctor, antora, getgrav, bookstack, vuepress"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"J'ai écarte les SAAS car j'avais peur de la difficulté d'y intégrer nos docs générés et il s'agissait d'une solution sur laquelle je n'étais pas encore sûr de l'adoption donc c'était un peu tôt pour investir."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nJ'ai écarté les solutions qui sont surtout des boites à outils pour construire de la doc. Je voulais réussir à avoir un résultat dans la journée pour un portail complet."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"A la fin j'ai donc sélectionné Antora : "},{"type":"element","tag":"a","props":{"href":"https://antora.org/","rel":["nofollow"]},"children":[{"type":"text","value":"https://antora.org/"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Pour résumer les points qui m'ont convaincu :"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"support de "},{"type":"element","tag":"a","props":{"href":"https://asciidoctor.org/","rel":["nofollow"]},"children":[{"type":"text","value":"asciidoctor"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"support de "},{"type":"element","tag":"a","props":{"href":"https://plantuml.com/fr/","rel":["nofollow"]},"children":[{"type":"text","value":"plantuml"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"aggrégation possible de module de doc entre plusieurs repos"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"un layout de base suffisant (table des matières, menu etc…), rien à construire quasiment"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"En terme de construction de la doc, nous lancons un build sur la CI :"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"lancement des utilitaires pour construire la doc généré et la placer dans l'arborescence de antora"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"copie des fichiers statiques de type README qui sont disséminés dans les apps dans antora (je préférerais pouvoir les inclure depuis antora mais pour l'instant ce n'est pas possible)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"lancement de antora pour transformer tout cela en fichiers html"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"copie sur un serveur"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Et voila ce que ca donne grosso modo :"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://eventuallycoding.com/wp-content/uploads/2022/05/doc-result.jpg","rel":["nofollow"]},"children":[{"type":"element","tag":"img","props":{"alt":"","src":"/images/doc-result.jpg"},"children":[]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"En terme de résultat nous avons donc des pages de documentation qui sont générés depuis le code et des pages rédigées."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nLes pages rédigées doivent rester méta (principe de fonctionnement, explication de choix, vision prospective etc…) pour avoir le moins de chance possible de ne pas être à jour avec un code qu'elles décriraient."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Voici par exemple, à l'heure où j'écris, notre arborescence :"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Getting started"}]},{"type":"text","value":" : ensemble de doc permettant de démarrer son environnement de dev et contribuer à la documentation"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Architecture"}]},{"type":"text","value":" : une liste de docs qui explique les grands principes de l'architecture chez Malt, les choix techniques effectuées et comment ils ont été pris (avec les compromis acceptés)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Domains"}]},{"type":"text","value":" : une doc généré qui liste les entités de domaines et reprend la javadoc de chaque champ, complété avec de la doc rédigée"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Applications"}]},{"type":"text","value":" : l'ensemble des README de chaque application qui doit comprendre en théorie les choses nécessaires à savoir pour développer sur cette application et son but général"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Guides"}]},{"type":"text","value":" : des tutoriaux, des explications détaillées, des principes de devs (guidelines) dont une partie provient du code"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Resources"}]},{"type":"text","value":" : des resources externes, des référentiels de connaissance (liste des events RabbitMQ, liste des SMS/Mails) etc…"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Platform"}]},{"type":"text","value":" : un focus plus détaillée sur l'infrastructure"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Si cette approche à base de documentation automatique vous intéresse, je vous invite à rechercher \""},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"living documentation"}]},{"type":"text","value":"\" sur internet. Vous avez notamment plusieurs conférences de "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Cyrille Martraire"}]},{"type":"text","value":" sur le sujet ainsi qu'un livre :"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://www.youtube.com/watch?v=Tw-wcps7WqU","rel":["nofollow"]},"children":[{"type":"text","value":"Et si la doc devenait aussi sexy que le code"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://www.amazon.fr/Living-Documentation-Cyrille-Martraire/dp/0134689321","rel":["nofollow"]},"children":[{"type":"text","value":"Le livre"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"A bientôt"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"une-indigestion-de-doc","depth":2,"text":"Une indigestion de doc"},{"id":"ou-pas-de-doc-du-tout","depth":2,"text":"Ou pas de doc du tout ?"},{"id":"une-documentation-générée","depth":2,"text":"Une documentation générée"},{"id":"portail-de-développement","depth":2,"text":"Portail de développement"}]}},"_type":"markdown","_id":"content:articles:2020:04:19:une-documentation-qui-vit.md","_source":"content","_file":"articles/2020/04/19/une-documentation-qui-vit.md","_extension":"md"}
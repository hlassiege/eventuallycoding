{"_path":"/articles/2009/10/28/creer-des-fichiers-excel-avec-des-caracteres-chinois-en-java","_dir":"28","_draft":false,"_partial":false,"_locale":"","title":"Créer des fichiers Excel avec des caractères Chinois en Java","description":"## Créer des fichiers Excel avec des caractères Chinois\nDans la lignée du post précédent, pourquoi ne pas continuer à parler de la Chine et aborder l...","id":"134","date":"2009-10-28","tags":["java","poi","utf8"],"img":"exportbadchinese.png","cover":"cover8.jpg","readingTime":{"text":"2 min read","minutes":1.78,"time":106800,"words":356},"body":{"type":"root","children":[{"type":"element","tag":"h2","props":{"id":"créer-des-fichiers-excel-avec-des-caractères-chinois"},"children":[{"type":"text","value":"Créer des fichiers Excel avec des caractères Chinois"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Dans la lignée du post précédent, pourquoi ne pas continuer à parler de la Chine et aborder le sujet des exports de fichiers au format Excel."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Je vais aborder ici l'utilisation de "},{"type":"element","tag":"a","props":{"href":"http://poi.apache.org/spreadsheet/index.html","rel":["nofollow"],"title":"POI"},"children":[{"type":"text","value":"POI"}]},{"type":"text","value":" et les problèmes que vous pourriez rencontrer avec des jeux de caractères exotiques."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Sur l'application sur laquelle je travaillais nous avions un module de transformation de fichiers CSV vers Excel."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"L'implémentation de transformation repose sur "},{"type":"element","tag":"a","props":{"href":"http://poi.apache.org/spreadsheet/index.html","rel":["nofollow"],"title":"POI"},"children":[{"type":"text","value":"POI"}]},{"type":"text","value":", c'est une librairie assez simple et bien foutu pour créer des fichiers Excel."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"L'algo est simple, je parcours la liste des valeurs et je crée des cellules au fur et à mesure en se basant sur un code de ce type (ici il s'agit d'une cellule au format texte) :"}]},{"type":"element","tag":"pre","props":{"className":["language-java"],"code":"// row est une ligne excel créé précédemment, indexCol l'indice de colonne sur la ligne\nHSSFCell cell = row.createCell(indexCol);\nHSSFCellStyle textCellStyle = workbook.createCellStyle();\ntextCellStyle.setDataFormat(format.getFormat(\"General\"));\ncell.setCellStyle(textCellStyle);\ncell.setCellValue(value);\n","language":"java","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"// row est une ligne excel créé précédemment, indexCol l'indice de colonne sur la ligne\nHSSFCell cell = row.createCell(indexCol);\nHSSFCellStyle textCellStyle = workbook.createCellStyle();\ntextCellStyle.setDataFormat(format.getFormat(\"General\"));\ncell.setCellStyle(textCellStyle);\ncell.setCellValue(value);\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Seulement voila, avec cet algo on obtient un résultat un peu étrange lorsque nos données sont en Chinois"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Et je vous garantis, ce n'est pas du Chinois (même si l'un dans l'autre, je ne comprends aucun des deux...)."}]},{"type":"element","tag":"h2","props":{"id":"solution"},"children":[{"type":"text","value":"Solution"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"En fait il est nécessaire de rajouter cette petite indication à POI pour que ça se passe bien :"}]},{"type":"element","tag":"pre","props":{"className":["language-java"],"code":"cell.setEncoding(HSSFCell.ENCODING_UTF_16);\n","language":"java","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"cell.setEncoding(HSSFCell.ENCODING_UTF_16);\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Cette fois on obtient bien du Chinois dans notre fichier."}]},{"type":"element","tag":"h2","props":{"id":"astuce"},"children":[{"type":"text","value":"Astuce"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"J'en profite pour une petite astuce qui mérite d'être noté pour la partie purement CSV. Vous le savez sans doute, si vous utilisez un fichier csv avec l'extension xls vous pouvez aussi l'ouvrir dans Excel et celui-ci s'occupe de tout pour l'afficher comme un document \"classique\". Si vous utilisez un encodage ISO-latin1 pour vos fichiers textes sur vos postes Windows avec des caractères qui correspondent à ce charset, aucun souci, vous obtiendrez le résultat voulu. Là où ça se corse, c'est quand vous passez en encodage UTF-8 avec des caractères Chinois. Pour le coup Excel ne sera plus capable de reconnaitre correctement votre encodage (pour l'anecdote, OpenOffice y arrive lui)."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"En fait il faut penser à rajouter un "},{"type":"element","tag":"a","props":{"href":"http://fr.wikipedia.org/wiki/Byte_Order_Mark","rel":["nofollow"],"title":"BOM"},"children":[{"type":"text","value":"BOM"}]},{"type":"text","value":" en début de fichier pour qu'Excel ouvre correctement le fichier."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Pour cela, il suffit d'insérer le BOM en début de flux :"}]},{"type":"element","tag":"pre","props":{"className":["language-java"],"code":"OutputStreamWriter osw = new OutputStreamWriter( new FileOutputStream(csv), FILE_ENCODING);\nosw.write(0xFEFF);\n","language":"java","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"OutputStreamWriter osw = new OutputStreamWriter( new FileOutputStream(csv), FILE_ENCODING);\nosw.write(0xFEFF);\n"}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"créer-des-fichiers-excel-avec-des-caractères-chinois","depth":2,"text":"Créer des fichiers Excel avec des caractères Chinois"},{"id":"solution","depth":2,"text":"Solution"},{"id":"astuce","depth":2,"text":"Astuce"}]}},"_type":"markdown","_id":"content:articles:2009:10:28:creer-des-fichiers-excel-avec-des-caracteres-chinois-en-java.md","_source":"content","_file":"articles/2009/10/28/creer-des-fichiers-excel-avec-des-caracteres-chinois-en-java.md","_extension":"md"}
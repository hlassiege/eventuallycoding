{"_path":"/articles/2012/04/14/maven-que-perforce-soit-avec-toi","_dir":"14","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"Maven : que Perforce soit avec toi","description":"![](/images/ps-kztpdvdc-170x170-751.jpg \"ps.kztpdvdc.170x170-75\")\nJ'ai un peu galéré dernièrement pour configurer correctement Perforce avec Maven et...","excerpt":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"","src":"/images/ps-kztpdvdc-170x170-751.jpg","title":"ps.kztpdvdc.170x170-75"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"J'ai un peu galéré dernièrement pour configurer correctement Perforce avec Maven et notamment le plugin Maven release. Je vous propose donc un petit billet sur le sujet."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nBref, ça va parler de release avec maven, de déploiement sur Nexus et  de label perforce."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nTout un programme."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Tout d'abord petit rappel, si vous avez la chance de ne pas connaitre Perforce (sic...), il s'agit d'un gestionnaire de source tout comme peut l'être Subversion, Git ou Mercurial. Enfin \"tout comme peut l'être\", faut le dire vite... Je passerais rapidement sur l’outil en lui-même car je l’utilise contraint et forcé."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Or comme ce magnifique outil est relativement indigeste et loin d’être simple à utiliser je vous propose de voir rapidement la configuration nécessaire pour l’intégration avec Maven."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"A noter que si vraiment Perforce vous insupporte, et je peux comprendre, vous pouvez utiliser un proxy git-perforce. Je vous invite dans ce cas à lire "},{"type":"element","tag":"a","props":{"href":"http://jeanchristophegay.com/git-p4-au-secours-de-perforce/","rel":["nofollow"]},"children":[{"type":"text","value":"le billet Jean Chistophe Gay"}]},{"type":"text","value":" sur le sujet. (Au passage c’est un super collègue, prenez le sur vos missions ;))"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Mais revenons à nos moutons, même en utilisant git-p4 ca ne vous épargnera pas la douleur de devoir releaser sur Perforce de temps en temps."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Tout d’abord petit rappel,"}]},{"type":"element","tag":"h1","props":{"id":"le-versionning-avec-maven"},"children":[{"type":"text","value":"le versionning avec Maven"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Maven repose sur un notion forte de version d’artefact. Chaque dépendance que vous déclarez dans votre pom.xml a un numéro de version qui doit être explicitement déclaré. Par exemple :"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"com.localizeyourapp\nnemrodclient\n1.1"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Si vous utilisez plusieurs modules, chaque module doit avoir sa version. (Ce qui compliquera heureusement la tâche de ceux qui pensait qu’il suffirait de changer le numéro de version a un seul endroit pour en faire une release....)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"pom.xml\n|\n`---module1\n| |\n| `---pom.xml\n`---module2\n| |\n| `---pom.xml\n`---module3\n|\n`---pom.xml"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Le plugin maven release permet justement de suivre quelques bonnes pratiques lors de la release de votre projet :"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Vérification que vous n’avez aucune modifiation non commité en local"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Vérification que vous ne dépendez d’aucune dépendance instable (SNAPSHOT)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Lancement des tests"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Changement automatique de toutes les versions de POM de votre projet (sous modules inclus)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Création d’un tag sous votre gestionnaire de source"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Déploiement de l’artefact dans un repo Maven (nexus par exemple)"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Ouf, on a de la chance, le plugin maven-release supporte Perforce"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"http://www.perforce.com/perforce/r11.1/manuals/p4maven/index.html","rel":["nofollow"]},"children":[{"type":"text","value":"http://www.perforce.com/perforce/r11.1/manuals/p4maven/index.html"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"http://kb.perforce.com/article/1023/maven-integration","rel":["nofollow"]},"children":[{"type":"text","value":"http://kb.perforce.com/article/1023/maven-integration"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"http://maven.apache.org/scm/scms-overview.html","rel":["nofollow"]},"children":[{"type":"text","value":"http://maven.apache.org/scm/scms-overview.html"}]}]}]},{"type":"element","tag":"h1","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"h2","props":{"id":"perforce"},"children":[{"type":"text","value":"Perforce"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Prérequis :"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\np4 doit être disponible en ligne de commande"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nvous devez avoir certaines variables disponibles en variable d’environnement"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Les variables nécessaires pour Perforce peuvent être sous forme de variable d’environnement, ou bien écrites dans un fichier p4.ini à la racine de votre dépot. Le fichier doit contenir les informations suivantes :"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"P4PORT=perforce:1992"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nP4CHARSET=utf16le-bom"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nP4COMMANDCHARSET=winansi"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nP4CLIENT=hlassiege_1992"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nP4USER=v-hlassiege"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nP4PASSWORD=****"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Posez pas de question sur l’encodage, ca fait partie des merveilles de Perforce..."}]},{"type":"element","tag":"h2","props":{"id":"maven"},"children":[{"type":"text","value":"Maven"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Côté Maven, il vous faut quelque configuration dans votre pom.xml."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nLa balise scm :"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"scm:perforce:myHost:1992://depot/poms-parent/main\nscm:perforce:myHost:1992://depot/poms-parent/main"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"La partie distribution management pour que Maven sache sur quel repository déployer ces artefacts :"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"inhouse\ndav:"},{"type":"element","tag":"a","props":{"href":"http://repositoryHost:8081/nexus/content/repositories/egencia/","rel":["nofollow"]},"children":[{"type":"text","value":"http://repositoryHost:8081/nexus/content/repositories/egencia/"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"inhouse_snapshot\ndav:"},{"type":"element","tag":"a","props":{"href":"http://repositoryHost:8081/nexus/content/repositories/egencia-snapshot/","rel":["nofollow"]},"children":[{"type":"text","value":"http://repositoryHost:8081/nexus/content/repositories/egencia-snapshot/"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Ensuite il est important que la personne (ou l’outil si vous l’automatisez via votre intégration continue) qui va déclencher la release utilise un fichier settings.xml qui déclare les identifiants de connexion à Nexus :"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"inhouse\nmyLogin\nmyPwd"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Ensuite, une fois arrivé là, le reste est trivial"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"cd C:DEVperforce1992depotpoms-parentmain\nmvn release:prepare\nmvn release:perform"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Voilà, désormais que Perforce soit avec vous. Ou pas..."}]}]},"id":"506","date":"2012-04-14","categories":["waza"],"tags":["maven","nexus","perforce"],"img":"ps-kztpdvdc-170x170-751.jpg","cover":"cover3.jpg","readingTime":{"text":"3 min read","minutes":2.49,"time":149400,"words":498},"body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"","src":"/images/ps-kztpdvdc-170x170-751.jpg","title":"ps.kztpdvdc.170x170-75"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"J'ai un peu galéré dernièrement pour configurer correctement Perforce avec Maven et notamment le plugin Maven release. Je vous propose donc un petit billet sur le sujet."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nBref, ça va parler de release avec maven, de déploiement sur Nexus et  de label perforce."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nTout un programme."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Tout d'abord petit rappel, si vous avez la chance de ne pas connaitre Perforce (sic...), il s'agit d'un gestionnaire de source tout comme peut l'être Subversion, Git ou Mercurial. Enfin \"tout comme peut l'être\", faut le dire vite... Je passerais rapidement sur l’outil en lui-même car je l’utilise contraint et forcé."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Or comme ce magnifique outil est relativement indigeste et loin d’être simple à utiliser je vous propose de voir rapidement la configuration nécessaire pour l’intégration avec Maven."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"A noter que si vraiment Perforce vous insupporte, et je peux comprendre, vous pouvez utiliser un proxy git-perforce. Je vous invite dans ce cas à lire "},{"type":"element","tag":"a","props":{"href":"http://jeanchristophegay.com/git-p4-au-secours-de-perforce/","rel":["nofollow"]},"children":[{"type":"text","value":"le billet Jean Chistophe Gay"}]},{"type":"text","value":" sur le sujet. (Au passage c’est un super collègue, prenez le sur vos missions ;))"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Mais revenons à nos moutons, même en utilisant git-p4 ca ne vous épargnera pas la douleur de devoir releaser sur Perforce de temps en temps."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Tout d’abord petit rappel,"}]},{"type":"element","tag":"h1","props":{"id":"le-versionning-avec-maven"},"children":[{"type":"text","value":"le versionning avec Maven"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Maven repose sur un notion forte de version d’artefact. Chaque dépendance que vous déclarez dans votre pom.xml a un numéro de version qui doit être explicitement déclaré. Par exemple :"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"com.localizeyourapp\nnemrodclient\n1.1"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Si vous utilisez plusieurs modules, chaque module doit avoir sa version. (Ce qui compliquera heureusement la tâche de ceux qui pensait qu’il suffirait de changer le numéro de version a un seul endroit pour en faire une release....)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"pom.xml\n|\n`---module1\n| |\n| `---pom.xml\n`---module2\n| |\n| `---pom.xml\n`---module3\n|\n`---pom.xml"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Le plugin maven release permet justement de suivre quelques bonnes pratiques lors de la release de votre projet :"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Vérification que vous n’avez aucune modifiation non commité en local"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Vérification que vous ne dépendez d’aucune dépendance instable (SNAPSHOT)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Lancement des tests"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Changement automatique de toutes les versions de POM de votre projet (sous modules inclus)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Création d’un tag sous votre gestionnaire de source"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Déploiement de l’artefact dans un repo Maven (nexus par exemple)"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Ouf, on a de la chance, le plugin maven-release supporte Perforce"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"http://www.perforce.com/perforce/r11.1/manuals/p4maven/index.html","rel":["nofollow"]},"children":[{"type":"text","value":"http://www.perforce.com/perforce/r11.1/manuals/p4maven/index.html"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"http://kb.perforce.com/article/1023/maven-integration","rel":["nofollow"]},"children":[{"type":"text","value":"http://kb.perforce.com/article/1023/maven-integration"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"http://maven.apache.org/scm/scms-overview.html","rel":["nofollow"]},"children":[{"type":"text","value":"http://maven.apache.org/scm/scms-overview.html"}]}]}]},{"type":"element","tag":"h1","props":{"id":"configuration"},"children":[{"type":"text","value":"Configuration"}]},{"type":"element","tag":"h2","props":{"id":"perforce"},"children":[{"type":"text","value":"Perforce"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Prérequis :"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\np4 doit être disponible en ligne de commande"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nvous devez avoir certaines variables disponibles en variable d’environnement"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Les variables nécessaires pour Perforce peuvent être sous forme de variable d’environnement, ou bien écrites dans un fichier p4.ini à la racine de votre dépot. Le fichier doit contenir les informations suivantes :"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"P4PORT=perforce:1992"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nP4CHARSET=utf16le-bom"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nP4COMMANDCHARSET=winansi"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nP4CLIENT=hlassiege_1992"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nP4USER=v-hlassiege"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nP4PASSWORD=****"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Posez pas de question sur l’encodage, ca fait partie des merveilles de Perforce..."}]},{"type":"element","tag":"h2","props":{"id":"maven"},"children":[{"type":"text","value":"Maven"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Côté Maven, il vous faut quelque configuration dans votre pom.xml."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nLa balise scm :"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"scm:perforce:myHost:1992://depot/poms-parent/main\nscm:perforce:myHost:1992://depot/poms-parent/main"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"La partie distribution management pour que Maven sache sur quel repository déployer ces artefacts :"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"inhouse\ndav:"},{"type":"element","tag":"a","props":{"href":"http://repositoryHost:8081/nexus/content/repositories/egencia/","rel":["nofollow"]},"children":[{"type":"text","value":"http://repositoryHost:8081/nexus/content/repositories/egencia/"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"inhouse_snapshot\ndav:"},{"type":"element","tag":"a","props":{"href":"http://repositoryHost:8081/nexus/content/repositories/egencia-snapshot/","rel":["nofollow"]},"children":[{"type":"text","value":"http://repositoryHost:8081/nexus/content/repositories/egencia-snapshot/"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Ensuite il est important que la personne (ou l’outil si vous l’automatisez via votre intégration continue) qui va déclencher la release utilise un fichier settings.xml qui déclare les identifiants de connexion à Nexus :"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"inhouse\nmyLogin\nmyPwd"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Ensuite, une fois arrivé là, le reste est trivial"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"cd C:DEVperforce1992depotpoms-parentmain\nmvn release:prepare\nmvn release:perform"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Voilà, désormais que Perforce soit avec vous. Ou pas..."}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"perforce","depth":2,"text":"Perforce"},{"id":"maven","depth":2,"text":"Maven"}]}},"_type":"markdown","_id":"content:articles:2012:04:14:maven-que-perforce-soit-avec-toi.md","_source":"content","_file":"articles/2012/04/14/maven-que-perforce-soit-avec-toi.md","_extension":"md"}
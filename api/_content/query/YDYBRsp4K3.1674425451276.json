{"_path":"/articles/2011/11/05/les-tests-dihm-avec-play","_dir":"05","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"Les tests d'IHM avec Play!","description":"[![](/images/test.png \"test\")](http://eventuallycoding.com/wp-content/uploads/2011/11/test.png)\nVous avez une appli Play ? Vous avez déjà bien utilis...","excerpt":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"http://eventuallycoding.com/wp-content/uploads/2011/11/test.png","rel":["nofollow"]},"children":[{"type":"element","tag":"img","props":{"alt":"","src":"/images/test.png","title":"test"},"children":[]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Vous avez une appli Play ? Vous avez déjà bien utilisé les UnitTest mais votre couverture de code reste faiblarde ?"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nC’est sur que malgré tout vos efforts pour que la couche controlleur soit la plus fine possible il reste quand même pas mal de code et on ne peut pas faire l’impasse dessus. Et on évitera aussi de rappeler que votre merveilleux plugin cobertura ne mesure pas la couverture de code HTML+JS testé..."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nVous auriez bien voulu utiliser les FunctionalTest mais les assertions d’un FunctionalTest ne vous permettent pas de vérifier grand chose en dehors d’un code retour 200.\nBref, il va vous falloir passer au runner Selenium de Play."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Pour la suite, je pars du principe que vous avez déjà lu la doc sur les tests selenium dans Play."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"http://www.playframework.org/documentation/1.2.3/guide10","rel":["nofollow"]},"children":[{"type":"text","value":"http://www.playframework.org/documentation/1.2.3/guide10"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"http://www.playframework.org/documentation/1.2.3/test#Seleniumtest","rel":["nofollow"]},"children":[{"type":"text","value":"http://www.playframework.org/documentation/1.2.3/test#Seleniumtest"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"La doc est pas mal mais il manque des petits trucs pour faire des tests dynamiques et réutilisables."}]},{"type":"element","tag":"h2","props":{"id":"les-tags-selenium"},"children":[{"type":"text","value":"Les tags Selenium"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Déjà, premier frein pour écrire vos tests Selenium, il faut connaître la syntaxe Selenium."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nHeureusement, Manuel Bernhardt nous a fait un petit plugin pour Selenium IDE capable de générer nos tags pour les tests Play! : "},{"type":"element","tag":"a","props":{"href":"http://manuelbernhardt.github.com/play-selenium-plugin/","rel":["nofollow"]},"children":[{"type":"text","value":"http://manuelbernhardt.github.com/play-selenium-plugin/"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Pas de bol, c’est compatible jusqu’à la version 4 et j’ai la version 7 (merci au passage à Mozilla pour avoir accéléré le rythme de ces releases et flinguer tout mes plugins au passage...)."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Si vous ne pouvez pas utiliser le copier coller de Selenium IDE, il vous reste à le faire à la main. SeleniumIDE propose quand même la complétion de code sur l’ensemble des mots clés et ce sont les mêmes mots clés qui sont reconnus dans Play! Framework."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Quelques petites règles à respecter malgré tout :"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"pas d’espace entre la commande et les arguments tu mettras"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"assertTextPresent('OK') => OK\nassertTextPresent ('OK') => KO (la commande sera ignorée)"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"pas de ; tu utiliseras"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"pas de “ tu utiliseras"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"assertTextPresent('OK') => OK\nassertTextPresent(“OK”) => KO (la commande sera ignorée)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Evidemment j’ai eu la chance de tester toutes ces erreurs... Et au milieu de 20 commandes, savoir qu’une commande a été ignorée n’est pas évident au premier abord."}]},{"type":"element","tag":"h2","props":{"id":"lextension-play-pour-selenium"},"children":[{"type":"text","value":"L’extension Play pour Selenium"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Bon en fait, le tag Selenium accepte d’autres mots clés qui sont définis comme user-extension de Selenium dans le module TestRunner de Play!"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Donc vous pouvez aussi utiliser :"}]},{"type":"element","tag":"code","props":{"code":"clearSession()\nstoreCacheEntry('myKey', 'stringCacheValue')\nstoreLastReceivedEmailBy('boron@localhost', 'email')\nassertEquals\nassertNotEquals\nassertTextLike\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"clearSession()\nstoreCacheEntry('myKey', 'stringCacheValue')\nstoreLastReceivedEmailBy('boron@localhost', 'email')\nassertEquals\nassertNotEquals\nassertTextLike\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Vous pouvez retrouver un exemple de ces tag dans samples-and-test/just-test-cases/test/SeleniumUserExtensions.test.hml dans les sources de Play!"}]},{"type":"element","tag":"h2","props":{"id":"avoir-des-tests-dynamiques"},"children":[{"type":"text","value":"Avoir des tests dynamiques"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Dans les autres problèmes classiques que l’on rencontre quand on teste, c’est par exemple quand on veut cliquer sur un lien qui comprend l’id d’un élément. Or évidemment cet ID peut être différent d’un lancement à l’autre."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nEt bien pas de souci puisqu’on manipule un template groovy on peut appeler notre code Java :"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"%{ nemrodId= models.Project.find(\"byName\",\"Nemrod\").first().id;  }%"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"puis y faire référence comme suit :"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"clickAndWait('id=messages-${nemrodId}')"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"De la même façon, vous pouvez faire un assert sur un text présent mais il faut gérer le fait que vous gériez plusieurs langues :"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"%{ dashboardText = play.i18n.Messages.get(\"project.dashboard\");  }%\n…\nassertTextPresent('${dashboardText}')"}]},{"type":"element","tag":"h2","props":{"id":"se-créer-sa-librairie-de-test"},"children":[{"type":"text","value":"Se créer sa librairie de test"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"L’un des inconvénients majeurs des tests selenium c’est qu’ils sont très sensibles au changement d’IHM. C’est d’autant plus accentué que certaines actions reviennent fréquemment, par exemple le login sur une appli et que repasser partout pour modifier le login devient vite fastidieux."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Donc une méthode classique c’est de regrouper des actions selenium (type, click etc...) sous forme plus compréhensibles :"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"login(myUser,myPwd)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Et avec Play! c’est possible en utilisant les tags."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Créons ici par exemple le template correspondant à l’action login sur une application."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nJe crée un fichier login.tag dans views/tags/testing/ avec le contenu suivant :"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"open('/')\ntype('username', '${_user}')\ntype('password', '${_password}')\nclick('signin')\nwaitForPageToLoad('30000')"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Dans le test selenium, l’appel à ce tag se fait de la façon suivante :"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"#{selenium}\nclearSession()"}]},{"type":"element","tag":"code","props":{"code":"#{testing.login user:'myuser', password:'mypassword'/}\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"#{testing.login user:'myuser', password:'mypassword'/}\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"…\n#{/selenium}"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Voila, la séance est finie. Vous pouvez reprendre une activité normale"}]}]},"id":"466","date":"2011-11-05","categories":["waza"],"tags":["play","selenium"],"img":"test.png","cover":"cover5.jpg","readingTime":{"text":"4 min read","minutes":3.02,"time":181200,"words":604},"body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"http://eventuallycoding.com/wp-content/uploads/2011/11/test.png","rel":["nofollow"]},"children":[{"type":"element","tag":"img","props":{"alt":"","src":"/images/test.png","title":"test"},"children":[]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Vous avez une appli Play ? Vous avez déjà bien utilisé les UnitTest mais votre couverture de code reste faiblarde ?"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nC’est sur que malgré tout vos efforts pour que la couche controlleur soit la plus fine possible il reste quand même pas mal de code et on ne peut pas faire l’impasse dessus. Et on évitera aussi de rappeler que votre merveilleux plugin cobertura ne mesure pas la couverture de code HTML+JS testé..."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nVous auriez bien voulu utiliser les FunctionalTest mais les assertions d’un FunctionalTest ne vous permettent pas de vérifier grand chose en dehors d’un code retour 200.\nBref, il va vous falloir passer au runner Selenium de Play."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Pour la suite, je pars du principe que vous avez déjà lu la doc sur les tests selenium dans Play."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"http://www.playframework.org/documentation/1.2.3/guide10","rel":["nofollow"]},"children":[{"type":"text","value":"http://www.playframework.org/documentation/1.2.3/guide10"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"http://www.playframework.org/documentation/1.2.3/test#Seleniumtest","rel":["nofollow"]},"children":[{"type":"text","value":"http://www.playframework.org/documentation/1.2.3/test#Seleniumtest"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"La doc est pas mal mais il manque des petits trucs pour faire des tests dynamiques et réutilisables."}]},{"type":"element","tag":"h2","props":{"id":"les-tags-selenium"},"children":[{"type":"text","value":"Les tags Selenium"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Déjà, premier frein pour écrire vos tests Selenium, il faut connaître la syntaxe Selenium."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nHeureusement, Manuel Bernhardt nous a fait un petit plugin pour Selenium IDE capable de générer nos tags pour les tests Play! : "},{"type":"element","tag":"a","props":{"href":"http://manuelbernhardt.github.com/play-selenium-plugin/","rel":["nofollow"]},"children":[{"type":"text","value":"http://manuelbernhardt.github.com/play-selenium-plugin/"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Pas de bol, c’est compatible jusqu’à la version 4 et j’ai la version 7 (merci au passage à Mozilla pour avoir accéléré le rythme de ces releases et flinguer tout mes plugins au passage...)."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Si vous ne pouvez pas utiliser le copier coller de Selenium IDE, il vous reste à le faire à la main. SeleniumIDE propose quand même la complétion de code sur l’ensemble des mots clés et ce sont les mêmes mots clés qui sont reconnus dans Play! Framework."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Quelques petites règles à respecter malgré tout :"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"pas d’espace entre la commande et les arguments tu mettras"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"assertTextPresent('OK') => OK\nassertTextPresent ('OK') => KO (la commande sera ignorée)"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"pas de ; tu utiliseras"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"pas de “ tu utiliseras"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"assertTextPresent('OK') => OK\nassertTextPresent(“OK”) => KO (la commande sera ignorée)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Evidemment j’ai eu la chance de tester toutes ces erreurs... Et au milieu de 20 commandes, savoir qu’une commande a été ignorée n’est pas évident au premier abord."}]},{"type":"element","tag":"h2","props":{"id":"lextension-play-pour-selenium"},"children":[{"type":"text","value":"L’extension Play pour Selenium"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Bon en fait, le tag Selenium accepte d’autres mots clés qui sont définis comme user-extension de Selenium dans le module TestRunner de Play!"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Donc vous pouvez aussi utiliser :"}]},{"type":"element","tag":"code","props":{"code":"clearSession()\nstoreCacheEntry('myKey', 'stringCacheValue')\nstoreLastReceivedEmailBy('boron@localhost', 'email')\nassertEquals\nassertNotEquals\nassertTextLike\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"clearSession()\nstoreCacheEntry('myKey', 'stringCacheValue')\nstoreLastReceivedEmailBy('boron@localhost', 'email')\nassertEquals\nassertNotEquals\nassertTextLike\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Vous pouvez retrouver un exemple de ces tag dans samples-and-test/just-test-cases/test/SeleniumUserExtensions.test.hml dans les sources de Play!"}]},{"type":"element","tag":"h2","props":{"id":"avoir-des-tests-dynamiques"},"children":[{"type":"text","value":"Avoir des tests dynamiques"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Dans les autres problèmes classiques que l’on rencontre quand on teste, c’est par exemple quand on veut cliquer sur un lien qui comprend l’id d’un élément. Or évidemment cet ID peut être différent d’un lancement à l’autre."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nEt bien pas de souci puisqu’on manipule un template groovy on peut appeler notre code Java :"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"%{ nemrodId= models.Project.find(\"byName\",\"Nemrod\").first().id;  }%"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"puis y faire référence comme suit :"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"clickAndWait('id=messages-${nemrodId}')"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"De la même façon, vous pouvez faire un assert sur un text présent mais il faut gérer le fait que vous gériez plusieurs langues :"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"%{ dashboardText = play.i18n.Messages.get(\"project.dashboard\");  }%\n…\nassertTextPresent('${dashboardText}')"}]},{"type":"element","tag":"h2","props":{"id":"se-créer-sa-librairie-de-test"},"children":[{"type":"text","value":"Se créer sa librairie de test"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"L’un des inconvénients majeurs des tests selenium c’est qu’ils sont très sensibles au changement d’IHM. C’est d’autant plus accentué que certaines actions reviennent fréquemment, par exemple le login sur une appli et que repasser partout pour modifier le login devient vite fastidieux."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Donc une méthode classique c’est de regrouper des actions selenium (type, click etc...) sous forme plus compréhensibles :"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"login(myUser,myPwd)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Et avec Play! c’est possible en utilisant les tags."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Créons ici par exemple le template correspondant à l’action login sur une application."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nJe crée un fichier login.tag dans views/tags/testing/ avec le contenu suivant :"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"open('/')\ntype('username', '${_user}')\ntype('password', '${_password}')\nclick('signin')\nwaitForPageToLoad('30000')"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Dans le test selenium, l’appel à ce tag se fait de la façon suivante :"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"#{selenium}\nclearSession()"}]},{"type":"element","tag":"code","props":{"code":"#{testing.login user:'myuser', password:'mypassword'/}\n"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"#{testing.login user:'myuser', password:'mypassword'/}\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"…\n#{/selenium}"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Voila, la séance est finie. Vous pouvez reprendre une activité normale"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"les-tags-selenium","depth":2,"text":"Les tags Selenium"},{"id":"lextension-play-pour-selenium","depth":2,"text":"L’extension Play pour Selenium"},{"id":"avoir-des-tests-dynamiques","depth":2,"text":"Avoir des tests dynamiques"},{"id":"se-créer-sa-librairie-de-test","depth":2,"text":"Se créer sa librairie de test"}]}},"_type":"markdown","_id":"content:articles:2011:11:05:les-tests-dihm-avec-play.md","_source":"content","_file":"articles/2011/11/05/les-tests-dihm-avec-play.md","_extension":"md"}